(function(){var VMathArrayConstructor=[].constructor;if(typeof Float32Array!=="undefined"&&Float32Array.prototype!==undefined&&Float32Array.prototype.slice===undefined){Float32Array.prototype.slice=function Float32ArraySlice(s,e){var length=this.length;if(s===undefined){s=0}else if(s<0){s+=length}if(e===undefined){e=length}else if(e<0){e+=length}length=e-s;if(0<length){var dst=new Float32Array(length);var n=0;do{dst[n]=this[s];n+=1;s+=1}while(s<e);return dst}else{return new Float32Array}}}var VMath={version:1,precision:1e-6,FLOAT_MAX:Number.MAX_VALUE,select:function selectFn(m,a,b){if(m){return a}else{return b}},reciprocal:function reciprocalFn(a){if(a!==0){return 1/a}else{throw"Division by zero"}},truncate:function truncateFn(value){return value|0},v2BuildZero:function v2BuildZeroFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=0;dst[1]=0;return dst},v2BuildOne:function v2BuildOneFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=1;dst[1]=1;return dst},v2BuildXAxis:function v2BuildXAxisFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=1;dst[1]=0;return dst},v2BuildYAxis:function v2BuildYAxisFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=0;dst[1]=1;return dst},v2Build:function v2Fn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a;dst[1]=b;return dst},v2Copy:function v2CopyFn(src,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=src[0];dst[1]=src[1];return dst},v2Set:function v2SetFn(v,a){v[0]=a[0];v[1]=a[1]},v2Neg:function v2NegFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=-a[0];dst[1]=-a[1];return dst},v2Add:function v2AddFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a[0]+b[0];dst[1]=a[1]+b[1];return dst},v2Add3:function v2Add3Fn(a,b,c,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a[0]+b[0]+c[0];dst[1]=a[1]+b[1]+c[1];return dst},v2Add4:function v2Add4Fn(a,b,c,d,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a[0]+b[0]+c[0]+d[0];dst[1]=a[1]+b[1]+c[1]+d[1];return dst},v2Sub:function v2SubFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a[0]-b[0];dst[1]=a[1]-b[1];return dst},v2Mul:function v2MulFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a[0]*b[0];dst[1]=a[1]*b[1];return dst},v2MulAdd:function v2MulAddFn(a,b,c,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a[0]*b[0]+c[0];dst[1]=a[1]*b[1]+c[1];return dst},v2Dot:function v2DotFn(a,b){return a[0]*b[0]+a[1]*b[1]},v2PerpDot:function v2PerpDot(a,b){return a[0]*b[1]-a[1]*b[0]},v2LengthSq:function v2LengthSqFn(a){var a0=a[0];var a1=a[1];return a0*a0+a1*a1},v2Length:function v2LengthFn(a){var a0=a[0];var a1=a[1];return Math.sqrt(a0*a0+a1*a1)},v2Reciprocal:function v2ReciprocalFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}var rcp=VMath.reciprocal;dst[0]=rcp(a[0]);dst[1]=rcp(a[1]);return dst},v2Normalize:function v2NormalizeFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}var a0=a[0];var a1=a[1];var lsq=a0*a0+a1*a1;if(lsq>0){var lr=1/Math.sqrt(lsq);dst[0]=a0*lr;dst[1]=a1*lr}else{dst[0]=0;dst[1]=0}return dst},v2Abs:function v2AbsFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}var abs=Math.abs;dst[0]=abs(a[0]);dst[1]=abs(a[1]);return dst},v2Max:function v2MaxFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}var max=Math.max;dst[0]=max(a[0],b[0]);dst[1]=max(a[1],b[1]);return dst},v2Min:function v2MinFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}var min=Math.min;dst[0]=min(a[0],b[0]);dst[1]=min(a[1],b[1]);return dst},v2Equal:function v2EqualFn(a,b,precision){var abs=Math.abs;if(precision===undefined){precision=this.precision}return abs(a[0]-b[0])<=precision&&abs(a[1]-b[1])<=precision},v2MaskEqual:function v2MaskEqualFn(a,b){var abs=Math.abs;var precision=VMath.precision;return[abs(a[0]-b[0])<=precision,abs(a[1]-b[1])<=precision]},v2MaskLess:function v2MaskLessFn(a,b){return[a[0]<b[0],a[1]<b[1]]},v2MaskGreater:function v2MaskGreaterFn(a,b){return[a[0]>b[0],a[1]>b[1]]},v2MaskGreaterEq:function v2MaskGreaterEqFn(a,b){return[a[0]>=b[0],a[1]>=b[1]]},v2MaskNot:function v2MaskNotFn(a){return[!a[0],!a[1]]},v2MaskOr:function v2MaskOrFn(a,b){return[a[0]||b[0],a[1]||b[1]]},v2MaskAnd:function v2MaskAndFn(a,b){return[a[0]&&b[0],a[1]&&b[1]]},v2Select:function v2SelectFn(m,a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=m[0]?a[0]:b[0];dst[1]=m[1]?a[1]:b[1];return dst},v2ScalarBuild:function v2ScalarBuildFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a;dst[1]=a;return dst},v2ScalarMax:function v2ScalarMaxFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}var max=Math.max;dst[0]=max(a[0],b);dst[1]=max(a[1],b);return dst},v2ScalarMin:function v2ScalarMinFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}var min=Math.min;dst[0]=min(a[0],b);dst[1]=min(a[1],b);return dst},v2ScalarAdd:function v2ScalarAddFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a[0]+b;dst[1]=a[1]+b;return dst},v2ScalarSub:function v2ScalarSubFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a[0]-b;dst[1]=a[1]-b;return dst},v2ScalarMul:function v2ScalarMulFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}if(b===0){dst[0]=0;dst[1]=0}else{dst[0]=a[0]*b;dst[1]=a[1]*b}return dst},v2AddScalarMul:function v2AddScalarMulFn(a,b,c,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a[0]+b[0]*c;dst[1]=a[1]+b[1]*c;return dst},v2EqualScalarMask:function v2EqualScalarMaskFn(a,b){var abs=Math.abs;var precision=VMath.precision;return[abs(a[0]-b)<=precision,abs(a[1]-b)<=precision]},v2LessScalarMask:function v2LessScalarMaskFn(a,b){return[a[0]<b,a[1]<b]},v2GreaterScalarMask:function v2GreaterScalarMaskFn(a,b){return[a[0]>b,a[1]>b]},v2GreaterEqScalarMask:function v2GreaterEqScalarMaskFn(a,b){return[a[0]>=b,a[1]>=b]},v2Lerp:function v2LerpFn(a,b,t,dst){if(dst===undefined){dst=new VMathArrayConstructor(2)}dst[0]=a[0]+(b[0]-a[0])*t;dst[1]=a[1]+(b[1]-a[1])*t;return dst},v3BuildZero:function v3BuildZeroFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=0;dst[1]=0;dst[2]=0;return dst},v3BuildOne:function v3BuildOneFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=1;dst[1]=1;dst[2]=1;return dst},v3BuildXAxis:function v3BuildXAxisFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=1;dst[1]=0;dst[2]=0;return dst},v3BuildYAxis:function v3BuildYAxisFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=0;dst[1]=1;dst[2]=0;return dst},v3BuildZAxis:function v3BuildZAxisFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=0;dst[1]=0;dst[2]=1;return dst},v3Build:function v3Fn(a,b,c,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a;dst[1]=b;dst[2]=c;return dst},v3Copy:function v3CopyFn(src,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=src[0];dst[1]=src[1];dst[2]=src[2];return dst},v3Set:function v3SetFn(v,a){v[0]=a[0];v[1]=a[1];v[2]=a[2]},v3Neg:function v3NegFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=-a[0];dst[1]=-a[1];dst[2]=-a[2];return dst},v3Add:function v3AddFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a[0]+b[0];dst[1]=a[1]+b[1];dst[2]=a[2]+b[2];return dst},v3Add3:function v3Add3Fn(a,b,c,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a[0]+b[0]+c[0];dst[1]=a[1]+b[1]+c[1];dst[2]=a[2]+b[2]+c[2];return dst},v3Add4:function v3Add4Fn(a,b,c,d,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a[0]+b[0]+c[0]+d[0];dst[1]=a[1]+b[1]+c[1]+d[1];dst[2]=a[2]+b[2]+c[2]+d[2];return dst},v3Sub:function v3SubFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a[0]-b[0];dst[1]=a[1]-b[1];dst[2]=a[2]-b[2];return dst},v3Mul:function v3MulFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a[0]*b[0];dst[1]=a[1]*b[1];dst[2]=a[2]*b[2];return dst},v3MulAdd:function v3MulAddFn(a,b,c,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a[0]*b[0]+c[0];dst[1]=a[1]*b[1]+c[1];dst[2]=a[2]*b[2]+c[2];return dst},v3Dot:function v3DotFn(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]},v3Cross:function v3CrossFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}var a0=a[0];var a1=a[1];var a2=a[2];var b0=b[0];var b1=b[1];var b2=b[2];dst[0]=a1*b2-a2*b1;dst[1]=a2*b0-a0*b2;dst[2]=a0*b1-a1*b0;return dst},v3LengthSq:function v3LengthSqFn(a){var a0=a[0];var a1=a[1];var a2=a[2];return a0*a0+a1*a1+a2*a2},v3Length:function v3LengthFn(a){var a0=a[0];var a1=a[1];var a2=a[2];return Math.sqrt(a0*a0+a1*a1+a2*a2)},v3Reciprocal:function v3ReciprocalFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}var rcp=VMath.reciprocal;dst[0]=rcp(a[0]);dst[1]=rcp(a[1]);dst[2]=rcp(a[2]);return dst},v3Normalize:function v3NormalizeFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}var a0=a[0];var a1=a[1];var a2=a[2];var lsq=a0*a0+a1*a1+a2*a2;if(lsq>0){var lr=1/Math.sqrt(lsq);dst[0]=a0*lr;dst[1]=a1*lr;dst[2]=a2*lr}else{dst[0]=0;dst[1]=0;dst[2]=0}return dst},v3Abs:function v3AbsFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}var abs=Math.abs;dst[0]=abs(a[0]);dst[1]=abs(a[1]);dst[2]=abs(a[2]);return dst},v3Max:function v3MaxFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}var max=Math.max;dst[0]=max(a[0],b[0]);dst[1]=max(a[1],b[1]);dst[2]=max(a[2],b[2]);return dst},v3Min:function v3MinFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}var min=Math.min;dst[0]=min(a[0],b[0]);dst[1]=min(a[1],b[1]);dst[2]=min(a[2],b[2]);return dst},v3Equal:function v3EqualFn(a,b,precision){var abs=Math.abs;if(precision===undefined){precision=this.precision}return abs(a[0]-b[0])<=precision&&abs(a[1]-b[1])<=precision&&abs(a[2]-b[2])<=precision},v3MaskEqual:function v3MaskEqualFn(a,b){var abs=Math.abs;var precision=VMath.precision;return[abs(a[0]-b[0])<=precision,abs(a[1]-b[1])<=precision,abs(a[2]-b[2])<=precision]},v3MaskLess:function v3MaskLessFn(a,b){return[a[0]<b[0],a[1]<b[1],a[2]<b[2]]},v3MaskGreater:function v3MaskGreaterFn(a,b){return[a[0]>b[0],a[1]>b[1],a[2]>b[2]]},v3MaskGreaterEq:function v3MaskGreaterEqFn(a,b){return[a[0]>=b[0],a[1]>=b[1],a[2]>=b[2]]},v3MaskNot:function v3MaskNotFn(a){return[!a[0],!a[1],!a[2]]},v3MaskOr:function v3MaskOrFn(a,b){return[a[0]||b[0],a[1]||b[1],a[2]||b[2]]},v3MaskAnd:function v3MaskAndFn(a,b){return[a[0]&&b[0],a[1]&&b[1],a[2]&&b[2]]},v3Select:function v3SelectFn(m,a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=m[0]?a[0]:b[0];dst[1]=m[1]?a[1]:b[1];dst[2]=m[2]?a[2]:b[2];return dst},v3ScalarBuild:function v3ScalarBuildFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a;dst[1]=a;dst[2]=a;return dst},v3ScalarMax:function v3ScalarMaxFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}var max=Math.max;dst[0]=max(a[0],b);dst[1]=max(a[1],b);dst[2]=max(a[2],b);return dst},v3ScalarMin:function v3ScalarMinFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}var min=Math.min;dst[0]=min(a[0],b);dst[1]=min(a[1],b);dst[2]=min(a[2],b);return dst},v3ScalarAdd:function v3ScalarAddFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a[0]+b;dst[1]=a[1]+b;dst[2]=a[2]+b;return dst},v3ScalarSub:function v3ScalarSubFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a[0]-b;dst[1]=a[1]-b;dst[2]=a[2]-b;return dst},v3ScalarMul:function v3ScalarMulFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}if(b===0){dst[0]=0;dst[1]=0;dst[2]=0}else{dst[0]=a[0]*b;dst[1]=a[1]*b;dst[2]=a[2]*b}return dst},v3AddScalarMul:function v3AddScalarMulFn(a,b,c,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a[0]+b[0]*c;dst[1]=a[1]+b[1]*c;dst[2]=a[2]+b[2]*c;return dst},v3EqualScalarMask:function v3EqualScalarMaskFn(a,b){var abs=Math.abs;var precision=VMath.precision;return[abs(a[0]-b)<=precision,abs(a[1]-b)<=precision,abs(a[2]-b)<=precision]},v3LessScalarMask:function v3LessScalarMaskFn(a,b){return[a[0]<b,a[1]<b,a[2]<b]},v3GreaterScalarMask:function v3GreaterScalarMaskFn(a,b){return[a[0]>b,a[1]>b,a[2]>b]},v3GreaterEqScalarMask:function v3GreaterEqScalarMaskFn(a,b){return[a[0]>=b,a[1]>=b,a[2]>=b]},v3Lerp:function v3LerpFn(a,b,t,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=a[0]+(b[0]-a[0])*t;dst[1]=a[1]+(b[1]-a[1])*t;dst[2]=a[2]+(b[2]-a[2])*t;return dst},v4BuildZero:function v4BuildZeroFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=0;dst[1]=0;dst[2]=0;dst[3]=0;return dst},v4BuildOne:function v4BuildOneFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=1;dst[1]=1;dst[2]=1;dst[3]=1;return dst},v4Build:function v4BuildFn(a,b,c,d,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a;dst[1]=b;dst[2]=c;dst[3]=d;return dst},v4Copy:function v4CopyFn(src,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=src[0];dst[1]=src[1];dst[2]=src[2];dst[3]=src[3];return dst},v4Set:function v4SetFn(v,a){v[0]=a[0];v[1]=a[1];v[2]=a[2];v[3]=a[3]},v4Neg:function v4NegFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=-a[0];dst[1]=-a[1];dst[2]=-a[2];dst[3]=-a[3];return dst},v4Add:function v4AddFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a[0]+b[0];dst[1]=a[1]+b[1];dst[2]=a[2]+b[2];dst[3]=a[3]+b[3];return dst},v4Add3:function v4Add3Fn(a,b,c,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a[0]+b[0]+c[0];dst[1]=a[1]+b[1]+c[1];dst[2]=a[2]+b[2]+c[2];dst[3]=a[3]+b[3]+c[3];return dst},v4Add4:function v4Add4Fn(a,b,c,d,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a[0]+b[0]+c[0]+d[0];dst[1]=a[1]+b[1]+c[1]+d[1];dst[2]=a[2]+b[2]+c[2]+d[2];dst[3]=a[3]+b[3]+c[3]+d[3];return dst},v4Sub:function v4SubFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a[0]-b[0];dst[1]=a[1]-b[1];dst[2]=a[2]-b[2];dst[3]=a[3]-b[3];return dst},v4Mul:function v4MulFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a[0]*b[0];dst[1]=a[1]*b[1];dst[2]=a[2]*b[2];dst[3]=a[3]*b[3];return dst},v4MulAdd:function v4MulAddFn(a,b,c,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a[0]*b[0]+c[0];dst[1]=a[1]*b[1]+c[1];dst[2]=a[2]*b[2]+c[2];dst[3]=a[3]*b[3]+c[3];return dst},v4Dot:function v4DotFn(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3]},v4LengthSq:function v4LengthSqFn(a){var a0=a[0];var a1=a[1];var a2=a[2];var a3=a[3];return a0*a0+a1*a1+a2*a2+a3*a3},v4Length:function v4LengthFn(a){var a0=a[0];var a1=a[1];var a2=a[2];var a3=a[3];return Math.sqrt(a0*a0+a1*a1+a2*a2+a3*a3)},v4Reciprocal:function v4ReciprocalFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}var rcp=VMath.reciprocal;dst[0]=rcp(a[0]);dst[1]=rcp(a[1]);dst[2]=rcp(a[2]);dst[3]=rcp(a[3]);return dst},v4Normalize:function v4NormalizeFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}var a0=a[0];var a1=a[1];var a2=a[2];var a3=a[3];var lsq=a0*a0+a1*a1+a2*a2+a3*a3;if(lsq>0){var lr=1/Math.sqrt(lsq);dst[0]=a0*lr;dst[1]=a1*lr;dst[2]=a2*lr;dst[3]=a3*lr}else{dst[0]=0;dst[1]=0;dst[2]=0;dst[3]=0}return dst},v4Abs:function v4AbsFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}var abs=Math.abs;dst[0]=abs(a[0]);dst[1]=abs(a[1]);dst[2]=abs(a[2]);dst[3]=abs(a[3]);return dst},v4Max:function v4MaxFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}var max=Math.max;dst[0]=max(a[0],b[0]);dst[1]=max(a[1],b[1]);dst[2]=max(a[2],b[2]);dst[3]=max(a[3],b[3]);return dst},v4Min:function v4MinFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}var min=Math.min;dst[0]=min(a[0],b[0]);dst[1]=min(a[1],b[1]);dst[2]=min(a[2],b[2]);dst[3]=min(a[3],b[3]);return dst},v4Equal:function v4EqualFn(a,b,precision){var abs=Math.abs;if(precision===undefined){precision=this.precision}return abs(a[0]-b[0])<=precision&&abs(a[1]-b[1])<=precision&&abs(a[2]-b[2])<=precision&&abs(a[3]-b[3])<=precision},v4MaskEqual:function v4MaskEqualFn(a,b){var abs=Math.abs;var precision=VMath.precision;return[abs(a[0]-b[0])<=precision,abs(a[1]-b[1])<=precision,abs(a[2]-b[2])<=precision,abs(a[3]-b[3])<=precision]},v4MaskLess:function v4MaskLessFn(a,b){return[a[0]<b[0],a[1]<b[1],a[2]<b[2],a[3]<b[3]]},v4MaskGreater:function v4MaskGreaterFn(a,b){return[a[0]>b[0],a[1]>b[1],a[2]>b[2],a[3]>b[3]]},v4MaskGreaterEq:function v4MaskGreaterEqFn(a,b){return[a[0]>=b[0],a[1]>=b[1],a[2]>=b[2],a[3]>=b[3]]},v4MaskNot:function v4MaskNotFn(a){return[!a[0],!a[1],!a[2],!a[3]]},v4MaskOr:function v4MaskOrFn(a,b){return[a[0]||b[0],a[1]||b[1],a[2]||b[2],a[3]||b[3]]},v4MaskAnd:function v4MaskAndFn(a,b){return[a[0]&&b[0],a[1]&&b[1],a[2]&&b[2],a[3]&&b[3]]},v4Many:function v4ManyFn(m){return m[0]||m[1]||m[2]||m[3]},v4MaskAll:function v4MaskAllFn(m){return m[0]&&m[1]&&m[2]&&m[3]},v4Select:function v4SelectFn(m,a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=m[0]?a[0]:b[0];dst[1]=m[1]?a[1]:b[1];dst[2]=m[2]?a[2]:b[2];dst[3]=m[3]?a[3]:b[3];return dst},v4ScalarBuild:function v4ScalarBuildFn(a,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a;dst[1]=a;dst[2]=a;dst[3]=a;return dst},v4ScalarMax:function v4ScalarMaxFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}var max=Math.max;dst[0]=max(a[0],b);dst[1]=max(a[1],b);dst[2]=max(a[2],b);dst[3]=max(a[3],b);return dst},v4ScalarMin:function v4ScalarMinFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}var min=Math.min;dst[0]=min(a[0],b);dst[1]=min(a[1],b);dst[2]=min(a[2],b);dst[3]=min(a[3],b);return dst},v4ScalarAdd:function v4ScalarAddFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a[0]+b;dst[1]=a[1]+b;dst[2]=a[2]+b;dst[3]=a[3]+b;return dst},v4ScalarSub:function v4ScalarSubFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a[0]-b;dst[1]=a[1]-b;dst[2]=a[2]-b;dst[3]=a[3]-b;return dst},v4ScalarMul:function v4ScalarMulFn(a,b,dst){if(b===0){return VMath.v4BuildZero(dst)}else{if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a[0]*b;dst[1]=a[1]*b;dst[2]=a[2]*b;dst[3]=a[3]*b;return dst}},v4AddScalarMul:function v4AddScalarMulFn(a,b,c,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a[0]+b[0]*c;dst[1]=a[1]+b[1]*c;dst[2]=a[2]+b[2]*c;dst[3]=a[3]+b[3]*c;return dst},v4ScalarEqual:function v4ScalarEqualFn(a,b){var abs=Math.abs;var precision=VMath.precision;return abs(a[0]-b)<=precision&&abs(a[1]-b)<=precision&&abs(a[2]-b)<=precision&&abs(a[3]-b)<=precision},v4EqualScalarMask:function v4EqualScalarMaskFn(a,b){var abs=Math.abs;var precision=VMath.precision;return[abs(a[0]-b)<=precision,abs(a[1]-b)<=precision,abs(a[2]-b)<=precision,abs(a[3]-b)<=precision]},v4LessScalarMask:function v4LessScalarMaskFn(a,b){return[a[0]<b,a[1]<b,a[2]<b,a[3]<b]},v4GreaterScalarMask:function v4GreaterScalarMaskFn(a,b){return[a[0]>b,a[1]>b,a[2]>b,a[3]>b]},v4GreaterEqScalarMask:function v4GreaterEqScalarMaskFn(a,b){return[a[0]>=b,a[1]>=b,a[2]>=b,a[3]>=b]},v4Lerp:function v4LerpFn(a,b,t,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=a[0]+(b[0]-a[0])*t;dst[1]=a[1]+(b[1]-a[1])*t;dst[2]=a[2]+(b[2]-a[2])*t;dst[3]=a[3]+(b[3]-a[3])*t;return dst},aabbBuild:function aabbBuildFn(a0,a1,a2,a3,a4,a5,dst){if(dst===undefined){dst=new VMathArrayConstructor(6)}dst[0]=a0;dst[1]=a1;dst[2]=a2;dst[3]=a3;dst[4]=a4;dst[5]=a5;return dst},aabbBuildEmpty:function aabbBuildEmptyFn(dst){var float_max=this.FLOAT_MAX;if(dst===undefined){dst=new VMathArrayConstructor(6)}dst[0]=float_max;dst[1]=float_max;dst[2]=float_max;dst[3]=-float_max;dst[4]=-float_max;dst[5]=-float_max;return dst},aabbCopy:function aabbCopyFn(aabb,dst){if(dst===undefined){dst=new VMathArrayConstructor(6)}dst[0]=aabb[0];dst[1]=aabb[1];dst[2]=aabb[2];dst[3]=aabb[3];dst[4]=aabb[4];dst[5]=aabb[5];return dst},aabbSet:function aabbSet(dst,src){dst[0]=src[0];dst[1]=src[1];dst[2]=src[2];dst[3]=src[3];dst[4]=src[4];dst[5]=src[5]},aabbIsEmpty:function aabbIsEmptyFn(aabb){return aabb[0]>aabb[3]},aabbMin:function aabbMinFn(aabb,dst){if(dst===undefined){return aabb.slice(0,3)}dst[0]=aabb[0];dst[1]=aabb[1];dst[2]=aabb[2];return dst},aabbMax:function aabbMaxFn(aabb,dst){if(dst===undefined){return aabb.slice(3,6)}dst[0]=aabb[3];dst[1]=aabb[4];dst[2]=aabb[5];return dst},aabbGetCenterAndHalf:function aabbGetCenterAndHalfFn(aabb,center,half){var cX=(aabb[0]+aabb[3])*.5;var cY=(aabb[1]+aabb[4])*.5;var cZ=(aabb[2]+aabb[5])*.5;center[0]=cX;center[1]=cY;center[2]=cZ;half[0]=aabb[3]-cX;half[1]=aabb[4]-cY;half[2]=aabb[5]-cZ},aabbIsInsidePlanes:function aabbIsInsidePlanesFn(aabb,planes){var numPlanes=planes.length;var n=0;do{var plane=planes[n];var d0=plane[0];var d1=plane[1];var d2=plane[2];if(d0*(d0<0?aabb[0]:aabb[3])+d1*(d1<0?aabb[1]:aabb[4])+d2*(d2<0?aabb[2]:aabb[5])<plane[3]){return false}n+=1}while(n<numPlanes);return true},aabbIsFullyInsidePlanes:function aabbIsFullyInsidePlanesFn(aabb,planes){var numPlanes=planes.length;var n=0;do{var plane=planes[n];var d0=plane[0];var d1=plane[1];var d2=plane[2];if(d0*(d0>0?aabb[0]:aabb[3])+d1*(d1>0?aabb[1]:aabb[4])+d2*(d2>0?aabb[2]:aabb[5])<plane[3]){return false}n+=1}while(n<numPlanes);return true},aabbUnion:function aabbUnionFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(6)}dst[0]=a[0]<b[0]?a[0]:b[0];dst[1]=a[1]<b[1]?a[1]:b[1];dst[2]=a[2]<b[2]?a[2]:b[2];dst[3]=a[3]>b[3]?a[3]:b[3];dst[4]=a[4]>b[4]?a[4]:b[4];dst[5]=a[5]>b[5]?a[5]:b[5];return dst},aabbUnionArray:function aabbUnionArrayFn(aabbArray,dst){if(dst===undefined){dst=new VMathArrayConstructor(6)}VMath.aabbCopy(aabbArray[0],dst);var numAABBs=aabbArray.length;for(var i=0;i<numAABBs;i+=1){var aabb=aabbArray[i];dst[0]=dst[0]<aabb[0]?dst[0]:aabb[0];dst[1]=dst[1]<aabb[1]?dst[1]:aabb[1];dst[2]=dst[2]<aabb[2]?dst[2]:aabb[2];dst[3]=dst[3]>aabb[3]?dst[3]:aabb[3];dst[4]=dst[4]>aabb[4]?dst[4]:aabb[4];dst[5]=dst[5]>aabb[5]?dst[5]:aabb[5]}return dst},aabbAddPoints:function aabbAddPointFn(aabb,ps){var i;var numPoints=ps.length;var r0=aabb[0];var r1=aabb[1];var r2=aabb[2];var r3=aabb[3];var r4=aabb[4];var r5=aabb[5];var p0,p1,p2;for(i=0;i<numPoints;i+=1){p0=ps[i][0];p1=ps[i][1];p2=ps[i][2];r0=r0<p0?r0:p0;r1=r1<p1?r1:p1;r2=r2<p2?r2:p2;r3=r3>p0?r3:p0;r4=r4>p1?r4:p1;r5=r5>p2?r5:p2}aabb[0]=r0;aabb[1]=r1;aabb[2]=r2;aabb[3]=r3;aabb[4]=r4;aabb[5]=r5},aabbTransform:function aabbTransformFn(aabb,matrix,dst){if(dst===undefined){dst=new VMathArrayConstructor(6)}var cX=(aabb[0]+aabb[3])*.5;var cY=(aabb[1]+aabb[4])*.5;var cZ=(aabb[2]+aabb[5])*.5;var hX=aabb[3]-cX;var hY=aabb[4]-cY;var hZ=aabb[5]-cZ;var m0=matrix[0];var m1=matrix[1];var m2=matrix[2];var m3=matrix[3];var m4=matrix[4];var m5=matrix[5];var m6=matrix[6];var m7=matrix[7];var m8=matrix[8];var ctX=matrix[9]+(m0*cX+m3*cY+m6*cZ);var ctY=matrix[10]+(m1*cX+m4*cY+m7*cZ);var ctZ=matrix[11]+(m2*cX+m5*cY+m8*cZ);var abs=Math.abs;var htX=abs(m0)*hX+abs(m3)*hY+abs(m6)*hZ;var htY=abs(m1)*hX+abs(m4)*hY+abs(m7)*hZ;var htZ=abs(m2)*hX+abs(m5)*hY+abs(m8)*hZ;dst[0]=ctX-htX;dst[1]=ctY-htY;dst[2]=ctZ-htZ;dst[3]=ctX+htX;dst[4]=ctY+htY;dst[5]=ctZ+htZ;return dst},aabbIntercept:function aabbInterceptFn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(6)}dst[0]=a[0]>b[0]?a[0]:b[0];dst[1]=a[1]>b[1]?a[1]:b[1];dst[2]=a[2]>b[2]?a[2]:b[2];dst[3]=a[3]<b[3]?a[3]:b[3];dst[4]=a[4]<b[4]?a[4]:b[4];dst[5]=a[5]<b[5]?a[5]:b[5];return dst},aabbOverlaps:function aabbOverlapsFn(a,b){return a[0]<=b[3]&&a[1]<=b[4]&&a[2]<=b[5]&&a[3]>=b[0]&&a[4]>=b[1]&&a[5]>=b[2]},aabbSphereOverlaps:function aabbSphereOverlapsFn(aabb,center,radius){var centerX=center[0];var centerY=center[1];var centerZ=center[2];var radiusSquared=radius*radius;var minX=aabb[0];var minY=aabb[1];var minZ=aabb[2];var maxX=aabb[3];var maxY=aabb[4];var maxZ=aabb[5];var totalDistance=0,sideDistance;if(centerX<minX){sideDistance=minX-centerX;totalDistance+=sideDistance*sideDistance}else if(centerX>maxX){sideDistance=centerX-maxX;totalDistance+=sideDistance*sideDistance}if(centerY<minY){sideDistance=minY-centerY;totalDistance+=sideDistance*sideDistance}else if(centerY>maxY){sideDistance=centerY-maxY;totalDistance+=sideDistance*sideDistance}if(centerZ<minZ){sideDistance=minZ-centerZ;totalDistance+=sideDistance*sideDistance}else if(centerZ>maxZ){sideDistance=centerZ-maxZ;totalDistance+=sideDistance*sideDistance}return totalDistance<=radiusSquared},aabbIsInside:function aabbIsInsideFn(a,b){return a[0]>=b[0]&&a[1]>=b[1]&&a[2]>=b[2]&&a[3]<=b[3]&&a[4]<=b[4]&&a[5]<=b[5]},aabbTestInside:function aabbTestInsideFn(a,b){if(a[0]<=b[3]&&a[1]<=b[4]&&a[2]<=b[5]&&a[3]>=b[0]&&a[4]>=b[1]&&a[5]>=b[2]){if(a[0]>=b[0]&&a[1]>=b[1]&&a[2]>=b[2]&&a[3]<=b[3]&&a[4]<=b[4]&&a[5]<=b[5]){return 2}return 1}return 0},m33BuildIdentity:function m33BuildIdentityFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(9)}dst[0]=1;dst[1]=0;dst[2]=0;dst[3]=0;dst[4]=1;dst[5]=0;dst[6]=0;dst[7]=0;dst[8]=1;return dst},m33Build:function m33BuildFn(r,u,a,dst){var length=arguments.length;if(length>=9){var res;if(length>9){res=arguments[9];if(res===undefined){res=new VMathArrayConstructor(9)}}else{res=new VMathArrayConstructor(9)}res[0]=arguments[0];res[1]=arguments[1];res[2]=arguments[2];res[3]=arguments[3];res[4]=arguments[4];res[5]=arguments[5];res[6]=arguments[6];res[7]=arguments[7];res[8]=arguments[8];return res}else{if(dst===undefined){dst=new VMathArrayConstructor(9)}dst[0]=r[0];dst[1]=r[1];dst[2]=r[2];dst[3]=u[0];dst[4]=u[1];dst[5]=u[2];dst[6]=a[0];dst[7]=a[1];dst[8]=a[2];return dst}},m33Copy:function m33CopyFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(9)}dst[0]=m[0];dst[1]=m[1];dst[2]=m[2];dst[3]=m[3];dst[4]=m[4];dst[5]=m[5];dst[6]=m[6];dst[7]=m[7];dst[8]=m[8];return dst},m33FromAxisRotation:function m33FromAxisRotationFn(axis,angle,dst){if(dst===undefined){dst=new VMathArrayConstructor(9)}var s=Math.sin(angle);var c=Math.cos(angle);var t=1-c;var axisX=axis[0];var axisY=axis[1];var axisZ=axis[2];var tx=t*axisX;var ty=t*axisY;var tz=t*axisZ;var sx=s*axisX;var sy=s*axisY;var sz=s*axisZ;dst[0]=tx*axisX+c;dst[1]=tx*axisY-sz;dst[2]=tx*axisZ+sy;dst[3]=ty*axisX+sz;dst[4]=ty*axisY+c;dst[5]=ty*axisZ-sx;dst[6]=tz*axisX-sy;dst[7]=tz*axisY+sx;dst[8]=tz*axisZ+c;return dst},m33FromQuat:function m33FromQuatFn(q,dst){if(dst===undefined){dst=new VMathArrayConstructor(9)}var qx=q[0];var qy=q[1];var qz=q[2];var qw=q[3];var xx=2*qx*qx;var yy=2*qy*qy;var zz=2*qz*qz;var xy=2*qx*qy;var zw=2*qz*qw;var xz=2*qx*qz;var yw=2*qy*qw;var yz=2*qy*qz;var xw=2*qx*qw;dst[0]=1-yy-zz;dst[1]=xy-zw;dst[2]=xz+yw;dst[3]=xy+zw;dst[4]=1-xx-zz;dst[5]=yz-xw;dst[6]=xz-yw;dst[7]=yz+xw;dst[8]=1-xx-yy;return dst},m33Right:function m33RightFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=m[0];dst[1]=m[1];dst[2]=m[2];return dst},m33Up:function m33UpFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=m[3];dst[1]=m[4];dst[2]=m[5];return dst},m33At:function m33AtFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=m[6];dst[1]=m[7];dst[2]=m[8];return dst},m33SetRight:function m33SetRightFn(m,v){m[0]=v[0];m[1]=v[1];m[2]=v[2]},m33SetUp:function m33SetUpFn(m,v){m[3]=v[0];m[4]=v[1];m[5]=v[2]},m33SetAt:function m33SetAtFn(m,v){m[6]=v[0];m[7]=v[1];m[8]=v[2]},m33Transpose:function m33TransposeFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(9)}var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];dst[0]=m0;dst[1]=m3;dst[2]=m6;dst[3]=m1;dst[4]=m4;dst[5]=m7;dst[6]=m2;dst[7]=m5;dst[8]=m8;return dst},m33Determinant:function m33DeterminantFn(m){var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];return m0*(m4*m8-m5*m7)+m1*(m5*m6-m3*m8)+m2*(m3*m7-m4*m6)},m33Inverse:function m33InverseFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(9)}var det=VMath.m33Determinant(m);if(det===0){dst[0]=dst[1]=dst[2]=0;dst[3]=dst[4]=dst[5]=0;dst[6]=dst[7]=dst[8]=0;return dst}else{var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];var detrecp=1/det;dst[0]=(m4*m8+m5*-m7)*detrecp;dst[1]=(m7*m2+m8*-m1)*detrecp;dst[2]=(m1*m5-m2*m4)*detrecp;dst[3]=(m5*m6+m3*-m8)*detrecp;dst[4]=(m8*m0+m6*-m2)*detrecp;dst[5]=(m3*m2-m0*m5)*detrecp;dst[6]=(m3*m7+m4*-m6)*detrecp;dst[7]=(m6*m1+m7*-m0)*detrecp;dst[8]=(m0*m4-m3*m1)*detrecp;return dst}},m33InverseTranspose:function m33InverseTransposeFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(9)}var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];var det=m0*(m4*m8-m5*m7)+m1*(m5*m6-m3*m8)+m2*(m3*m7-m4*m6);if(det===0){dst[0]=dst[1]=dst[2]=0;dst[3]=dst[4]=dst[5]=0;dst[6]=dst[7]=dst[8]=0;return dst}else{var detrecp=1/det;dst[0]=(m4*m8+m5*-m7)*detrecp;dst[3]=(m7*m2+m8*-m1)*detrecp;dst[6]=(m1*m5-m2*m4)*detrecp;dst[1]=(m5*m6+m3*-m8)*detrecp;dst[4]=(m8*m0+m6*-m2)*detrecp;dst[7]=(m3*m2-m0*m5)*detrecp;dst[2]=(m3*m7+m4*-m6)*detrecp;dst[5]=(m6*m1+m7*-m0)*detrecp;dst[8]=(m0*m4-m3*m1)*detrecp;return dst}},m33Mul:function m33MulFn(a,b,dst){var a0=a[0];var a1=a[1];var a2=a[2];var a3=a[3];var a4=a[4];var a5=a[5];var a6=a[6];var a7=a[7];var a8=a[8];var b0=b[0];var b1=b[1];var b2=b[2];var b3=b[3];var b4=b[4];var b5=b[5];var b6=b[6];var b7=b[7];var b8=b[8];if(dst===undefined){dst=new VMathArrayConstructor(9)}dst[0]=b0*a0+b3*a1+b6*a2;dst[1]=b1*a0+b4*a1+b7*a2;dst[2]=b2*a0+b5*a1+b8*a2;dst[3]=b0*a3+b3*a4+b6*a5;dst[4]=b1*a3+b4*a4+b7*a5;dst[5]=b2*a3+b5*a4+b8*a5;dst[6]=b0*a6+b3*a7+b6*a8;dst[7]=b1*a6+b4*a7+b7*a8;dst[8]=b2*a6+b5*a7+b8*a8;return dst},m33Transform:function m33TransformFn(m,v,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}var v0=v[0];var v1=v[1];var v2=v[2];dst[0]=m[0]*v0+m[3]*v1+m[6]*v2;dst[1]=m[1]*v0+m[4]*v1+m[7]*v2;dst[2]=m[2]*v0+m[5]*v1+m[8]*v2;return dst},m33Equal:function m33EqualFn(a,b,precision){var abs=Math.abs;if(precision===undefined){precision=this.precision}return abs(a[0]-b[0])<=precision&&abs(a[1]-b[1])<=precision&&abs(a[2]-b[2])<=precision&&abs(a[3]-b[3])<=precision&&abs(a[4]-b[4])<=precision&&abs(a[5]-b[5])<=precision&&abs(a[6]-b[6])<=precision&&abs(a[7]-b[7])<=precision&&abs(a[8]-b[8])<=precision},m33MulM43:function m33MulM43Fn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}var a0=a[0];var a1=a[1];var a2=a[2];var a3=a[3];var a4=a[4];var a5=a[5];var a6=a[6];var a7=a[7];var a8=a[8];var b0=b[0];var b1=b[1];var b2=b[2];var b3=b[3];var b4=b[4];var b5=b[5];var b6=b[6];var b7=b[7];var b8=b[8];dst[0]=b0*a0+b3*a1+b6*a2;dst[1]=b1*a0+b4*a1+b7*a2;dst[2]=b2*a0+b5*a1+b8*a2;dst[3]=b0*a3+b3*a4+b6*a5;dst[4]=b1*a3+b4*a4+b7*a5;dst[5]=b2*a3+b5*a4+b8*a5;dst[6]=b0*a6+b3*a7+b6*a8;dst[7]=b1*a6+b4*a7+b7*a8;dst[8]=b2*a6+b5*a7+b8*a8;dst[9]=b[9];dst[10]=b[10];dst[11]=b[11];return dst},m33MulM44:function m33MulM44Fn(a,b,dst){if(dst===undefined){dst=new VMathArrayConstructor(16)}var a0=a[0];var a1=a[1];var a2=a[2];var a3=a[3];var a4=a[4];var a5=a[5];var a6=a[6];var a7=a[7];var a8=a[8];var b0=b[0];var b1=b[1];var b2=b[2];var b3=b[3];var b4=b[4];var b5=b[5];var b6=b[6];var b7=b[7];var b8=b[8];var b9=b[9];var b10=b[10];var b11=b[11];dst[0]=b0*a0+b4*a1+b8*a2;dst[1]=b1*a0+b5*a1+b9*a2;dst[2]=b2*a0+b6*a1+b10*a2;dst[3]=b3*a0+b7*a1+b11*a2;dst[4]=b0*a3+b4*a4+b8*a5;dst[5]=b1*a3+b5*a4+b9*a5;dst[6]=b2*a3+b6*a4+b10*a5;dst[7]=b3*a3+b7*a4+b11*a5;dst[8]=b0*a6+b4*a7+b8*a8;dst[9]=b1*a6+b5*a7+b9*a8;dst[10]=b2*a6+b6*a7+b10*a8;dst[11]=b3*a6+b7*a7+b11*a8;dst[12]=b[12];dst[13]=b[13];dst[14]=b[14];dst[15]=b[15];return dst},m33ScalarAdd:function m33ScalarAddFn(m,s,dst){if(dst===undefined){dst=new VMathArrayConstructor(9)}for(var n=0;n<9;n+=1){dst[n]=m[n]+s}return dst},m33ScalarSub:function m33ScalarSubFn(m,s,dst){if(dst===undefined){dst=new VMathArrayConstructor(9)}for(var n=0;n<9;n+=1){dst[n]=m[n]-s}return dst},m33ScalarMul:function m33ScalarMulFn(m,s,dst){if(dst===undefined){dst=new VMathArrayConstructor(9)}for(var n=0;n<9;n+=1){dst[n]=m[n]*s}return dst},m34BuildIdentity:function m34BuildIdentityFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}dst[0]=1;dst[5]=1;dst[10]=1;
return dst},m34Pos:function m34PosFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=m[3];dst[1]=m[7];dst[2]=m[11];return dst},m34Scale:function m34ScaleFn(m,scale,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}var sx=scale[0];var sy=scale[1];var sz=scale[2];dst[0]=m[0]*sx;dst[1]=m[1]*sx;dst[2]=m[2]*sx;dst[3]=m[3];dst[4]=m[4]*sy;dst[5]=m[5]*sy;dst[6]=m[6]*sy;dst[7]=m[7];dst[8]=m[8]*sz;dst[9]=m[9]*sz;dst[10]=m[10]*sz;dst[11]=m[11];return dst},m43BuildIdentity:function m43BuildIdentityFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}dst[0]=1;dst[1]=0;dst[2]=0;dst[3]=0;dst[4]=1;dst[5]=0;dst[6]=0;dst[7]=0;dst[8]=1;dst[9]=0;dst[10]=0;dst[11]=0;return dst},m43Build:function m43BuildFn(r,u,a,p,dst){var length=arguments.length;if(length>=12){var res;if(length>12){res=arguments[12];if(res===undefined){res=new VMathArrayConstructor(12)}}else{res=new VMathArrayConstructor(12)}res[0]=arguments[0];res[1]=arguments[1];res[2]=arguments[2];res[3]=arguments[3];res[4]=arguments[4];res[5]=arguments[5];res[6]=arguments[6];res[7]=arguments[7];res[8]=arguments[8];res[9]=arguments[9];res[10]=arguments[10];res[11]=arguments[11];return res}else{if(dst===undefined){dst=new VMathArrayConstructor(12)}dst[0]=r[0];dst[1]=r[1];dst[2]=r[2];dst[3]=u[0];dst[4]=u[1];dst[5]=u[2];dst[6]=a[0];dst[7]=a[1];dst[8]=a[2];dst[9]=p[0];dst[10]=p[1];dst[11]=p[2];return dst}},m43BuildTranslation:function m43BuildTranslationFn(p,dst){var res,a;var length=arguments.length;if(length>=3){a=arguments;if(length===4){res=arguments[3]}}else{a=p;res=dst}if(res===undefined){res=new VMathArrayConstructor(12)}res[0]=1;res[1]=0;res[2]=0;res[3]=0;res[4]=1;res[5]=0;res[6]=0;res[7]=0;res[8]=1;res[9]=a[0];res[10]=a[1];res[11]=a[2];return res},m43Copy:function m43CopyFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}dst[0]=m[0];dst[1]=m[1];dst[2]=m[2];dst[3]=m[3];dst[4]=m[4];dst[5]=m[5];dst[6]=m[6];dst[7]=m[7];dst[8]=m[8];dst[9]=m[9];dst[10]=m[10];dst[11]=m[11];return dst},m43FromM33V3:function m43FromM33V3Fn(m,v,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}dst[0]=m[0];dst[1]=m[1];dst[2]=m[2];dst[3]=m[3];dst[4]=m[4];dst[5]=m[5];dst[6]=m[6];dst[7]=m[7];dst[8]=m[8];dst[9]=v[0];dst[10]=v[1];dst[11]=v[2];return dst},m43FromAxisRotation:function m43FromAxisRotationFn(axis,angle,dst){var s=Math.sin(angle);var c=Math.cos(angle);var t=1-c;var axisX=axis[0];var axisY=axis[1];var axisZ=axis[2];var tx=t*axisX;var ty=t*axisY;var tz=t*axisZ;var sx=s*axisX;var sy=s*axisY;var sz=s*axisZ;if(dst===undefined){dst=new VMathArrayConstructor(12)}dst[0]=tx*axisX+c;dst[1]=tx*axisY-sz;dst[2]=tx*axisZ+sy;dst[3]=ty*axisX+sz;dst[4]=ty*axisY+c;dst[5]=ty*axisZ-sx;dst[6]=tz*axisX-sy;dst[7]=tz*axisY+sx;dst[8]=tz*axisZ+c;dst[9]=0;dst[10]=0;dst[11]=0;return dst},m43FromQuatPos:function m43FromQuatPosFn(qp,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}var qx=qp[0];var qy=qp[1];var qz=qp[2];var qw=qp[3];var px=qp[4];var py=qp[5];var pz=qp[6];var xx=2*qx*qx;var yy=2*qy*qy;var zz=2*qz*qz;var xy=2*qx*qy;var zw=2*qz*qw;var xz=2*qx*qz;var yw=2*qy*qw;var yz=2*qy*qz;var xw=2*qx*qw;dst[0]=1-yy-zz;dst[1]=xy-zw;dst[2]=xz+yw;dst[3]=xy+zw;dst[4]=1-xx-zz;dst[5]=yz-xw;dst[6]=xz-yw;dst[7]=yz+xw;dst[8]=1-xx-yy;dst[9]=px;dst[10]=py;dst[11]=pz;return dst},m43FromRTS:function m43FromRTSFn(quat,pos,scale,dst){var qx=quat[0];var qy=quat[1];var qz=quat[2];var qw=quat[3];var xx=2*qx*qx;var yy=2*qy*qy;var zz=2*qz*qz;var xy=2*qx*qy;var zw=2*qz*qw;var xz=2*qx*qz;var yw=2*qy*qw;var yz=2*qy*qz;var xw=2*qx*qw;var sx=scale[0];var sy=scale[1];var sz=scale[2];if(dst===undefined){dst=new VMathArrayConstructor(12)}dst[0]=sx*(1-yy-zz);dst[1]=sx*(xy-zw);dst[2]=sx*(xz+yw);dst[3]=sy*(xy+zw);dst[4]=sy*(1-xx-zz);dst[5]=sy*(yz-xw);dst[6]=sz*(xz-yw);dst[7]=sz*(yz+xw);dst[8]=sz*(1-xx-yy);dst[9]=pos[0];dst[10]=pos[1];dst[11]=pos[2];return dst},m43FromRT:function m43FromRTFn(quat,pos,dst){var qx=quat[0];var qy=quat[1];var qz=quat[2];var qw=quat[3];var xx=2*qx*qx;var yy=2*qy*qy;var zz=2*qz*qz;var xy=2*qx*qy;var zw=2*qz*qw;var xz=2*qx*qz;var yw=2*qy*qw;var yz=2*qy*qz;var xw=2*qx*qw;if(dst===undefined){dst=new VMathArrayConstructor(12)}dst[0]=1-yy-zz;dst[1]=xy-zw;dst[2]=xz+yw;dst[3]=xy+zw;dst[4]=1-xx-zz;dst[5]=yz-xw;dst[6]=xz-yw;dst[7]=yz+xw;dst[8]=1-xx-yy;dst[9]=pos[0];dst[10]=pos[1];dst[11]=pos[2];return dst},m43Right:function m43RightFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=m[0];dst[1]=m[1];dst[2]=m[2];return dst},m43Up:function m43UpFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=m[3];dst[1]=m[4];dst[2]=m[5];return dst},m43At:function m43AtFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=m[6];dst[1]=m[7];dst[2]=m[8];return dst},m43Pos:function m43PosFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=m[9];dst[1]=m[10];dst[2]=m[11];return dst},m43SetRight:function m43SetRightFn(m,v){m[0]=v[0];m[1]=v[1];m[2]=v[2]},m43SetUp:function m43SetUpFn(m,v){m[3]=v[0];m[4]=v[1];m[5]=v[2]},m43SetAt:function m43SetAtFn(m,v){m[6]=v[0];m[7]=v[1];m[8]=v[2]},m43SetPos:function m43SetPosFn(m,v){m[9]=v[0];m[10]=v[1];m[11]=v[2]},m43SetAxisRotation:function m43SetAxisRotationFn(m,axis,angle){var s=Math.sin(angle);var c=Math.cos(angle);var t=1-c;var axisX=axis[0];var axisY=axis[1];var axisZ=axis[2];var tx=t*axisX;var ty=t*axisY;var tz=t*axisZ;var sx=s*axisX;var sy=s*axisY;var sz=s*axisZ;m[0]=tx*axisX+c;m[1]=tx*axisY-sz;m[2]=tx*axisZ+sy;m[3]=ty*axisX+sz;m[4]=ty*axisY+c;m[5]=ty*axisZ-sx;m[6]=tz*axisX-sy;m[7]=tz*axisY+sx;m[8]=tz*axisZ+c},m43InverseOrthonormal:function m43InverseOrthonormalFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];var px=m[9];var py=m[10];var pz=m[11];dst[0]=m0;dst[1]=m3;dst[2]=m6;dst[3]=m1;dst[4]=m4;dst[5]=m7;dst[6]=m2;dst[7]=m5;dst[8]=m8;dst[9]=-(px*m0+py*m1+pz*m2);dst[10]=-(px*m3+py*m4+pz*m5);dst[11]=-(px*m6+py*m7+pz*m8);return dst},m43Orthonormalize:function m43OrthonormalizeFn(m,dst){var normalize=VMath.v3Normalize;var length=VMath.v3Length;var dot=VMath.v3Dot;var cross=VMath.v3Cross;var abs=Math.abs;var right=VMath.m43Right(m);var up=VMath.m43Up(m);var at=VMath.m43At(m);var pos=VMath.m43Pos(m);var innerX=length(right);var innerY=length(up);var innerZ=length(at);normalize(right,right);normalize(up,up);normalize(at,at);var vpU,vpV,vpW;if(innerX>0){if(innerY>0){if(innerZ>0){var outerX=abs(dot(up,at));var outerY=abs(dot(at,right));var outerZ=abs(dot(right,up));if(outerX<outerY){if(outerX<outerZ){vpU=up;vpV=at;vpW=right}else{vpU=right;vpV=up;vpW=at}}else{if(outerY<outerZ){vpU=at;vpV=right;vpW=up}else{vpU=right;vpV=up;vpW=at}}}else{vpU=right;vpV=up;vpW=at}}else{vpU=at;vpV=right;vpW=up}}else{vpU=up;vpV=at;vpW=right}cross(vpU,vpV,vpW);normalize(vpW,vpW);cross(vpW,vpU,vpV);normalize(vpV,vpV);if(dst===undefined){dst=new VMathArrayConstructor(12)}dst[0]=right[0];dst[1]=right[1];dst[2]=right[2];dst[3]=up[0];dst[4]=up[1];dst[5]=up[2];dst[6]=at[0];dst[7]=at[1];dst[8]=at[2];dst[9]=pos[0];dst[10]=pos[1];dst[11]=pos[2];return dst},m43Determinant:function m43DeterminantFn(m){return m[0]*(m[4]*m[8]-m[5]*m[7])+m[1]*(m[5]*m[6]-m[3]*m[8])+m[2]*(m[3]*m[7]-m[4]*m[6])},m43Inverse:function m43InverseFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];var m9=m[9];var m10=m[10];var m11=m[11];var det=m0*(m4*m8-m5*m7)+m1*(m5*m6-m3*m8)+m2*(m3*m7-m4*m6);if(det===0){return dst}else{if(dst===undefined){dst=new VMathArrayConstructor(12)}var detrecp=1/det;dst[0]=(m4*m8+m5*-m7)*detrecp;dst[1]=(m7*m2+m8*-m1)*detrecp;dst[2]=(m1*m5-m2*m4)*detrecp;dst[3]=(m5*m6+m3*-m8)*detrecp;dst[4]=(m8*m0+m6*-m2)*detrecp;dst[5]=(m3*m2-m0*m5)*detrecp;dst[6]=(m3*m7+m4*-m6)*detrecp;dst[7]=(m6*m1+m7*-m0)*detrecp;dst[8]=(m0*m4-m3*m1)*detrecp;dst[9]=(m3*(m10*m8-m7*m11)+m4*(m6*m11-m9*m8)+m5*(m9*m7-m6*m10))*detrecp;dst[10]=(m6*(m2*m10-m1*m11)+m7*(m0*m11-m9*m2)+m8*(m9*m1-m0*m10))*detrecp;dst[11]=(m9*(m2*m4-m1*m5)+m10*(m0*m5-m3*m2)+m11*(m3*m1-m0*m4))*detrecp;return dst}},m43Translate:function m43TranslateFn(matrix,pos){matrix[9]+=pos[0];matrix[10]+=pos[1];matrix[11]+=pos[2]},m43Scale:function m43ScaleFn(m,scale,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}var sx=scale[0];var sy=scale[1];var sz=scale[2];dst[0]=m[0]*sx;dst[1]=m[1]*sx;dst[2]=m[2]*sx;dst[3]=m[3]*sy;dst[4]=m[4]*sy;dst[5]=m[5]*sy;dst[6]=m[6]*sz;dst[7]=m[7]*sz;dst[8]=m[8]*sz;dst[9]=m[9];dst[10]=m[10];dst[11]=m[11];return dst},m43TransformVector:function m43TransformVectorFn(m,v,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}var v0=v[0];var v1=v[1];var v2=v[2];dst[0]=m[0]*v0+m[3]*v1+m[6]*v2;dst[1]=m[1]*v0+m[4]*v1+m[7]*v2;dst[2]=m[2]*v0+m[5]*v1+m[8]*v2;return dst},m43TransformPoint:function m43TransformPointFn(m,v,dst){if(dst===undefined){dst=new VMathArrayConstructor(3)}var v0=v[0];var v1=v[1];var v2=v[2];dst[0]=m[0]*v0+m[3]*v1+m[6]*v2+m[9];dst[1]=m[1]*v0+m[4]*v1+m[7]*v2+m[10];dst[2]=m[2]*v0+m[5]*v1+m[8]*v2+m[11];return dst},m43Mul:function m43MulFn(a,b,dst){var a0=a[0];var a1=a[1];var a2=a[2];var a3=a[3];var a4=a[4];var a5=a[5];var a6=a[6];var a7=a[7];var a8=a[8];var a9=a[9];var a10=a[10];var a11=a[11];var b0=b[0];var b1=b[1];var b2=b[2];var b3=b[3];var b4=b[4];var b5=b[5];var b6=b[6];var b7=b[7];var b8=b[8];if(dst===undefined){dst=new VMathArrayConstructor(12)}dst[0]=b0*a0+b3*a1+b6*a2;dst[1]=b1*a0+b4*a1+b7*a2;dst[2]=b2*a0+b5*a1+b8*a2;dst[3]=b0*a3+b3*a4+b6*a5;dst[4]=b1*a3+b4*a4+b7*a5;dst[5]=b2*a3+b5*a4+b8*a5;dst[6]=b0*a6+b3*a7+b6*a8;dst[7]=b1*a6+b4*a7+b7*a8;dst[8]=b2*a6+b5*a7+b8*a8;dst[9]=b0*a9+b3*a10+b6*a11+b[9];dst[10]=b1*a9+b4*a10+b7*a11+b[10];dst[11]=b2*a9+b5*a10+b8*a11+b[11];return dst},m43MulM44:function m43MulM44Fn(a,b,dst){var a0=a[0];var a1=a[1];var a2=a[2];var a3=a[3];var a4=a[4];var a5=a[5];var a6=a[6];var a7=a[7];var a8=a[8];var a9=a[9];var a10=a[10];var a11=a[11];var b0=b[0];var b1=b[1];var b2=b[2];var b3=b[3];var b4=b[4];var b5=b[5];var b6=b[6];var b7=b[7];var b8=b[8];var b9=b[9];var b10=b[10];var b11=b[11];if(dst===undefined){dst=new VMathArrayConstructor(16)}dst[0]=b0*a0+b4*a1+b8*a2;dst[1]=b1*a0+b5*a1+b9*a2;dst[2]=b2*a0+b6*a1+b10*a2;dst[3]=b3*a0+b7*a1+b11*a2;dst[4]=b0*a3+b4*a4+b8*a5;dst[5]=b1*a3+b5*a4+b9*a5;dst[6]=b2*a3+b6*a4+b10*a5;dst[7]=b3*a3+b7*a4+b11*a5;dst[8]=b0*a6+b4*a7+b8*a8;dst[9]=b1*a6+b5*a7+b9*a8;dst[10]=b2*a6+b6*a7+b10*a8;dst[11]=b3*a6+b7*a7+b11*a8;dst[12]=b0*a9+b4*a10+b8*a11+b[12];dst[13]=b1*a9+b5*a10+b9*a11+b[13];dst[14]=b2*a9+b6*a10+b10*a11+b[14];dst[15]=b3*a9+b7*a10+b11*a11+b[15];return dst},m43Transpose:function m43TransposeFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];var m9=m[9];var m10=m[10];var m11=m[11];dst[0]=m0;dst[1]=m3;dst[2]=m6;dst[3]=m9;dst[4]=m1;dst[5]=m4;dst[6]=m7;dst[7]=m10;dst[8]=m2;dst[9]=m5;dst[10]=m8;dst[11]=m11;return dst},m43MulTranspose:function m43MulTransposeFn(a,b,dst){var a0=a[0];var a1=a[1];var a2=a[2];var a3=a[3];var a4=a[4];var a5=a[5];var a6=a[6];var a7=a[7];var a8=a[8];var a9=a[9];var a10=a[10];var a11=a[11];var b0=b[0];var b1=b[1];var b2=b[2];var b3=b[3];var b4=b[4];var b5=b[5];var b6=b[6];var b7=b[7];var b8=b[8];var b9=b[9];var b10=b[10];var b11=b[11];if(dst===undefined){dst=new VMathArrayConstructor(12)}dst[0]=b0*a0+b3*a1+b6*a2;dst[1]=b0*a3+b3*a4+b6*a5;dst[2]=b0*a6+b3*a7+b6*a8;dst[3]=b0*a9+b3*a10+b6*a11+b9;dst[4]=b1*a0+b4*a1+b7*a2;dst[5]=b1*a3+b4*a4+b7*a5;dst[6]=b1*a6+b4*a7+b7*a8;dst[7]=b1*a9+b4*a10+b7*a11+b10;dst[8]=b2*a0+b5*a1+b8*a2;dst[9]=b2*a3+b5*a4+b8*a5;dst[10]=b2*a6+b5*a7+b8*a8;dst[11]=b2*a9+b5*a10+b8*a11+b11;return dst},m43Offset:function m43OffsetFn(m,o,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];var m9=m[9];var m10=m[10];var m11=m[11];var o0=o[0];var o1=o[1];var o2=o[2];dst[0]=m0;dst[1]=m1;dst[2]=m2;dst[3]=m3;dst[4]=m4;dst[5]=m5;dst[6]=m6;dst[7]=m7;dst[8]=m8;dst[9]=m0*o0+m3*o1+m6*o2+m9;dst[10]=m1*o0+m4*o1+m7*o2+m10;dst[11]=m2*o0+m5*o1+m8*o2+m11;return dst},m43NegOffset:function m43NegOffsetFn(m,o,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];var m9=m[9];var m10=m[10];var m11=m[11];var o0=-o[0];var o1=-o[1];var o2=-o[2];dst[0]=m0;dst[1]=m1;dst[2]=m2;dst[3]=m3;dst[4]=m4;dst[5]=m5;dst[6]=m6;dst[7]=m7;dst[8]=m8;dst[9]=m0*o0+m3*o1+m6*o2+m9;dst[10]=m1*o0+m4*o1+m7*o2+m10;dst[11]=m2*o0+m5*o1+m8*o2+m11;return dst},m43InverseTransposeProjection:function m43InverseTransposeProjectionFn(m,s,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}var xf=.5/s[0];var yf=.5/s[1];var zf=.5/s[2];var m0=m[0]*xf;var m1=m[1]*xf;var m2=m[2]*xf;var m3=m[3]*yf;var m4=m[4]*yf;var m5=m[5]*yf;var m6=m[6]*zf;var m7=m[7]*zf;var m8=m[8]*zf;var px=m[9];var py=m[10];var pz=m[11];dst[0]=m0;dst[1]=m1;dst[2]=m2;dst[3]=.5-(px*m0+py*m1+pz*m2);dst[4]=m3;dst[5]=m4;dst[6]=m5;dst[7]=.5-(px*m3+py*m4+pz*m5);dst[8]=m6;dst[9]=m7;dst[10]=m8;dst[11]=.5-(px*m6+py*m7+pz*m8);return dst},m43ScalarAdd:function m43ScalarAddFn(m,s,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}for(var n=0;n<12;n+=1){dst[n]=m[n]+s}return dst},m43ScalarSub:function m43ScalarSubFn(m,s,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}for(var n=0;n<12;n+=1){dst[n]=m[n]-s}return dst},m43ScalarMul:function m43ScalarMulFn(m,s,dst){if(dst===undefined){dst=new VMathArrayConstructor(12)}for(var n=0;n<12;n+=1){dst[n]=m[n]*s}return dst},m44BuildIdentity:function m44BuildIdentityFn(dst){if(dst===undefined){dst=new VMathArrayConstructor(16)}dst[0]=1;dst[1]=0;dst[2]=0;dst[3]=0;dst[4]=0;dst[5]=1;dst[6]=0;dst[7]=0;dst[8]=0;dst[9]=0;dst[10]=1;dst[11]=0;dst[12]=0;dst[13]=0;dst[14]=0;dst[15]=1;return dst},m44Build:function m44BuildFn(r,u,a,p,dst){var length=arguments.length;if(length>=16){var res;if(length>16){res=arguments[16];if(res===undefined){res=new VMathArrayConstructor(16)}}else{res=new VMathArrayConstructor(16)}res[0]=arguments[0];res[1]=arguments[1];res[2]=arguments[2];res[3]=arguments[3];res[4]=arguments[4];res[5]=arguments[5];res[6]=arguments[6];res[7]=arguments[7];res[8]=arguments[8];res[9]=arguments[9];res[10]=arguments[10];res[11]=arguments[11];res[12]=arguments[12];res[13]=arguments[13];res[14]=arguments[14];res[15]=arguments[15];return res}else{if(dst===undefined){dst=new VMathArrayConstructor(16)}dst[0]=r[0];dst[1]=r[1];dst[2]=r[2];dst[3]=r[3];dst[4]=u[0];dst[5]=u[1];dst[6]=u[2];dst[7]=u[3];dst[8]=a[0];dst[9]=a[1];dst[10]=a[2];dst[11]=a[3];dst[12]=p[0];dst[13]=p[1];dst[14]=p[2];dst[15]=p[3];return dst}},m44Copy:function m44CopyFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(16)}dst[0]=m[0];dst[1]=m[1];dst[2]=m[2];dst[3]=m[3];dst[4]=m[4];dst[5]=m[5];dst[6]=m[6];dst[7]=m[7];dst[8]=m[8];dst[9]=m[9];dst[10]=m[10];dst[11]=m[11];dst[12]=m[12];dst[13]=m[13];dst[14]=m[14];dst[15]=m[15];return dst},m44Right:function m44RightFn(m,dst){if(dst===undefined){return m.slice(0,4)}dst[0]=m[0];dst[1]=m[1];dst[2]=m[2];dst[3]=m[3];return dst},m44Up:function m44UpFn(m,dst){if(dst===undefined){return m.slice(4,8)}dst[0]=m[4];dst[1]=m[5];dst[2]=m[6];dst[3]=m[7];return dst},m44At:function m44AtFn(m,dst){if(dst===undefined){return m.slice(8,12)}dst[0]=m[8];dst[1]=m[9];dst[2]=m[10];dst[3]=m[11];return dst},m44Pos:function m44PosFn(m,dst){if(dst===undefined){return m.slice(12)}dst[0]=m[12];dst[1]=m[13];dst[2]=m[14];dst[3]=m[15];return dst},m44SetRight:function m44SetRightFn(m,v){m[0]=v[0];m[1]=v[1];m[2]=v[2];m[3]=v[3]},m44SetUp:function m44SetUpFn(m,v){m[4]=v[0];m[5]=v[1];m[6]=v[2];m[7]=v[3]},m44SetAt:function m44SetAtFn(m,v){m[8]=v[0];m[9]=v[1];m[10]=v[2];m[11]=v[3]},m44SetPos:function m44SetPosFn(m,v){m[12]=v[0];m[13]=v[1];m[14]=v[2];m[15]=v[3]},m44Translate:function m44TranslateFn(m,v){m[12]+=v[0];m[13]+=v[1];m[14]+=v[2];m[15]+=v[3]},m44Scale:function m44ScaleFn(m,scale,dst){if(dst===undefined){dst=new VMathArrayConstructor(16)}dst[0]=m[0]*scale[0];dst[1]=m[1]*scale[0];dst[2]=m[2]*scale[0];dst[3]=m[3];dst[4]=m[4]*scale[1];dst[5]=m[5]*scale[1];dst[6]=m[6]*scale[1];dst[7]=m[7];dst[8]=m[8]*scale[2];dst[9]=m[9]*scale[2];dst[10]=m[10]*scale[2];dst[11]=m[11];dst[12]=m[12];dst[13]=m[13];dst[14]=m[14];dst[15]=m[15];return dst},m44Transform:function m44TransformFn(m,v,dst){var v0=v[0];var v1=v[1];var v2=v[2];var v3=v[3];if(dst===undefined){dst=new VMathArrayConstructor(4)}if(v3!==1){dst[0]=m[0]*v0+m[4]*v1+m[8]*v2+m[12]*v3;dst[1]=m[1]*v0+m[5]*v1+m[9]*v2+m[13]*v3;dst[2]=m[2]*v0+m[6]*v1+m[10]*v2+m[14]*v3;dst[3]=m[3]*v0+m[7]*v1+m[11]*v2+m[15]*v3}else{dst[0]=m[0]*v0+m[4]*v1+m[8]*v2+m[12];dst[1]=m[1]*v0+m[5]*v1+m[9]*v2+m[13];dst[2]=m[2]*v0+m[6]*v1+m[10]*v2+m[14];dst[3]=m[3]*v0+m[7]*v1+m[11]*v2+m[15]}return dst},m44Mul:function m44MulFn(a,b,dst){var a0=a[0];var a1=a[1];var a2=a[2];var a3=a[3];var a4=a[4];var a5=a[5];var a6=a[6];var a7=a[7];var a8=a[8];var a9=a[9];var a10=a[10];var a11=a[11];var a12=a[12];var a13=a[13];var a14=a[14];var a15=a[15];var b0=b[0];var b1=b[1];var b2=b[2];var b3=b[3];var b4=b[4];var b5=b[5];var b6=b[6];var b7=b[7];var b8=b[8];var b9=b[9];var b10=b[10];var b11=b[11];var b12=b[12];var b13=b[13];var b14=b[14];var b15=b[15];if(dst===undefined){dst=new VMathArrayConstructor(16)}dst[0]=b0*a0+b4*a1+b8*a2+b12*a3;dst[1]=b1*a0+b5*a1+b9*a2+b13*a3;dst[2]=b2*a0+b6*a1+b10*a2+b14*a3;dst[3]=b3*a0+b7*a1+b11*a2+b15*a3;dst[4]=b0*a4+b4*a5+b8*a6+b12*a7;dst[5]=b1*a4+b5*a5+b9*a6+b13*a7;dst[6]=b2*a4+b6*a5+b10*a6+b14*a7;dst[7]=b3*a4+b7*a5+b11*a6+b15*a7;dst[8]=b0*a8+b4*a9+b8*a10+b12*a11;dst[9]=b1*a8+b5*a9+b9*a10+b13*a11;dst[10]=b2*a8+b6*a9+b10*a10+b14*a11;dst[11]=b3*a8+b7*a9+b11*a10+b15*a11;dst[12]=b0*a12+b4*a13+b8*a14+b12*a15;dst[13]=b1*a12+b5*a13+b9*a14+b13*a15;dst[14]=b2*a12+b6*a13+b10*a14+b14*a15;dst[15]=b3*a12+b7*a13+b11*a14+b15*a15;return dst},m44Inverse:function m44InverseFn(m,dst){var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];var m9=m[9];var m10=m[10];var m11=m[11];var m12=m[12];var m13=m[13];var m14=m[14];var m15=m[15];if(dst===undefined){dst=new VMathArrayConstructor(16)}var A0=m0*m5-m1*m4;var A1=m0*m6-m2*m4;var A2=m0*m7-m3*m4;var A3=m1*m6-m2*m5;var A4=m1*m7-m3*m5;var A5=m2*m7-m3*m6;var B0=m8*m13-m9*m12;var B1=m8*m14-m10*m12;var B2=m8*m15-m11*m12;var B3=m9*m14-m10*m13;var B4=m9*m15-m11*m13;var B5=m10*m15-m11*m14;var det=A0*B5-A1*B4+A2*B3+A3*B2-A4*B1+A5*B0;if(det===0){dst[0]=0;dst[1]=0;dst[2]=0;dst[3]=0;dst[4]=0;dst[5]=0;dst[6]=0;dst[7]=0;dst[8]=0;dst[9]=0;dst[10]=0;dst[11]=0;dst[12]=0;dst[13]=0;dst[14]=0;dst[15]=0}else{var detrecp=1/det;dst[0]=(+(m5*B5)-m6*B4+m7*B3)*detrecp;dst[4]=(-(m4*B5)+m6*B2-m7*B1)*detrecp;dst[8]=(+(m4*B4)-m5*B2+m7*B0)*detrecp;dst[12]=(-(m4*B3)+m5*B1-m6*B0)*detrecp;dst[1]=(-(m1*B5)+m2*B4-m3*B3)*detrecp;dst[5]=(+(m0*B5)-m2*B2+m3*B1)*detrecp;dst[9]=(-(m0*B4)+m1*B2-m3*B0)*detrecp;dst[13]=(+(m0*B3)-m1*B1+m2*B0)*detrecp;dst[2]=(+(m13*A5)-m14*A4+m15*A3)*detrecp;dst[6]=(-(m12*A5)+m14*A2-m15*A1)*detrecp;dst[10]=(+(m12*A4)-m13*A2+m15*A0)*detrecp;dst[14]=(-(m12*A3)+m13*A1-m14*A0)*detrecp;dst[3]=(-(m9*A5)+m10*A4-m11*A3)*detrecp;dst[7]=(+(m8*A5)-m10*A2+m11*A1)*detrecp;dst[11]=(-(m8*A4)+m9*A2-m11*A0)*detrecp;dst[15]=(+(m8*A3)-m9*A1+m10*A0)*detrecp}return dst},m44Transpose:function m44TransposeFn(m,dst){if(dst===undefined){dst=new VMathArrayConstructor(16)}dst[0]=m[0];dst[1]=m[4];dst[2]=m[8];dst[3]=m[12];dst[4]=m[1];dst[5]=m[5];dst[6]=m[9];dst[7]=m[13];dst[8]=m[2];dst[9]=m[6];dst[10]=m[10];dst[11]=m[14];dst[12]=m[3];dst[13]=m[7];dst[14]=m[11];dst[15]=m[15];return dst},m44ScalarAdd:function m44ScalarAddFn(m,s,dst){if(dst===undefined){dst=new VMathArrayConstructor(16)}for(var n=0;n<16;n+=1){dst[n]=m[n]+s}return dst},m44ScalarSub:function m44ScalarSubFn(m,s,dst){if(dst===undefined){dst=new VMathArrayConstructor(16)}for(var n=0;n<16;n+=1){dst[n]=m[n]-s}return dst},m44ScalarMul:function m44ScalarMulFn(m,s,dst){if(dst===undefined){dst=new VMathArrayConstructor(16)}for(var n=0;n<16;n+=1){dst[n]=m[n]*s}return dst},quatBuild:function quatBuildFn(x,y,z,w,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=x;dst[1]=y;dst[2]=z;dst[3]=w;return dst},quatCopy:function quatCopyFn(src,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=src[0];dst[1]=src[1];dst[2]=src[2];dst[3]=src[3];return dst},quatIsSimilar:function quatIsSimilarFn(q1,q2,precision){if(precision===undefined){precision=this.precision}var q1temp=q1;if(q1[3]*q2[3]<0){q1temp=VMath.v4Neg(q1)}var mag_sqrd=VMath.v4LengthSq(VMath.v4Sub(q1temp,q2));var epsilon_sqrd=precision*precision;return mag_sqrd<epsilon_sqrd},quatLength:function quatLengthFn(q){return VMath.v4Length(q)},quatDot:function quatDotFn(q1,q2){return VMath.v4Dot(q1,q2)},quatMul:function quatMulFn(q1,q2,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}var q2x=q1[0];var q2y=q1[1];var q2z=q1[2];var q2w=q1[3];var q1x=q2[0];var q1y=q2[1];var q1z=q2[2];var q1w=q2[3];var cx=q1z*q2y-q1y*q2z;var cy=q1x*q2z-q1z*q2x;var cz=q1y*q2x-q1x*q2y;dst[0]=q2x*q1w+q1x*q2w+cx;dst[1]=q2y*q1w+q1y*q2w+cy;dst[2]=q2z*q1w+q1z*q2w+cz;dst[3]=q1w*q2w-(q1x*q2x+q1y*q2y+q1z*q2z);return dst},quatMulTranslate:function quatMulTranslateFn(qa,va,qb,vb,qr,vr){var qax=qa[0];var qay=qa[1];var qaz=qa[2];var qaw=qa[3];var qbx=qb[0];var qby=qb[1];var qbz=qb[2];var qbw=qb[3];var cx=qaz*qby-qay*qbz;var cy=qax*qbz-qaz*qbx;var cz=qay*qbx-qax*qby;qr[0]=qbx*qaw+qax*qbw+cx;qr[1]=qby*qaw+qay*qbw+cy;qr[2]=qbz*qaw+qaz*qbw+cz;qr[3]=qaw*qbw-(qax*qbx+qay*qby+qaz*qbz);var vax=va[0];var vay=va[1];var vaz=va[2];var vbx=vb[0];var vby=vb[1];var vbz=vb[2];var s=qaw*qaw-(qax*qax+qay*qay+qaz*qaz);var rx=vbx*s;var ry=vby*s;var rz=vbz*s;s=qax*vbx+qay*vby+qaz*vbz;var twoS=s+s;rx+=qax*twoS;ry+=qay*twoS;rz+=qaz*twoS;cx=qaz*vby-qay*vbz;cy=qax*vbz-qaz*vbx;cz=qay*vbx-qax*vby;var twoQw=qaw+qaw;rx+=cx*twoQw;ry+=cy*twoQw;rz+=cz*twoQw;vr[0]=rx+vax;vr[1]=ry+vay;vr[2]=rz+vaz},quatNormalize:function quatNormalizeFn(q,dst){var norme=VMath.quatDot(q,q);if(norme===0){return VMath.v4BuildZero(dst)}else{var recip=1/Math.sqrt(norme);return VMath.v4ScalarMul(q,recip,dst)}},quatConjugate:function quatConjugateFn(q,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=-q[0];dst[1]=-q[1];dst[2]=-q[2];dst[3]=q[3];return dst},quatLerp:function quatLerpFn(q1,q2,t,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}var q1x=q1[0];var q1y=q1[1];var q1z=q1[2];var q1w=q1[3];var q2x=q2[0];var q2y=q2[1];var q2z=q2[2];var q2w=q2[3];dst[0]=(q2x-q1x)*t+q1x;dst[1]=(q2y-q1y)*t+q1y;dst[2]=(q2z-q1z)*t+q1z;dst[3]=(q2w-q1w)*t+q1w;return dst},cosMinSlerpAngle:Math.cos(Math.PI/40),quatSlerp:function quatSlerpFn(q1,q2,t,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}var q1x=q1[0];var q1y=q1[1];var q1z=q1[2];var q1w=q1[3];var q2x=q2[0];var q2y=q2[1];var q2z=q2[2];var q2w=q2[3];var dotq1q2=q1x*q2x+q1y*q2y+q1z*q2z+q1w*q2w;var cosom=dotq1q2;if(cosom<0){q1x=-q1x;q1y=-q1y;q1z=-q1z;q1w=-q1w;cosom=-cosom}if(cosom>VMath.cosMinSlerpAngle){var delta=t;if(dotq1q2<=0){delta=-t}var qrx=(q2x-q1x)*delta+q1x;var qry=(q2y-q1y)*delta+q1y;var qrz=(q2z-q1z)*delta+q1z;var qrw=(q2w-q1w)*delta+q1w;var mag=Math.sqrt(qrx*qrx+qry*qry+qrz*qrz+qrw*qrw);var recip=1/mag;dst[0]=qrx*recip;dst[1]=qry*recip;dst[2]=qrz*recip;dst[3]=qrw*recip;return dst}var sinFn=Math.sin;var omega=Math.acos(cosom);var inv_sin_omega=1/sinFn(omega);var scalar=sinFn((1-t)*omega)*inv_sin_omega;q1x=q1x*scalar;q1y=q1y*scalar;q1z=q1z*scalar;q1w=q1w*scalar;scalar=sinFn(t*omega)*inv_sin_omega;q2x=q2x*scalar;q2y=q2y*scalar;q2z=q2z*scalar;q2w=q2w*scalar;dst[0]=q1x+q2x;dst[1]=q1y+q2y;dst[2]=q1z+q2z;dst[3]=q1w+q2w;return dst},quatFromM43:function quatFromM43Fn(m,dst){var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];var x,y,z,w,s;var trace=m0+m4+m8+1;if(trace>VMath.precision){w=Math.sqrt(trace)/2;x=(m5-m7)/(4*w);y=(m6-m2)/(4*w);z=(m1-m3)/(4*w)}else{if(m0>m4&&m0>m8){s=Math.sqrt(1+m0-m4-m8)*2;w=(m5-m7)/s;x=.25*s;y=(m3+m1)/s;z=(m6+m2)/s}else if(m4>m8){s=Math.sqrt(1+m4-m0-m8)*2;w=(m6-m2)/s;x=(m3+m1)/s;y=.25*s;z=(m7+m5)/s}else{s=Math.sqrt(1+m8-m0-m4)*2;w=(m1-m3)/s;x=(m6+m2)/s;y=(m7+m5)/s;z=.25*s}}var q=VMath.quatNormalize([x,y,z,w],dst);return VMath.quatConjugate(q,dst)},quatFromAxisRotation:function quatFromAxisRotationFn(axis,angle,dst){var omega=.5*angle;var s=Math.sin(omega);var c=Math.cos(omega);if(dst===undefined){dst=new VMathArrayConstructor(4)}dst[0]=axis[0]*s;dst[1]=axis[1]*s;dst[2]=axis[2]*s;dst[3]=c;return VMath.quatNormalize(dst,dst)},quatToAxisRotation:function quatToAxisRotation(q,dst){if(dst===undefined){dst=new VMathArrayConstructor(4)}var q3=q[3];var angle=Math.acos(q3)*2;var sin_sqrd=1-q3*q3;if(sin_sqrd<VMath.precision){dst[0]=1;dst[1]=0;dst[2]=0;dst[3]=angle}else{var scale=1/Math.sqrt(sin_sqrd);dst[0]=q[0]*scale;dst[1]=q[1]*scale;dst[2]=q[2]*scale;dst[3]=angle}return dst},quatTransformVector:function quatTransformVectorFn(q,v,dst){var qx=q[0];var qy=q[1];var qz=q[2];var qw=q[3];var vx=v[0];var vy=v[1];var vz=v[2];var s=qw*qw-(qx*qx+qy*qy+qz*qz);var rx=vx*s;var ry=vy*s;var rz=vz*s;s=qx*vx+qy*vy+qz*vz;var twoS=s+s;rx+=qx*twoS;ry+=qy*twoS;rz+=qz*twoS;var cx=qz*vy-qy*vz;var cy=qx*vz-qz*vx;var cz=qy*vx-qx*vy;var twoQw=qw+qw;rx+=cx*twoQw;ry+=cy*twoQw;rz+=cz*twoQw;if(dst===undefined){dst=new VMathArrayConstructor(3)}dst[0]=rx;dst[1]=ry;dst[2]=rz;return dst},quatEqual:function quatEqual(q1,q2,precision){if(precision===undefined){precision=this.precision}var abs=Math.abs;return abs(q1[0]-q2[0])<=precision&&abs(q1[1]-q2[1])<=precision&&abs(q1[2]-q2[2])<=precision&&abs(q1[3]-q2[3])<=precision},quatPosBuild:function quatPosBuildFn(x,y,z,w,px,py,pz,dst){if(arguments.length<7){if(z===undefined){z=new VMathArrayConstructor(7)}z[0]=x[0];z[1]=x[1];z[2]=x[2];z[3]=x[3];z[4]=y[0];z[5]=y[1];z[6]=y[2];return z}else{if(dst===undefined){dst=new VMathArrayConstructor(7)}dst[0]=x;dst[1]=y;dst[2]=z;dst[3]=w;dst[4]=px;dst[5]=py;dst[6]=pz;return dst}},quatPosTransformVector:function quatPosTransformVectorFn(qp,n,dst){return VMath.quatTransformVector(qp,n,dst)},quatPosTransformPoint:function quatPosTransformPointFn(qp,p){var offset=qp.slice(4,7);var rotatedp=VMath.quatTransformVector(qp,p);return VMath.v3Add(rotatedp,offset)},quatPosMul:function quatPosMulFn(qp1,qp2){var v2=qp2.slice(4,7);var qr=VMath.quatMul(qp1,qp2);var pr=VMath.quatPosTransformPoint(qp1,v2);qr[4]=pr[0];qr[5]=pr[1];qr[6]=pr[2];return qr},isVisibleBox:function isVisibleBoxFn(center,halfDimensions,vpm){var abs=Math.abs;var c0=center[0];var c1=center[1];var c2=center[2];var h0=halfDimensions[0];var h1=halfDimensions[1];var h2=halfDimensions[2];var m0=vpm[0];var m1=vpm[1];var m2=vpm[2];var m3=vpm[3];var m4=vpm[4];var m5=vpm[5];var m6=vpm[6];var m7=vpm[7];var m8=vpm[8];var m9=vpm[9];var m10=vpm[10];var m11=vpm[11];var I0=m0*h0;var I1=m1*h0;var I2=m2*h0;var I3=m3*h0;var J0=m4*h1;var J1=m5*h1;var J2=m6*h1;var J3=m7*h1;var K0=m8*h2;var K1=m9*h2;var K2=m10*h2;var K3=m11*h2;var T0=m0*c0+m4*c1+m8*c2+vpm[12];var T1=m1*c0+m5*c1+m9*c2+vpm[13];var T2=m2*c0+m6*c1+m10*c2+vpm[14];var T3=m3*c0+m7*c1+m11*c2+vpm[15];return!(T0-T3>abs(I0-I3)+abs(J0-J3)+abs(K0-K3)||T0+T3<-(abs(I0+I3)+abs(J0+J3)+abs(K0+K3))||T1-T3>abs(I1-I3)+abs(J1-J3)+abs(K1-K3)||T1+T3<-(abs(I1+I3)+abs(J1+J3)+abs(K1+K3))||T2-T3>abs(I2-I3)+abs(J2-J3)+abs(K2-K3)||T2+T3<-(abs(I2+I3)+abs(J2+J3)+abs(K2+K3))||T3+T3<-(abs(I3+I3)+abs(J3+J3)+abs(K3+K3)))},isVisibleBoxOrigin:function isVisibleBoxOriginFn(halfDimensions,vpm){var abs=Math.abs;var h0=halfDimensions[0];var h1=halfDimensions[1];var h2=halfDimensions[2];var I0=vpm[0]*h0;var I1=vpm[1]*h0;var I2=vpm[2]*h0;var I3=vpm[3]*h0;var J0=vpm[4]*h1;var J1=vpm[5]*h1;var J2=vpm[6]*h1;var J3=vpm[7]*h1;var K0=vpm[8]*h2;var K1=vpm[9]*h2;var K2=vpm[10]*h2;var K3=vpm[11]*h2;var T0=vpm[12];var T1=vpm[13];var T2=vpm[14];var T3=vpm[15];return!(T0-T3>abs(I0-I3)+abs(J0-J3)+abs(K0-K3)||T0+T3<-(abs(I0+I3)+abs(J0+J3)+abs(K0+K3))||T1-T3>abs(I1-I3)+abs(J1-J3)+abs(K1-K3)||T1+T3<-(abs(I1+I3)+abs(J1+J3)+abs(K1+K3))||T2-T3>abs(I2-I3)+abs(J2-J3)+abs(K2-K3)||T2+T3<-(abs(I2+I3)+abs(J2+J3)+abs(K2+K3))||T3+T3<-(abs(I3+I3)+abs(J3+J3)+abs(K3+K3)))},isVisibleSphere:function isVisibleSphereFn(center,radius,vpm){var abs=Math.abs;var c0=center[0];var c1=center[1];var c2=center[2];var m0=vpm[0];var m1=vpm[1];var m2=vpm[2];var m3=vpm[3];var m4=vpm[4];var m5=vpm[5];var m6=vpm[6];var m7=vpm[7];var m8=vpm[8];var m9=vpm[9];var m10=vpm[10];var m11=vpm[11];var I0=m0;var I1=m1;var I2=m2;var I3=m3;var J0=m4;var J1=m5;var J2=m6;var J3=m7;var K0=m8;var K1=m9;var K2=m10;var K3=m11;var T0=m0*c0+m4*c1+m8*c2+vpm[12];var T1=m1*c0+m5*c1+m9*c2+vpm[13];var T2=m2*c0+m6*c1+m10*c2+vpm[14];var T3=m3*c0+m7*c1+m11*c2+vpm[15];var nradius=-radius;return!(T0-T3>radius*(abs(I0-I3)+abs(J0-J3)+abs(K0-K3))||T0+T3<nradius*(abs(I0+I3)+abs(J0+J3)+abs(K0+K3))||T1-T3>radius*(abs(I1-I3)+abs(J1-J3)+abs(K1-K3))||T1+T3<nradius*(abs(I1+I3)+abs(J1+J3)+abs(K1+K3))||T2-T3>radius*(abs(I2-I3)+abs(J2-J3)+abs(K2-K3))||T2+T3<nradius*(abs(I2+I3)+abs(J2+J3)+abs(K2+K3))||T3+T3<nradius*(abs(I3+I3)+abs(J3+J3)+abs(K3+K3)))},isVisibleSphereOrigin:function isVisibleSphereOriginFn(radius,vpm){var abs=Math.abs;var I0=vpm[0];var I1=vpm[1];var I2=vpm[2];var I3=vpm[3];var J0=vpm[4];var J1=vpm[5];var J2=vpm[6];var J3=vpm[7];var K0=vpm[8];var K1=vpm[9];var K2=vpm[10];var K3=vpm[11];var T0=vpm[12];var T1=vpm[13];var T2=vpm[14];var T3=vpm[15];var nradius=-radius;return!(T0-T3>radius*(abs(I0-I3)+abs(J0-J3)+abs(K0-K3))||T0+T3<nradius*(abs(I0+I3)+abs(J0+J3)+abs(K0+K3))||T1-T3>radius*(abs(I1-I3)+abs(J1-J3)+abs(K1-K3))||T1+T3<nradius*(abs(I1+I3)+abs(J1+J3)+abs(K1+K3))||T2-T3>radius*(abs(I2-I3)+abs(J2-J3)+abs(K2-K3))||T2+T3<nradius*(abs(I2+I3)+abs(J2+J3)+abs(K2+K3))||T3+T3<nradius*(abs(I3+I3)+abs(J3+J3)+abs(K3+K3)))},isVisibleSphereUnit:function isVisibleSphereUnitFn(vpm){var abs=Math.abs;var I0=vpm[0];var I1=vpm[1];var I2=vpm[2];var I3=vpm[3];var J0=vpm[4];var J1=vpm[5];var J2=vpm[6];var J3=vpm[7];var K0=vpm[8];var K1=vpm[9];var K2=vpm[10];var K3=vpm[11];var T0=vpm[12];var T1=vpm[13];var T2=vpm[14];var T3=vpm[15];return!(T0-T3>abs(I0-I3)+abs(J0-J3)+abs(K0-K3)||T0+T3<-(abs(I0+I3)+abs(J0+J3)+abs(K0+K3))||T1-T3>abs(I1-I3)+abs(J1-J3)+abs(K1-K3)||T1+T3<-(abs(I1+I3)+abs(J1+J3)+abs(K1+K3))||T2-T3>abs(I2-I3)+abs(J2-J3)+abs(K2-K3)||T2+T3<-(abs(I2+I3)+abs(J2+J3)+abs(K2+K3))||T3+T3<-(abs(I3+I3)+abs(J3+J3)+abs(K3+K3)))},transformBox:function transformBoxFn(center,halfExtents,matrix){var abs=Math.abs;var m0=matrix[0];var m1=matrix[1];var m2=matrix[2];var m3=matrix[3];var m4=matrix[4];var m5=matrix[5];var m6=matrix[6];var m7=matrix[7];var m8=matrix[8];var c0=center[0];var c1=center[1];var c2=center[2];var h0=halfExtents[0];var h1=halfExtents[1];var h2=halfExtents[2];var out_center=new VMathArrayConstructor(3);out_center[0]=m0*c0+m3*c1+m6*c2+matrix[9];out_center[1]=m1*c0+m4*c1+m7*c2+matrix[10];out_center[2]=m2*c0+m5*c1+m8*c2+matrix[11];var out_halfext=new VMathArrayConstructor(3);out_halfext[0]=abs(m0)*h0+abs(m3)*h1+abs(m6)*h2;out_halfext[1]=abs(m1)*h0+abs(m4)*h1+abs(m7)*h2;out_halfext[2]=abs(m2)*h0+abs(m5)*h1+abs(m8)*h2;return{center:out_center,halfExtents:out_center}},planeNormalize:function planeNormalizeFn(plane,output){if(output===undefined){output=new VMathArrayConstructor(4)}var a=plane[0];var b=plane[1];var c=plane[2];var lsq=a*a+b*b+c*c;if(lsq>0){var lr=1/Math.sqrt(lsq);output[0]=a*lr;output[1]=b*lr;output[2]=c*lr;output[3]=plane[3]*lr}else{output[0]=0;output[1]=0;output[2]=0;output[3]=0}return output},extractFrustumPlanes:function extractFrustumPlanesFn(m,p){var planeNormalize=VMath.planeNormalize;var m0=m[0];var m1=m[1];var m2=m[2];var m3=m[3];var m4=m[4];var m5=m[5];var m6=m[6];var m7=m[7];var m8=m[8];var m9=m[9];var m10=m[10];var m11=m[11];var m12=m[12];var m13=m[13];var m14=m[14];var m15=m[15];var planes=p||[];planes[0]=planeNormalize([m3+m0,m7+m4,m11+m8,-(m15+m12)],planes[0]);planes[1]=planeNormalize([m3-m0,m7-m4,m11-m8,-(m15-m12)],planes[1]);planes[2]=planeNormalize([m3-m1,m7-m5,m11-m9,-(m15-m13)],planes[2]);
planes[3]=planeNormalize([m3+m1,m7+m5,m11+m9,-(m15+m13)],planes[3]);planes[4]=planeNormalize([m3+m2,m7+m6,m11+m10,-(m15+m14)],planes[4]);planes[5]=planeNormalize([m3-m2,m7-m6,m11-m10,-(m15-m14)],planes[5]);return planes},isInsidePlanesPoint:function isInsidePlanesPointFn(p,planes){var p0=p[0];var p1=p[1];var p2=p[2];var numPlanes=planes.length;var n=0;do{var plane=planes[n];if(plane[0]*p0+plane[1]*p1+plane[2]*p2<plane[3]){return false}n+=1}while(n<numPlanes);return true},isInsidePlanesSphere:function isInsidePlanesSphereFn(c,r,planes){var c0=c[0];var c1=c[1];var c2=c[2];var numPlanes=planes.length;var n=0;do{var plane=planes[n];if(plane[0]*c0+plane[1]*c1+plane[2]*c2<plane[3]-r){return false}n+=1}while(n<numPlanes);return true},isInsidePlanesBox:function isInsidePlanesBoxFn(c,h,planes){var c0=c[0];var c1=c[1];var c2=c[2];var h0=h[0];var h1=h[1];var h2=h[2];var p0=c0+h0;var p1=c1+h1;var p2=c2+h2;var n0=c0-h0;var n1=c1-h1;var n2=c2-h2;var numPlanes=planes.length;var n=0;do{var plane=planes[n];var d0=plane[0];var d1=plane[1];var d2=plane[2];if(d0*(d0<0?n0:p0)+d1*(d1<0?n1:p1)+d2*(d2<0?n2:p2)<plane[3]){return false}n+=1}while(n<numPlanes);return true},extractIntersectingPlanes:function extractIntersectingPlanesFn(extents,planes){var n0=extents[0];var n1=extents[1];var n2=extents[2];var p0=extents[3];var p1=extents[4];var p2=extents[5];var numPlanes=planes.length;var p=[];var np=0;var n=0;do{var plane=planes[n];var d0=plane[0];var d1=plane[1];var d2=plane[2];if(d0*(d0>0?n0:p0)+d1*(d1>0?n1:p1)+d2*(d2>0?n2:p2)<plane[3]){p[np]=plane;np+=1}n+=1}while(n<numPlanes);return p}};if(typeof Float32Array!=="undefined"){var testVector=new Float32Array([1,2,3]);testVector[0]=VMath.FLOAT_MAX;VMath.FLOAT_MAX=testVector[0];VMathArrayConstructor=Float32Array}if(TurbulenzEngine.hasOwnProperty("VMath")){TurbulenzEngine.VMath=VMath}function RequestHandler(){}RequestHandler.prototype={reasonConnectionLost:0,reasonServiceBusy:1,retryExponential:function requestHandlerExponentialRetryFn(callContext,requestFn,status){if(!this.notifiedConnectionLost&&TurbulenzEngine.time-this.connectionLostTime>this.notifyTime*.001){this.notifiedConnectionLost=true;var reason;if(status===0){reason=this.reasonConnectionLost}else{reason=this.reasonServiceBusy}callContext.reason=reason;this.onRequestTimeout(reason,callContext)}if(this.connected){this.connectionLostTime=TurbulenzEngine.time;this.notifiedConnectionLost=false;this.connected=false;this.reconnectTest=callContext;callContext.status=status}else if(this.reconnectTest!==callContext){var reconnectedObserver=this.reconnectedObserver;reconnectedObserver.subscribe(function onReconnected(){reconnectedObserver.unsubscribe(onReconnected);requestFn()});return}if(callContext.expTime){callContext.expTime=2*callContext.expTime;if(callContext.expTime>this.maxRetryTime){callContext.expTime=this.maxRetryTime}}else{callContext.expTime=this.initialRetryTime}if(callContext.retries){callContext.retries+=1}else{callContext.retries=1}TurbulenzEngine.setTimeout(requestFn,callContext.expTime)},retryAfter:function requestHandlerRetryAfterFn(callContext,retryAfter,requestFn,status){if(callContext.retries){callContext.retries+=1}else{callContext.firstRetry=TurbulenzEngine.time;callContext.retries=1}if(!callContext.notifiedMaxRetries&&TurbulenzEngine.time-callContext.firstRetry+retryAfter>this.notifyTime){callContext.notifiedMaxRetries=true;var reason=this.reasonServiceBusy;callContext.reason=reason;this.onRequestTimeout(reason,callContext)}TurbulenzEngine.setTimeout(requestFn,retryAfter*1e3)},request:function requestHandlerRequestFn(callContext){var makeRequest;var that=this;var responseCallback=function responseCallbackFn(responseAsset,status){var xhr=callContext.xhr;var sendEventToHandlers=that.sendEventToHandlers;var handlers=that.handlers;if(xhr){var retryAfterHeader=xhr.getResponseHeader("Retry-After");if(retryAfterHeader){var retryAfter=parseInt(retryAfterHeader,10);if(retryAfter>0){that.retryAfter(callContext,retryAfter,makeRequest,status);return}}}if(status===0||status===408||status===429||status===480){that.retryExponential(callContext,makeRequest,status);return}if(!that.connected){that.connected=true;if(that.reconnectTest===callContext&&that.notifiedConnectionLost){that.onReconnected(that.reconnectTest.reason,that.reconnectTest)}that.reconnectTest=null;that.reconnectedObserver.notify()}if(callContext.customErrorHandler&&!callContext.customErrorHandler.call(this,callContext,makeRequest,responseAsset,status)){return}if(that.customErrorHandler&&!that.customErrorHandler(callContext,makeRequest,responseAsset,status)){return}if(callContext.onload){var nameStr;if(responseAsset&&responseAsset.name){nameStr=responseAsset.name}else{nameStr=callContext.src}sendEventToHandlers(handlers.eventOnload,{eventType:"eventOnload",name:nameStr});callContext.onload(responseAsset,status,callContext);callContext.onload=null}callContext=null};makeRequest=function makeRequestFn(){if(callContext.requestFn){if(callContext.requestOwner){callContext.requestFn.call(callContext.requestOwner,callContext.src,responseCallback,callContext)}else{callContext.requestFn(callContext.src,responseCallback,callContext)}}else if(callContext.requestOwner){callContext.requestOwner.request(callContext.src,responseCallback,callContext)}else{TurbulenzEngine.request(callContext.src,responseCallback,callContext)}};makeRequest()},addEventListener:function addEventListenerFn(eventType,eventListener){var i;var length;var eventHandlers;if(this.handlers.hasOwnProperty(eventType)){eventHandlers=this.handlers[eventType];if(eventListener){length=eventHandlers.length;for(i=0;i<length;i+=1){if(eventHandlers[i]===eventListener){return}}eventHandlers.push(eventListener)}}},removeEventListener:function removeEventListenerFn(eventType,eventListener){var i;var length;var eventHandlers;if(this.handlers.hasOwnProperty(eventType)){eventHandlers=this.handlers[eventType];if(eventListener){length=eventHandlers.length;for(i=0;i<length;i+=1){if(eventHandlers[i]===eventListener){eventHandlers.splice(i,1);break}}}}},sendEventToHandlers:function sendEventToHandlersFn(eventHandlers,arg0){var i;var length=eventHandlers.length;if(length){for(i=0;i<length;i+=1){eventHandlers[i](arg0)}}}};RequestHandler.create=function requestHandlerCreateFn(params){var rh=new RequestHandler;rh.initialRetryTime=params.initialRetryTime||.5*1e3;rh.notifyTime=params.notifyTime||4*1e3;rh.maxRetryTime=params.maxRetryTime||8*1e3;rh.notifiedConnectionLost=false;rh.connected=true;rh.reconnectedObserver=Observer.create();rh.reconnectTest=null;rh.onReconnected=params.onReconnected||function onReconnectedFn(){};rh.onRequestTimeout=params.onRequestTimeout||function onRequestTimeoutFn(callContext){};var handlers={};rh.handlers=handlers;rh.handlers.eventOnload=[];return rh};function MappingTable(){}MappingTable.prototype={version:1,getURL:function mappingTableGetURL(assetPath,missingCallbackFn){var url=this.urlMapping[assetPath];if(url){return url}else{if(missingCallbackFn){missingCallbackFn(assetPath)}return this.assetPrefix+assetPath}},map:function mappingTableMap(logicalPath,physicalPath){this.urlMapping[logicalPath]=physicalPath},alias:function mappingTableAlias(alias,logicalPath){var urlMapping=this.urlMapping;urlMapping[alias]=urlMapping[logicalPath]}};MappingTable.create=function MappingTableCreateFn(params){var mappingTable=new MappingTable;mappingTable.mappingTableURL=params.mappingTableURL;mappingTable.mappingTablePrefix=params.mappingTablePrefix;mappingTable.assetPrefix=params.assetPrefix;mappingTable.errorCallbackFn=params.errorCallback||TurbulenzServices.defaultErrorCallback;if(!mappingTable.mappingTableURL){mappingTable.errorCallbackFn("TurbulenzServices.createMappingTable no mapping table file given")}function createMappingTableCallbackFn(urlMappingData){var urlMapping=urlMappingData.urnmapping||urlMappingData.urnremapping||{};mappingTable.urlMapping=urlMapping;var mappingTablePrefix=mappingTable.mappingTablePrefix;if(mappingTablePrefix){var source;for(source in urlMapping){if(urlMapping.hasOwnProperty(source)){urlMapping[source]=mappingTablePrefix+urlMapping[source]}}}params.onload(mappingTable)}params.requestHandler.request({src:mappingTable.mappingTableURL,onload:function jsonifyResponse(jsonResponse,status){var obj=JSON.parse(jsonResponse);if(status===200){createMappingTableCallbackFn(obj)}else{mappingTable.errorCallbackFn("TurbulenzServices.createMappingTable error with HTTP status "+status+": "+jsonResponse.msg,status)}}});return mappingTable};function Draw2DGroup(){}Draw2DGroup.create=function draw2DGroupFn(){var group=new Draw2DGroup;group.indices=[];group.textures=[];group.numSets=0;group.vertexBufferData=new Draw2D.prototype.floatArray(1024);group.numVertices=0;return group};function Draw2DSprite(){}Draw2DSprite.prototype={version:1,getTextureRectangle:function getTextureRectangleFn(dst){if(dst===undefined){dst=new Draw2D.prototype.floatArray(4)}var data=this.data;var texture=this._texture;if(texture){dst[0]=data[12]*texture.width;dst[1]=data[13]*texture.height;dst[2]=data[14]*texture.width;dst[3]=data[15]*texture.height}else{dst[0]=data[12];dst[1]=data[13];dst[2]=data[14];dst[3]=data[15]}return dst},setTextureRectangle:function setTextureRectangleFn(uvRect){var data=this.data;var texture=this._texture;if(texture){var iwidth=1/texture.width;var iheight=1/texture.height;data[12]=uvRect[0]*iwidth;data[13]=uvRect[1]*iheight;data[14]=uvRect[2]*iwidth;data[15]=uvRect[3]*iheight}else{data[12]=uvRect[0];data[13]=uvRect[1];data[14]=uvRect[2];data[15]=uvRect[3]}},getColor:function getColorFn(dst){if(dst===undefined){dst=new Draw2D.prototype.floatArray(4)}var data=this.data;dst[0]=data[8];dst[1]=data[9];dst[2]=data[10];dst[3]=data[11];return dst},setColor:function setColorFn(color){var data=this.data;data[8]=color[0];data[9]=color[1];data[10]=color[2];data[11]=color[3]},getTexture:function getTextureFn(){return this._texture},setTexture:function setTextureFn(texture){if(this._texture!==texture){var su=(this._texture?this._texture.width:1)/(texture?texture.width:1);var sv=(this._texture?this._texture.height:1)/(texture?texture.height:1);this._texture=texture||null;var data=this.data;data[12]*=su;data[13]*=sv;data[14]*=su;data[15]*=sv}},getWidth:function getWidthFn(){return this.data[17]*2},setWidth:function setWidthFn(width){width*=.5;var data=this.data;if(data[17]!==width){data[17]=width;this._invalidate()}},getHeight:function getHeightFn(){return this.data[18]*2},setHeight:function setHeightFn(height){height*=.5;var data=this.data;if(data[18]!==height){data[18]=height;this._invalidate()}},getScale:function getScaleFn(dst){if(dst===undefined){dst=new Draw2D.prototype.floatArray(2)}var data=this.data;dst[0]=data[19];dst[1]=data[20];return dst},setScale:function setScaleFn(scale){var scaleX=scale[0];var scaleY=scale[1];var data=this.data;if(data[19]!==scaleX||data[20]!==scaleY){data[19]=scaleX;data[20]=scaleY;this._invalidate()}},getShear:function getShearFn(dst){if(dst===undefined){dst=new Draw2D.prototype.floatArray(2)}var data=this.data;dst[0]=data[21];dst[1]=data[22];return dst},setShear:function setShearFn(shear){var shearX=shear[0];var shearY=shear[1];var data=this.data;if(data[21]!==shearX||data[22]!==shearY){data[21]=shearX;data[22]=shearY;this._invalidate()}},getOrigin:function getOriginFn(dst){if(dst===undefined){dst=new Draw2D.prototype.floatArray(2)}var data=this.data;dst[0]=data[23];dst[1]=data[24];return dst},setOrigin:function setOriginFn(origin){var originX=origin[0];var originY=origin[1];var data=this.data;if(data[23]!==originX||data[24]!==originY){data[23]=originX;data[24]=originY;this._invalidate()}},_invalidate:function invalidateFn(){var data=this.data;var T1=data[19];var T2=data[19]*data[21];var T3=data[20]*data[22];var T4=data[20];var x=data[17]-data[23];var y=data[18]-data[24];var cx=data[25]=T1*x+T2*y;var cy=data[26]=T3*x+T4*y;x=-data[17];y=-data[18];var ux=data[27]=T1*x+T2*y;var uy=data[28]=T3*x+T4*y;x=-x;var vx=data[29]=T1*x+T2*y;var vy=data[30]=T3*x+T4*y;var rotation=data[16]=this.rotation;var cos=Math.cos(rotation);var sin=Math.sin(rotation);data[31]=cos*cx-sin*cy;data[32]=sin*cx+cos*cy;data[33]=cos*ux-sin*uy;data[34]=sin*ux+cos*uy;data[35]=cos*vx-sin*vy;data[36]=sin*vx+cos*vy;var dot=2*(cx*ux+cy*uy);if(dot<0){dot=-dot}var r1=ux*ux+uy*uy+dot;dot=2*(cx*vx+cy*vy);if(dot<0){dot=-dot}var r2=vx*vx+vy*vy+dot;if(r2>r1){r1=r2}r1+=cx*cx+cy*cy;data[37]=.25/r1},_update:function _updateFn(angleScaleFactor){var data=this.data;var x,y,u,v;x=this.rotation;y=x-data[16];if(y*y>data[37]*angleScaleFactor){data[16]=x;u=Math.cos(x);v=Math.sin(x);x=data[25];y=data[26];data[31]=u*x-v*y;data[32]=v*x+u*y;x=data[27];y=data[28];data[33]=u*x-v*y;data[34]=v*x+u*y;x=data[29];y=data[30];data[35]=u*x-v*y;data[36]=v*x+u*y}u=this.x+data[31];v=this.y+data[32];x=data[33];y=data[34];data[0]=u+x;data[1]=v+y;data[6]=u-x;data[7]=v-y;x=data[35];y=data[36];data[2]=u+x;data[3]=v+y;data[4]=u-x;data[5]=v-y}};Draw2DSprite.create=function draw2DSpriteCreateFn(params){if((params.width===undefined||params.height===undefined)&&!params.texture){return null}var s=new Draw2DSprite;var data=s.data=new Draw2D.prototype.floatArray(38);var texture=s._texture=params.texture||null;s.x=params.x||0;s.y=params.y||0;s.rotation=data[16]=params.rotation||0;var color=params.color;data[8]=color?color[0]:1;data[9]=color?color[1]:1;data[10]=color?color[2]:1;data[11]=color?color[3]:1;var uvRect=params.textureRectangle;var iwidth=texture?1/texture.width:1;var iheight=texture?1/texture.height:1;data[12]=uvRect?uvRect[0]*iwidth:0;data[13]=uvRect?uvRect[1]*iheight:0;data[14]=uvRect?uvRect[2]*iwidth:1;data[15]=uvRect?uvRect[3]*iheight:1;data[17]=(params.width!==undefined?params.width:texture.width)*.5;data[18]=(params.height!==undefined?params.height:texture.height)*.5;var scale=params.scale;data[19]=scale?scale[0]:1;data[20]=scale?scale[1]:1;var shear=params.shear;data[21]=shear?shear[0]:0;data[22]=shear?shear[1]:0;var origin=params.origin;data[23]=origin?origin[0]:data[17];data[24]=origin?origin[1]:data[18];s._invalidate();return s};function Draw2DSpriteData(){}Draw2DSpriteData.setFromRotatedRectangle=function setFromRotatedRectangleFn(sprite,texture,rect,uvrect,color,rotation,origin){var x1=rect[0];var y1=rect[1];var x2=rect[2];var y2=rect[3];if(!rotation){sprite[0]=x1;sprite[1]=y1;sprite[2]=x2;sprite[3]=y1;sprite[4]=x1;sprite[5]=y2;sprite[6]=x2;sprite[7]=y2}else{var cx,cy;if(origin){cx=x1+origin[0];cy=y1+origin[1]}else{cx=.5*(x1+x2);cy=.5*(y1+y2)}var dx=x1-cx;var dy=y1-cy;var cos=Math.cos(rotation);var sin=Math.sin(rotation);var w=x2-x1;var h=y2-y1;sprite[0]=x1=cx+(cos*dx-sin*dy);sprite[1]=y1=cy+(sin*dx+cos*dy);sprite[2]=x1+cos*w;sprite[3]=y1+sin*w;sprite[4]=x1-sin*h;sprite[5]=y1+cos*h;sprite[6]=x1+(cos*w-sin*h);sprite[7]=y1+(sin*w+cos*h)}if(color){sprite[8]=color[0];sprite[9]=color[1];sprite[10]=color[2];sprite[11]=color[3]}else{sprite[8]=sprite[9]=sprite[10]=sprite[11]=1}if(uvrect&&texture){var iwidth=1/texture.width;var iheight=1/texture.height;sprite[12]=uvrect[0]*iwidth;sprite[13]=uvrect[1]*iheight;sprite[14]=uvrect[2]*iwidth;sprite[15]=uvrect[3]*iheight}else{sprite[12]=sprite[13]=0;sprite[14]=sprite[15]=1}};Draw2DSpriteData.create=function draw2DSpriteFn(){return new Draw2D.prototype.floatArray(16)};function Draw2D(){}Draw2D.prototype={version:7,forceUpdate:false,clearBackBuffer:false,sort:{deferred:"deferred",immediate:"immediate",texture:"texture"},scale:{scale:"scale",none:"none"},drawStates:{uninit:0,ready:1,draw:2},defaultClearColor:[0,0,0,1],clear:function clearFn(clearColor){if(this.state!==this.drawStates.ready){return false}var gd=this.graphicsDevice;if(this.currentRenderTarget){if(!gd.beginRenderTarget(this.currentRenderTarget.renderTarget)){return false}gd.clear(clearColor||this.defaultClearColor);gd.endRenderTarget()}else{gd.clear(clearColor||this.defaultClearColor)}return true},clearBatch:function clearFn(){for(var name in this.texLists){if(this.texLists.hasOwnProperty(name)){delete this.texLists[name]}}this.currentTextureGroup=undefined;this.numGroups=0},bufferSprite:function bufferSpriteFn(buffer,sprite,index){sprite._update(0);index<<=4;var data=sprite.data;buffer[index]=data[0];buffer[index+1]=data[1];buffer[index+2]=data[2];buffer[index+3]=data[3];buffer[index+4]=data[4];buffer[index+5]=data[5];buffer[index+6]=data[6];buffer[index+7]=data[7];buffer[index+8]=data[8];buffer[index+9]=data[9];buffer[index+10]=data[10];buffer[index+11]=data[11];buffer[index+12]=data[12];buffer[index+13]=data[13];buffer[index+14]=data[14];buffer[index+15]=data[15]},update:function updateFn(){var graphicsDevice=this.graphicsDevice;var width=this.width;var height=this.height;var graphicsDeviceWidth=graphicsDevice.width;var graphicsDeviceHeight=graphicsDevice.height;if(width!==graphicsDeviceWidth||height!==graphicsDeviceHeight||this.forceUpdate){var viewWidth,viewHeight,viewX,viewY;var viewportRectangle=this.viewportRectangle;if(viewportRectangle){viewX=viewportRectangle[0];viewY=viewportRectangle[1];viewWidth=viewportRectangle[2]-viewX;viewHeight=viewportRectangle[3]-viewY}else{viewX=0;viewY=0;viewWidth=graphicsDeviceWidth;viewHeight=graphicsDeviceHeight}if(viewWidth===graphicsDeviceWidth&&viewHeight===graphicsDeviceHeight){this.clearBackBuffer=false}else{this.clearBackBuffer=true}var target=this.currentRenderTarget;if(this.scaleMode==="scale"){var viewAspectRatio=viewWidth/viewHeight;var graphicsDeviceAspectRatio=graphicsDeviceWidth/graphicsDeviceHeight;var calcViewWidth,calcViewHeight,diffWidth,diffHeight,halfDiffWidth,halfDiffHeight;if(graphicsDeviceAspectRatio>viewAspectRatio){calcViewWidth=Math.ceil(graphicsDeviceHeight/viewHeight*viewWidth);diffWidth=graphicsDeviceWidth-calcViewWidth;halfDiffWidth=Math.floor(diffWidth*.5);this.scissorX=halfDiffWidth;this.scissorY=0;this.scissorWidth=calcViewWidth;this.scissorHeight=graphicsDeviceHeight;this.viewScaleX=viewWidth/calcViewWidth;this.viewScaleY=viewHeight/graphicsDeviceHeight;if(!target){this.clipOffsetX=halfDiffWidth/graphicsDeviceWidth*2-1;this.clipOffsetY=1;this.clipScaleX=calcViewWidth/graphicsDeviceWidth*2/viewWidth;this.clipScaleY=-2/viewHeight}}else{calcViewHeight=Math.ceil(graphicsDeviceWidth/viewWidth*viewHeight);diffHeight=graphicsDeviceHeight-calcViewHeight;halfDiffHeight=Math.floor(diffHeight*.5);this.scissorX=0;this.scissorY=halfDiffHeight;this.scissorWidth=graphicsDeviceWidth;this.scissorHeight=calcViewHeight;this.viewScaleX=viewWidth/graphicsDeviceWidth;this.viewScaleY=viewHeight/calcViewHeight;if(!target){this.clipOffsetX=-1;this.clipOffsetY=1-halfDiffHeight/graphicsDeviceHeight*2;this.clipScaleX=2/viewWidth;this.clipScaleY=calcViewHeight/graphicsDeviceHeight*-2/viewHeight}}}else{this.viewScaleX=1;this.viewScaleY=1;if(!target){this.clipOffsetX=-1;this.clipOffsetY=1;this.clipScaleX=2/graphicsDeviceWidth;this.clipScaleY=-2/graphicsDeviceHeight}this.scissorX=0;this.scissorY=graphicsDeviceHeight-viewHeight;this.scissorWidth=viewWidth;this.scissorHeight=viewHeight}this.spriteAngleFactor=Math.min(this.viewScaleX,this.viewScaleY);this.spriteAngleFactor*=this.spriteAngleFactor;this.width=graphicsDeviceWidth;this.height=graphicsDeviceHeight;var i=0;var renderTargets=this.renderTargetStructs;var limit=renderTargets.length;for(i=0;i<limit;i+=1){this.validateTarget(renderTargets[i],this.scissorWidth,this.scissorHeight)}if(target){this.clipOffsetX=-1;this.clipOffsetY=-1;this.clipScaleX=2*target.actualWidth/target.texture.width/viewWidth;this.clipScaleY=2*target.actualHeight/target.texture.height/viewHeight}this.clipOffsetX-=viewX*this.clipScaleX;this.clipOffsetY-=viewY*this.clipScaleY;var clipSpace=this.techniqueParameters.clipSpace;clipSpace[0]=this.clipScaleX;clipSpace[1]=this.clipScaleY;clipSpace[2]=this.clipOffsetX;clipSpace[3]=this.clipOffsetY;this.updateRenderTargetVbo(this.scissorX,this.scissorY,this.scissorWidth,this.scissorHeight);this.forceUpdate=false}},getViewport:function getViewportFn(dst){if(!dst){dst=new Draw2D.prototype.floatArray(4)}var viewport=this.viewportRectangle;if(viewport){dst[0]=viewport[0];dst[1]=viewport[1];dst[2]=viewport[2];dst[3]=viewport[3]}else{dst[0]=dst[1]=0;dst[2]=this.graphicsDevice.width;dst[3]=this.graphicsDevice.height}return dst},getScreenSpaceViewport:function screenSpaceViewportFn(dst){if(!dst){dst=new Draw2D.prototype.floatArray(4)}this.update();dst[0]=this.scissorX;dst[1]=this.height-(this.scissorY+this.scissorHeight);dst[2]=dst[0]+this.scissorWidth;dst[3]=dst[1]+this.scissorHeight;return dst},viewportMap:function viewportMapFn(screenX,screenY,dst){if(!dst){dst=new Draw2D.prototype.floatArray(2)}this.update();var scissorY=this.height-this.scissorHeight-this.scissorY;dst[0]=(screenX-this.scissorX)*this.viewScaleX;dst[1]=(screenY-scissorY)*this.viewScaleY;var viewport=this.viewportRectangle;if(viewport){dst[0]+=viewport[0];dst[1]+=viewport[1]}return dst},viewportUnmap:function screenMapFn(x,y,dst){if(!dst){dst=new Draw2D.prototype.floatArray(2)}this.update();var viewport=this.viewportRectangle;if(viewport){x-=viewport[0];y-=viewport[1]}var scissorY=this.height-this.scissorHeight-this.scissorY;dst[0]=x/this.viewScaleX+this.scissorX;dst[1]=y/this.viewScaleY+scissorY;return dst},viewportClamp:function viewportClampFn(point){if(point){var x=point[0];var y=point[1];var minX,minY,maxX,maxY;var viewport=this.viewportRectangle;if(viewport){minX=viewport[0];minY=viewport[1];maxX=viewport[2];maxY=viewport[3]}else{minX=0;minY=0;maxX=this.graphicsDevice.width;maxY=this.graphicsDevice.height}if(x<minX){x=minX}else if(x>maxX){x=maxX}if(y<minY){y=minY}else if(y>maxY){y=maxY}point[0]=x;point[1]=y}return point},configure:function configureFn(params){if(this.state!==this.drawStates.ready){return false}var viewportRectangle="viewportRectangle"in params?params.viewportRectangle:this.viewportRectangle;var scaleMode=params.scaleMode;if(scaleMode!==undefined){if(!(scaleMode in this.scale)){return false}if(scaleMode==="scale"&&!viewportRectangle){return false}this.scaleMode=scaleMode}this.viewportRectangle=viewportRectangle;this.forceUpdate=true;this.update();return true},destroy:function destroyFn(){this.texLists=null;this.state=this.drawStates.uninit;delete this.graphicsDevice;if(this.vertexBuffer){this.vertexBuffer.destroy()}if(this.indexBuffer){this.indexBuffer.destroy()}this.copyVertexBuffer.destroy();var renderTargets=this.renderTargetStructs;while(renderTargets.length>0){var target=renderTargets.pop();target.texture.destroy();target.renderTarget.destroy();delete target.texture;delete target.renderTarget}},begin:function beginFn(blendMode,sortMode){if(sortMode&&!(sortMode in this.sort)){return false}if(blendMode&&!(blendMode in this.blend)){return false}var firstTime=!this.sortMode;if(this.dispatch()){this.clearBatch()}if(firstTime){if(this.state!==this.drawStates.ready){return false}this.update();if(!this.currentRenderTarget){this.graphicsDevice.setScissor(this.scissorX,this.scissorY,this.scissorWidth,this.scissorHeight)}}this.state=this.drawStates.draw;sortMode=sortMode?sortMode:firstTime?"deferred":this.sortMode;blendMode=blendMode?blendMode:firstTime?"opaque":this.blendMode;if(!firstTime){this.sortModeStack.push(this.sortMode);this.blendModeStack.push(this.blendMode)}this.sortMode=sortMode;this.blendMode=blendMode;this.prepareSortMode(sortMode);this.graphicsDevice.setTechnique(this.blendModeTechniques[blendMode]);return true},_bufferSprite:function bufferSpriteFn(group,sprite){var vertexData=group.vertexBufferData;var vertexBuffer=this.vertexBuffer;var index=group.numVertices*vertexBuffer.stride;var total=index+4*vertexBuffer.stride;if(total>=vertexData.length){var size=this.bufferSizeAlgorithm(total,this.cpuStride);var newData=new Draw2D.prototype.floatArray(size);var i;for(i=0;i<index;i+=1){newData[i]=vertexData[i]}group.vertexBufferData=vertexData=newData}var c1=sprite[8];var c2=sprite[9];var c3=sprite[10];var c4=sprite[11];var u1=sprite[12];var v1=sprite[13];var u2=sprite[14];var v2=sprite[15];vertexData[index]=sprite[0];vertexData[index+1]=sprite[1];vertexData[index+2]=c1;vertexData[index+3]=c2;vertexData[index+4]=c3;vertexData[index+5]=c4;vertexData[index+6]=u1;vertexData[index+7]=v1;vertexData[index+8]=sprite[2];vertexData[index+9]=sprite[3];vertexData[index+10]=c1;vertexData[index+11]=c2;vertexData[index+12]=c3;vertexData[index+13]=c4;vertexData[index+14]=u2;vertexData[index+15]=v1;vertexData[index+16]=sprite[4];vertexData[index+17]=sprite[5];vertexData[index+18]=c1;vertexData[index+19]=c2;vertexData[index+20]=c3;vertexData[index+21]=c4;vertexData[index+22]=u1;vertexData[index+23]=v2;vertexData[index+24]=sprite[6];vertexData[index+25]=sprite[7];vertexData[index+26]=c1;vertexData[index+27]=c2;vertexData[index+28]=c3;vertexData[index+29]=c4;vertexData[index+30]=u2;vertexData[index+31]=v2;group.numVertices+=4;group.indices[group.numSets-1]+=6},bufferMultiSprite:function bufferMultiSprite(group,buffer,count,offset){var vertexData=group.vertexBufferData;var vertexBuffer=this.vertexBuffer;var numSprites=count===undefined?Math.floor(buffer.length/16):count;count=numSprites*16;offset=(offset!==undefined?offset:0)*16;var i;var index=group.numVertices*vertexBuffer.stride;var total=index+numSprites*4*vertexBuffer.stride;if(total>=vertexData.length){var size=this.bufferSizeAlgorithm(total,this.cpuStride);var newData=new Draw2D.prototype.floatArray(size);for(i=0;i<index;i+=1){newData[i]=vertexData[i]}group.vertexBufferData=vertexData=newData}var limit=offset+count;for(i=offset;i<limit;i+=16){var c1=buffer[i+8];var c2=buffer[i+9];var c3=buffer[i+10];var c4=buffer[i+11];var u1=buffer[i+12];var v1=buffer[i+13];var u2=buffer[i+14];var v2=buffer[i+15];vertexData[index]=buffer[i];vertexData[index+1]=buffer[i+1];vertexData[index+2]=c1;vertexData[index+3]=c2;vertexData[index+4]=c3;vertexData[index+5]=c4;vertexData[index+6]=u1;vertexData[index+7]=v1;vertexData[index+8]=buffer[i+2];vertexData[index+9]=buffer[i+3];vertexData[index+10]=c1;vertexData[index+11]=c2;vertexData[index+12]=c3;vertexData[index+13]=c4;vertexData[index+14]=u2;vertexData[index+15]=v1;vertexData[index+16]=buffer[i+4];vertexData[index+17]=buffer[i+5];vertexData[index+18]=c1;vertexData[index+19]=c2;vertexData[index+20]=c3;vertexData[index+21]=c4;vertexData[index+22]=u1;vertexData[index+23]=v2;vertexData[index+24]=buffer[i+6];vertexData[index+25]=buffer[i+7];vertexData[index+26]=c1;vertexData[index+27]=c2;vertexData[index+28]=c3;vertexData[index+29]=c4;vertexData[index+30]=u2;vertexData[index+31]=v2;index+=32}group.numVertices+=numSprites*4;group.indices[group.numSets-1]+=numSprites*6},indexData:function indexDataFn(count){var indexData=new Draw2D.prototype.uint16Array(count);var i;var vertexIndex=0;for(i=0;i<count;i+=6){indexData[i]=vertexIndex;indexData[i+1]=vertexIndex+1;indexData[i+2]=vertexIndex+2;indexData[i+3]=vertexIndex+1;indexData[i+4]=vertexIndex+2;indexData[i+5]=vertexIndex+3;vertexIndex+=4}return indexData},uploadBuffer:function uploadBufferFn(group,count,offset){var vertexBuffer=this.vertexBuffer;var vertexBufferParameters=this.vertexBufferParameters;var graphicsDevice=this.graphicsDevice;var vertexData=group.vertexBufferData;var performanceData=this.performanceData;if(count>vertexBufferParameters.numVertices){var newSize=this.bufferSizeAlgorithm(count,this.gpuStride);if(newSize>this.maxVertices){newSize=this.maxVertices}vertexBufferParameters.numVertices=newSize;this.vertexBuffer.destroy();this.vertexBuffer=vertexBuffer=graphicsDevice.createVertexBuffer(vertexBufferParameters);performanceData.gpuMemoryUsage=newSize*35;newSize*=1.5;var indexBufferParameters=this.indexBufferParameters;indexBufferParameters.data=this.indexData(newSize);indexBufferParameters.numIndices=newSize;this.indexBuffer.destroy();this.indexBuffer=graphicsDevice.createIndexBuffer(indexBufferParameters);graphicsDevice.setIndexBuffer(this.indexBuffer)}performanceData.dataTransfers+=1;if(offset===0){vertexBuffer.setData(vertexData,0,count)}else{var stride=vertexBuffer.stride;vertexBuffer.setData(vertexData.subarray(offset*stride,(offset+count)*stride),0,count)}},drawRawImmediate:function drawRawImmediateFn(texture,multiSprite,count,offset){var group=this.drawGroups[0];group.textures[0]=texture||this.defaultTexture;group.indices[0]=0;group.numSets=1;this.numGroups=1;this.bufferMultiSprite(group,multiSprite,count,offset);this.dispatch()},drawSpriteImmediate:function drawSpriteImmediateFn(sprite){var group=this.drawGroups[0];group.textures[0]=sprite._texture||this.defaultTexture;group.indices[0]=0;group.numSets=1;this.numGroups=1;sprite._update(this.spriteAngleFactor);this._bufferSprite(group,sprite.data);this.dispatch()},drawImmediate:function drawImmediateFn(params){var texture=params.texture||this.defaultTexture;var destRect=params.destinationRectangle;var srcRect=params.sourceRectangle;var color=params.color;var rotation=params.rotation;var group=this.drawGroups[0];group.textures[0]=texture;group.indices[0]=0;group.numSets=1;this.numGroups=1;var drawSprite=this.drawSprite;Draw2DSpriteData.setFromRotatedRectangle(drawSprite,texture,destRect,srcRect,color,rotation,params.origin);this._bufferSprite(group,drawSprite);this.dispatch()},drawRawDeferred:function drawRawDeferredFn(texture,multiSprite,count,offset){texture=texture||this.defaultTexture;var group=this.drawGroups[0];this.numGroups=1;var numSets=group.numSets;if(numSets===0||group.textures[numSets-1]!==texture){group.textures[numSets]=texture;group.indices[numSets]=0;group.numSets+=1}this.bufferMultiSprite(group,multiSprite,count,offset)},drawSpriteDeferred:function drawSpriteDeferredFn(sprite){var texture=sprite._texture||this.defaultTexture;var group=this.drawGroups[0];this.numGroups=1;var numSets=group.numSets;if(numSets===0||group.textures[numSets-1]!==texture){group.textures[numSets]=texture;group.indices[numSets]=0;group.numSets+=1}sprite._update(this.spriteAngleFactor);this._bufferSprite(group,sprite.data)},drawDeferred:function drawDeferredFn(params){var texture=params.texture||this.defaultTexture;var group=this.drawGroups[0];this.numGroups=1;var numSets=group.numSets;if(numSets===0||group.textures[numSets-1]!==texture){group.textures[numSets]=texture;group.indices[numSets]=0;group.numSets+=1}var destRect=params.destinationRectangle;var srcRect=params.sourceRectangle;var color=params.color;var rotation=params.rotation;var drawSprite=this.drawSprite;Draw2DSpriteData.setFromRotatedRectangle(drawSprite,texture,destRect,srcRect,color,rotation,params.origin);this._bufferSprite(group,drawSprite)},drawRawTextured:function drawRawTexturedFn(texture,multiSprite,count,offset){texture=texture||this.defaultTexture;var group;if(this.currentTextureGroup!==undefined&&this.currentTextureGroup.textures[0]===texture){group=this.currentTextureGroup}else{var name=texture.name;var texLists=this.texLists;group=texLists[name];if(!group){group=this.drawGroups[this.numGroups];if(!group){group=Draw2DGroup.create()}this.drawGroups[this.numGroups]=texLists[name]=group;group.textures[0]=texture;group.indices[0]=0;group.numSets=1;this.numGroups+=1}this.currentTextureGroup=group}this.bufferMultiSprite(group,multiSprite,count,offset)},drawSpriteTextured:function drawSpriteTexturedFn(sprite){var texture=sprite._texture||this.defaultTexture;var group;if(this.currentTextureGroup!==undefined&&this.currentTextureGroup.textures[0]===texture){group=this.currentTextureGroup}else{var name=texture.name;var texLists=this.texLists;group=texLists[name];if(!group){group=this.drawGroups[this.numGroups];if(!group){group=Draw2DGroup.create()}this.drawGroups[this.numGroups]=texLists[name]=group;group.textures[0]=texture;group.indices[0]=0;group.numSets=1;this.numGroups+=1}this.currentTextureGroup=group}sprite._update(this.spriteAngleFactor);this._bufferSprite(group,sprite.data)},drawTextured:function drawTexturedFn(params){var texture=params.texture||this.defaultTexture;var group;if(this.currentTextureGroup!==undefined&&this.currentTextureGroup.textures[0]===texture){group=this.currentTextureGroup}else{var name=texture.name;var texLists=this.texLists;group=texLists[name];if(!group){group=this.drawGroups[this.numGroups];
if(!group){group=Draw2DGroup.create()}this.drawGroups[this.numGroups]=texLists[name]=group;group.textures[0]=texture;group.indices[0]=0;group.numSets=1;this.numGroups+=1}this.currentTextureGroup=group}var destRect=params.destinationRectangle;var srcRect=params.sourceRectangle;var color=params.color;var rotation=params.rotation;var drawSprite=this.drawSprite;Draw2DSpriteData.setFromRotatedRectangle(drawSprite,texture,destRect,srcRect,color,rotation,params.origin);this._bufferSprite(group,drawSprite)},prepareSortMode:function refreshSortModeFn(sortMode){if(sortMode==="deferred"){this.draw=this.drawDeferred;this.drawSprite=this.drawSpriteDeferred;this.drawRaw=this.drawRawDeferred}else if(sortMode==="immediate"){this.draw=this.drawImmediate;this.drawSprite=this.drawSpriteImmediate;this.drawRaw=this.drawRawImmediate}else{this.draw=this.drawTextured;this.drawSprite=this.drawSpriteTextured;this.drawRaw=this.drawRawTextured}},end:function endFn(){if(this.state!==this.drawStates.draw){return false}if(this.dispatch()){this.clearBatch()}if(this.blendModeStack.length!==0){this.blendMode=this.blendModeStack.pop();this.sortMode=this.sortModeStack.pop();this.prepareSortMode(this.sortMode);this.graphicsDevice.setTechnique(this.blendModeTechniques[this.blendMode])}else{this.blendMode=undefined;this.sortMode=undefined;this.state=this.drawStates.ready}return true},dispatch:function dispatchFn(){var numGroups=this.numGroups;if(numGroups===0){return false}var graphicsDevice=this.graphicsDevice;var techniqueParameters=this.techniqueParameters;graphicsDevice.setIndexBuffer(this.indexBuffer);var drawGroups=this.drawGroups;var renderTargetUsed=false;if(this.currentRenderTarget){renderTargetUsed=graphicsDevice.beginRenderTarget(this.currentRenderTarget.renderTarget)}var performanceData=this.performanceData;var i;for(i=0;i<numGroups;i+=1){var group=drawGroups[i];var textures=group.textures;var indices=group.indices;var setIndex=0;var vindex=0;var vlimit=group.numVertices;while(vindex<vlimit){var vcount=vlimit-vindex;if(vcount>this.maxVertices){vcount=this.maxVertices}this.uploadBuffer(group,vcount,vindex);graphicsDevice.setStream(this.vertexBuffer,this.semantics);var ilimit=vcount*1.5;var iindex=0;while(iindex<ilimit){techniqueParameters.texture=textures[setIndex];var icount=ilimit-iindex;if(icount>=indices[setIndex]){icount=indices[setIndex];setIndex+=1}else{indices[setIndex]-=icount}var batchSize=icount/6;if(performanceData.batchCount===0){performanceData.minBatchSize=batchSize;performanceData.maxBatchSize=batchSize;performanceData.avgBatchSize=batchSize;performanceData.batchCount=1}else{if(batchSize<performanceData.minBatchSize){performanceData.minBatchSize=batchSize}if(batchSize>performanceData.maxBatchSize){performanceData.maxBatchSize=batchSize}performanceData.avgBatchSize*=performanceData.batchCount;performanceData.avgBatchSize+=batchSize;performanceData.batchCount+=1;performanceData.avgBatchSize/=performanceData.batchCount}graphicsDevice.setTechniqueParameters(techniqueParameters);graphicsDevice.drawIndexed(graphicsDevice.PRIMITIVE_TRIANGLES,icount,iindex);iindex+=icount}vindex+=vcount}group.numSets=0;group.numVertices=0}if(this.currentRenderTarget&&renderTargetUsed){graphicsDevice.endRenderTarget()}return true},bufferSizeAlgorithm:function bufferSizeAlgorithmFn(target,stride){var factor=1.25;var logf=Math.ceil(Math.log(target)/Math.log(factor));var size=Math.floor(Math.pow(factor,logf));return stride*Math.ceil(size/stride)},updateRenderTargetVbo:function updateRenderTargetVboFn(viewX,viewY,viewWidth,viewHeight){var graphicsDevice=this.graphicsDevice;var halfGraphicsDeviceWidth=.5*graphicsDevice.width;var halfGraphicsDeviceHeight=.5*graphicsDevice.height;var vertexBuffer=this.copyVertexBuffer;var left=(viewX-halfGraphicsDeviceWidth)/halfGraphicsDeviceWidth;var right=(viewX+viewWidth-halfGraphicsDeviceWidth)/halfGraphicsDeviceWidth;var topv=(viewY-halfGraphicsDeviceHeight)/halfGraphicsDeviceHeight;var bottom=(viewY+viewHeight-halfGraphicsDeviceHeight)/halfGraphicsDeviceHeight;var vertexData=this.vertexBufferData;vertexData[0]=left;vertexData[1]=bottom;vertexData[2]=0;vertexData[3]=1;vertexData[4]=left;vertexData[5]=topv;vertexData[6]=0;vertexData[7]=0;vertexData[8]=right;vertexData[9]=bottom;vertexData[10]=1;vertexData[11]=1;vertexData[12]=right;vertexData[13]=topv;vertexData[14]=1;vertexData[15]=0;vertexBuffer.setData(vertexData,0,4)},makePow2:function makePow2Fn(dim){var index=Math.log(dim)/Math.log(2);return 1<<Math.ceil(index)},createRenderTarget:function createRenderTargetFn(params){var gd=this.graphicsDevice;var renderTargets=this.renderTargetStructs;var index=renderTargets.length;var name=params&&params.name?params.name:"RenderTarget#"+index;var backBuffer=params&&params.backBuffer!==undefined?params.backBuffer:true;var matchScreen=params.width===undefined||params.height===undefined;var texParams=this.renderTargetTextureParameters;texParams.name=name;var width=matchScreen?gd.width:params.width;var height=matchScreen?gd.height:params.height;texParams.width=this.makePow2(width);texParams.height=this.makePow2(height);var texture=gd.createTexture(texParams);var targetParams=this.renderTargetParams;targetParams.colorTexture0=texture;var renderTarget=gd.createRenderTarget(targetParams);renderTargets.push({managed:matchScreen,renderTarget:renderTarget,texture:texture,backBuffer:backBuffer,actualWidth:backBuffer?width:texture.width,actualHeight:backBuffer?height:texture.height});return index},validateTarget:function validateTargetFn(target,viewWidth,viewHeight){if(target.managed){var tex=target.texture;if(target.backBuffer){target.actualWidth=viewWidth;target.actualHeight=viewHeight}viewWidth=this.makePow2(viewWidth);viewHeight=this.makePow2(viewHeight);if(!target.backBuffer){target.actualWidth=viewWidth;target.actualHeight=viewHeight}if(tex.width!==viewWidth||tex.height!==viewHeight){var texParams=this.renderTargetTextureParameters;var targetParams=this.renderTargetParams;texParams.name=tex.name;texParams.width=viewWidth;texParams.height=viewHeight;tex.destroy();target.renderTarget.destroy();var graphicsDevice=this.graphicsDevice;target.texture=graphicsDevice.createTexture(texParams);targetParams.colorTexture0=target.texture;target.renderTarget=graphicsDevice.createRenderTarget(targetParams)}}},setBackBuffer:function setBackBufferFn(){if(this.state!==this.drawStates.ready){return false}this.currentRenderTarget=null;this.forceUpdate=true;return true},getRenderTargetTexture:function getRenderTargetTextureFn(renderTargetIndex){var renderTargets=this.renderTargetStructs;if(renderTargetIndex<0||renderTargetIndex>=renderTargets.length){return null}return renderTargets[renderTargetIndex].texture},getRenderTarget:function getRenderTargetFn(renderTargetIndex){var renderTargets=this.renderTargetStructs;if(renderTargetIndex<0||renderTargetIndex>=renderTargets.length){return null}return renderTargets[renderTargetIndex].renderTarget},setRenderTarget:function setRenderTargetFn(renderTargetIndex){var renderTargets=this.renderTargetStructs;if(renderTargetIndex<0||renderTargetIndex>=renderTargets.length){return false}if(this.state!==this.drawStates.ready){return false}this.currentRenderTarget=renderTargets[renderTargetIndex];this.forceUpdate=true;return true},copyRenderTarget:function copyRenderTargetFn(renderTargetIndex){if(this.state!==this.drawStates.ready){return false}var renderTargets=this.renderTargetStructs;if(renderTargetIndex<0||renderTargetIndex>=renderTargets.length){return false}this.update();if(!this.currentRenderTarget){this.graphicsDevice.setScissor(this.scissorX,this.scissorY,this.scissorWidth,this.scissorHeight)}var graphicsDevice=this.graphicsDevice;var target=renderTargets[renderTargetIndex];var tex=target.texture;var technique=this.copyTechnique;var params=this.copyTechniqueParameters;var copyUVScale=params.copyUVScale;copyUVScale[0]=target.actualWidth/tex.width;copyUVScale[1]=target.actualHeight/tex.height;params.copyFlip=!this.currentRenderTarget?-1:1;params.inputTexture0=tex;var renderTargetUsed=false;var currentTarget=this.currentRenderTarget;var vbo=this.copyVertexBuffer;if(currentTarget){renderTargetUsed=graphicsDevice.beginRenderTarget(currentTarget.renderTarget)}graphicsDevice.setTechnique(technique);graphicsDevice.setTechniqueParameters(params);graphicsDevice.setStream(vbo,this.quadSemantics);graphicsDevice.draw(this.quadPrimitive,4,0);if(currentTarget&&renderTargetUsed){graphicsDevice.endRenderTarget()}return true},resetPerformanceData:function resetPerformanceDataFn(){var data=this.performanceData;data.minBatchSize=data.maxBatchSize=data.avgBatchSize=undefined;data.batchCount=0;data.dataTransfers=0}};Draw2D.create=function draw2DCreateFn(params){var o=new Draw2D;var gd=o.graphicsDevice=params.graphicsDevice;o.sortMode=undefined;o.blendMode=undefined;o.sortModeStack=[];o.blendModeStack=[];o.drawGroups=[Draw2DGroup.create()];o.numGroups=0;o.texLists=[];o.texGroup=undefined;o.drawSprite=Draw2DSpriteData.create();o.defaultTexture=gd.createTexture({name:"DefaultDraw2DTexture",width:1,height:1,depth:1,format:"L8",cubemap:false,mipmaps:true,renderable:false,dynamic:false,data:[255]});o.draw=undefined;o.drawSprite=undefined;o.drawRaw=undefined;var shader=gd.createShader({version:1,name:"draw2D.cgfx",samplers:{texture:{MinFilter:9985,MagFilter:9729,WrapS:33071,WrapT:33071},inputTexture0:{MinFilter:9728,MagFilter:9729,WrapS:33071,WrapT:33071}},parameters:{clipSpace:{type:"float",columns:4},copyUVScale:{type:"float",columns:2},copyFlip:{type:"float"},texture:{type:"sampler2D"},inputTexture0:{type:"sampler2D"}},techniques:{opaque:[{parameters:["clipSpace","texture"],semantics:["POSITION","COLOR","TEXCOORD0"],states:{DepthTestEnable:false,DepthMask:false,CullFaceEnable:false,BlendEnable:false},programs:["vp_draw2D","fp_draw2D"]}],alpha:[{parameters:["clipSpace","texture"],semantics:["POSITION","COLOR","TEXCOORD0"],states:{DepthTestEnable:false,DepthMask:false,CullFaceEnable:false,BlendEnable:true,BlendFunc:[770,771]},programs:["vp_draw2D","fp_draw2D"]}],additive:[{parameters:["clipSpace","texture"],semantics:["POSITION","COLOR","TEXCOORD0"],states:{DepthTestEnable:false,DepthMask:false,CullFaceEnable:false,BlendEnable:true,BlendFunc:[770,1]},programs:["vp_draw2D","fp_draw2D"]}],copy:[{parameters:["copyUVScale","copyFlip","inputTexture0"],semantics:["POSITION","TEXCOORD0"],states:{DepthTestEnable:false,DepthMask:false,CullFaceEnable:false,BlendEnable:false},programs:["vp_copy","fp_copy"]}]},programs:{fp_copy:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[8];\nvec4 _ret_0;uniform sampler2D inputTexture0;void main()\n{_ret_0=texture2D(inputTexture0,tz_TexCoord[0].xy);gl_FragColor=_ret_0;}"},vp_copy:{type:"vertex",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying vec4 tz_TexCoord[8];attribute vec4 ATTR8;attribute vec4 ATTR0;\nvec4 _OutPosition1;vec2 _OutUV1;uniform vec2 copyUVScale;uniform float copyFlip;void main()\n{_OutPosition1.x=ATTR0.x;_OutPosition1.y=ATTR0.y*copyFlip;_OutPosition1.zw=ATTR0.zw;_OutUV1=ATTR8.xy*copyUVScale;tz_TexCoord[0].xy=_OutUV1;gl_Position=_OutPosition1;}"},fp_draw2D:{type:"fragment",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying TZ_LOWP vec4 tz_Color;varying vec4 tz_TexCoord[8];\nvec4 _ret_0;vec4 _TMP0;uniform sampler2D texture;void main()\n{_TMP0=texture2D(texture,tz_TexCoord[0].xy);_ret_0=tz_Color*_TMP0;gl_FragColor=_ret_0;}"},vp_draw2D:{type:"vertex",code:"#ifdef GL_ES\n#define TZ_LOWP lowp\nprecision mediump float;\nprecision mediump int;\n#else\n#define TZ_LOWP\n#endif\nvarying TZ_LOWP vec4 tz_Color;varying vec4 tz_TexCoord[8];attribute vec4 ATTR8;attribute vec4 ATTR3;attribute vec4 ATTR0;\nvec4 _OUTPosition1;vec4 _OUTColor1;vec2 _OUTTexCoord01;uniform vec4 clipSpace;void main()\n{vec2 _position;_position=ATTR0.xy*clipSpace.xy+clipSpace.zw;_OUTPosition1.x=_position.x;_OUTPosition1.y=_position.y;_OUTPosition1.z=0.0;_OUTPosition1.w=1.0;_OUTColor1=ATTR3;_OUTTexCoord01=ATTR8.xy;tz_TexCoord[0].xy=ATTR8.xy;tz_Color=ATTR3;gl_Position=_OUTPosition1;}"}}});o.blend={additive:"additive",alpha:"alpha",opaque:"opaque"},o.blendModeTechniques={};o.blendModeTechniques.additive=shader.getTechnique("additive");o.blendModeTechniques.alpha=shader.getTechnique("alpha");o.blendModeTechniques.opaque=shader.getTechnique("opaque");if(params.blendModes){for(var name in params.blendModes){if(params.blendModes.hasOwnProperty(name)){o.blend[name]=name;o.blendModeTechniques[name]=params.blendModes[name]}}}o.techniqueParameters=gd.createTechniqueParameters({clipSpace:new Draw2D.prototype.floatArray(4),texture:null});o.currentRenderTarget=null;o.renderTargetStructs=[];o.state=o.drawStates.ready;o.scaleMode="none";o.blendMode="opaque";o.width=0;o.height=0;o.scissorX=0;o.scissorY=0;o.scissorWidth=o.graphicsDevice.width;o.scissorHeight=o.graphicsDevice.height;o.clipOffsetX=-1;o.clipOffsetY=1;o.clipScaleX=2/o.graphicsDevice.width;o.clipScaleY=-2/o.graphicsDevice.height;o.viewScaleX=1;o.viewScaleY=1;var initial=params.initialGpuMemory?params.initialGpuMemory:0;if(initial<140){initial=140}if(initial>2293760){initial=2293760}o.performanceData={gpuMemoryUsage:initial,minBatchSize:0,maxBatchSize:0,avgBatchSize:0,batchCount:0,dataTransfers:0};o.maxGpuMemory=params.maxGpuMemory?params.maxGpuMemory:2293760;if(o.maxGpuMemory<initial){o.maxGpuMemory=initial}var initialVertices=Math.floor(initial/140)*4;o.maxVertices=Math.floor(o.maxGpuMemory/140)*4;if(o.maxVertices>65536){o.maxVertices=65536}o.cpuStride=64;o.gpuStride=4;o.vertexBufferParameters={numVertices:initialVertices,attributes:[gd.VERTEXFORMAT_FLOAT2,gd.VERTEXFORMAT_FLOAT4,gd.VERTEXFORMAT_FLOAT2],"transient":true};o.vertexBuffer=gd.createVertexBuffer(o.vertexBufferParameters);o.semantics=gd.createSemantics([gd.SEMANTIC_POSITION,gd.SEMANTIC_COLOR,gd.SEMANTIC_TEXCOORD0]);o.indexBufferParameters={numIndices:initialVertices*1.5,format:gd.INDEXFORMAT_USHORT,dynamic:false,data:o.indexData(initialVertices*1.5)};o.indexBuffer=gd.createIndexBuffer(o.indexBufferParameters);o.renderTargetIndex=0;o.renderTargetCount=0;o.renderTargetTextureParameters={name:"",width:0,height:0,depth:1,format:"R8G8B8A8",cubemap:false,mipmaps:true,renderable:true,dynamic:true};o.renderTargetParams={colorTexture0:null};o.copyTechnique=shader.getTechnique("copy");o.copyTechniqueParameters=gd.createTechniqueParameters({inputTexture0:null,copyFlip:1,copyUVScale:new Draw2D.prototype.floatArray([1,1])});o.quadSemantics=gd.createSemantics([gd.SEMANTIC_POSITION,gd.SEMANTIC_TEXCOORD0]);o.quadPrimitive=gd.PRIMITIVE_TRIANGLE_STRIP;o.copyVertexBufferParams={numVertices:4,attributes:[gd.VERTEXFORMAT_FLOAT2,gd.VERTEXFORMAT_FLOAT2],"transient":true};o.copyVertexBuffer=gd.createVertexBuffer(o.copyVertexBufferParams);o.vertexBufferData=new Draw2D.prototype.floatArray([-1,-1,0,0,1,-1,1,0,-1,1,0,1,1,1,1,1]);return o};(function(){Draw2D.prototype.uint16Array=function(arg){if(arguments.length===0){return[]}var i,ret;if(typeof arg==="number"){ret=new Array(arg)}else{ret=[];for(i=0;i<arg.length;i+=1){ret[i]=arg[i]}}return ret};var testArray;var textDescriptor;if(typeof Uint16Array!=="undefined"){testArray=new Uint16Array(4);textDescriptor=Object.prototype.toString.call(testArray);if(textDescriptor==="[object Uint16Array]"){Draw2D.prototype.uint16Array=Uint16Array}}Draw2D.prototype.floatArray=function(arg){if(arguments.length===0){return[]}var i,ret;if(typeof arg==="number"){ret=new Array(arg)}else{ret=[];for(i=0;i<arg.length;i+=1){ret[i]=arg[i]}}return ret};if(typeof Float32Array!=="undefined"){testArray=new Float32Array(4);textDescriptor=Object.prototype.toString.call(testArray);if(textDescriptor==="[object Float32Array]"){Draw2D.prototype.floatArray=Float32Array;Draw2D.prototype.defaultClearColor=new Float32Array(Draw2D.prototype.defaultClearColor)}}})();var TurbulenzServices;function ServiceRequester(){}ServiceRequester.prototype={request:function requestFn(params){var discardRequestFn=function discardRequestFn(){if(params.callback){params.callback({ok:false,msg:"Service Unavailable. Discarding request"},503)}};var that=this;var serviceStatusObserver=this.serviceStatusObserver;var onServiceStatusChange;onServiceStatusChange=function onServiceStatusChangeFn(running,discardRequest){if(discardRequest){if(!params.neverDiscard){serviceStatusObserver.unsubscribe(onServiceStatusChange);discardRequestFn()}}else if(running){serviceStatusObserver.unsubscribe(onServiceStatusChange);that.request(params)}};if(!this.running){if(this.discardRequests&&!params.neverDiscard){TurbulenzEngine.setTimeout(discardRequestFn,0);return false}if(!params.waiting){params.waiting=true;serviceStatusObserver.subscribe(onServiceStatusChange)}return true}var oldCustomErrorHandler=params.customErrorHandler;params.customErrorHandler=function checkServiceUnavailableFn(callContext,makeRequest,responseJSON,status){if(status===503){var responseObj=JSON.parse(responseJSON);var statusObj=responseObj.data;var discardRequests=statusObj?statusObj.discardRequests:true;that.discardRequests=discardRequests;if(discardRequests&&!params.neverDiscard){discardRequestFn()}else{serviceStatusObserver.subscribe(onServiceStatusChange)}TurbulenzServices.serviceUnavailable(that,callContext);return false}else{if(oldCustomErrorHandler){return oldCustomErrorHandler.call(params.requestHandler,callContext,makeRequest,responseJSON,status)}return true}};Utilities.ajax(params);return true}};ServiceRequester.create=function apiServiceCreateFn(serviceName,params){var serviceRequester=new ServiceRequester;if(!params){params={}}serviceRequester.running=true;serviceRequester.discardRequests=false;serviceRequester.serviceStatusObserver=Observer.create();serviceRequester.serviceName=serviceName;serviceRequester.onServiceUnavailable=params.onServiceUnavailable;serviceRequester.onServiceAvailable=params.onServiceAvailable;return serviceRequester};TurbulenzServices={multiplayerJoinRequestQueue:{argsQueue:[],handler:function nopFn(){},context:undefined,paused:true,onEvent:function onEventFn(handler,context){this.handler=handler;this.context=context},push:function pushFn(sessionId){var args=[sessionId];if(this.paused){this.argsQueue.push(args)}else{this.handler.apply(this.context,args)}},shift:function shiftFn(){var args=this.argsQueue.shift();return args?args[0]:undefined},clear:function clearFn(){this.argsQueue=[]},pause:function pauseFn(){this.paused=true},resume:function resumeFn(){this.paused=false;while(this.argsQueue.length){this.handler.apply(this.context,this.argsQueue.shift());if(this.paused){break}}}},available:function turbulenzServicesAvailableFn(){return window.gameSlug!==undefined},addBridgeEvents:function addBridgeEventsFn(){var turbulenz=window.top.Turbulenz;var turbulenzData=turbulenz&&turbulenz.Data||{};var sessionToJoin=turbulenzData.joinMultiplayerSessionId;var that=this;var onJoinMultiplayerSession=function onJoinMultiplayerSessionFn(joinMultiplayerSessionId){that.multiplayerJoinRequestQueue.push(joinMultiplayerSessionId)};var onReceiveConfig=function onReceiveConfigFn(configString){var config=JSON.parse(configString);if(config.mode){that.mode=config.mode}if(config.joinMultiplayerSessionId){that.multiplayerJoinRequestQueue.push(config.joinMultiplayerSessionId)}that.bridgeServices=!!config.bridgeServices};if(sessionToJoin){this.multiplayerJoinRequestQueue.push(sessionToJoin)}TurbulenzBridge.setOnMultiplayerSessionToJoin(onJoinMultiplayerSession);TurbulenzBridge.setOnReceiveConfig(onReceiveConfig);TurbulenzBridge.triggerRequestConfig();this.responseHandlers=[null];this.responseIndex=0;TurbulenzBridge.on("bridgeservices.response",function(jsondata){that.routeResponse(jsondata)})},callOnBridge:function turbulenzServicesCallOnBridgeFn(event,data,callback){var request={data:data};if(callback){this.responseIndex+=1;this.responseHandlers[this.responseIndex]=callback;request.key=this.responseIndex}TurbulenzBridge.emit("bridgeservices."+event,JSON.stringify(request))},addSignature:function turbulenzServicesAddSignatureFn(data,url){var str;data.requestUrl=url;str=TurbulenzEngine.encrypt(JSON.stringify(data));data.str=str;data.signature=TurbulenzEngine.generateSignature(str);return data},routeResponse:function routeResponseFn(jsondata){var response=JSON.parse(jsondata);var index=response.key||0;var callback=this.responseHandlers[index];if(callback){this.responseHandlers[index]=null;callback(response.data)}},defaultErrorCallback:function turbulenzServicesDefaultErrorCallbackFn(errorMsg,httpStatus){},onServiceUnavailable:function turbulenzServicesOnServiceUnavailableFn(serviceName,callContext){},onServiceAvailable:function turbulenzServicesOnServiceAvailableFn(serviceName,callContext){},createGameSession:function turbulenzServicesCreateGameSession(requestHandler,sessionCreatedFn,errorCallbackFn){return GameSession.create(requestHandler,sessionCreatedFn,errorCallbackFn)},createMappingTable:function turbulenzServicesCreateMappingTable(requestHandler,gameSession,tableRecievedFn,defaultMappingSettings,errorCallbackFn){var mappingTable=new MappingTable;var mappingTableSettings=gameSession&&gameSession.mappingTable;if(mappingTableSettings){mappingTable.mappingTableURL=mappingTableSettings.mappingTableURL;mappingTable.mappingTablePrefix=mappingTableSettings.mappingTablePrefix;mappingTable.assetPrefix=mappingTableSettings.assetPrefix}else if(defaultMappingSettings){mappingTable.mappingTableURL=defaultMappingSettings.mappingTableURL||(defaultMappingSettings.mappingTableURL===""?"":"mapping_table.json");mappingTable.mappingTablePrefix=defaultMappingSettings.mappingTablePrefix||(defaultMappingSettings.mappingTablePrefix===""?"":"staticmax/");mappingTable.assetPrefix=defaultMappingSettings.assetPrefix||(defaultMappingSettings.assetPrefix===""?"":"missing/")}else{mappingTable.mappingTableURL="mapping_table.json";mappingTable.mappingTablePrefix="staticmax/";mappingTable.assetPrefix="missing/"}mappingTable.errorCallbackFn=errorCallbackFn||TurbulenzServices.defaultErrorCallback;if(!mappingTable.mappingTableURL){mappingTable.errorCallbackFn("TurbulenzServices.createMappingTable no mapping table file given")}function createMappingTableCallbackFn(urlMappingData){var urlMapping=urlMappingData.urnmapping||urlMappingData.urnremapping||{};mappingTable.urlMapping=urlMapping;var mappingTablePrefix=mappingTable.mappingTablePrefix;if(mappingTablePrefix){var source;for(source in urlMapping){if(urlMapping.hasOwnProperty(source)){urlMapping[source]=mappingTablePrefix+urlMapping[source]}}}tableRecievedFn(mappingTable)}requestHandler.request({src:mappingTable.mappingTableURL,onload:function jsonifyResponse(jsonResponse,status){if(status===200){var obj=JSON.parse(jsonResponse);createMappingTableCallbackFn(obj);return}jsonResponse=jsonResponse||{msg:"(no response)"};mappingTable.errorCallbackFn("TurbulenzServices.createMappingTable error with HTTP status "+status+": "+jsonResponse.msg,status);mappingTable.urlMapping=defaultMappingSettings&&(defaultMappingSettings.urnMapping||{});tableRecievedFn(mappingTable)}});return mappingTable},createLeaderboardManager:function turbulenzServicesCreateLeaderboardManager(requestHandler,gameSession,leaderboardMetaRecieved,errorCallbackFn){return LeaderboardManager.create(requestHandler,gameSession,leaderboardMetaRecieved,errorCallbackFn)},createBadgeManager:function turbulenzServicesCreateBadgeManager(requestHandler,gameSession){return BadgeManager.create(requestHandler,gameSession)},createStoreManager:function turbulenzServicesCreateStoreManager(requestHandler,gameSession,storeMetaRecieved,errorCallbackFn){return StoreManager.create(requestHandler,gameSession,storeMetaRecieved,errorCallbackFn)},createMultiplayerSessionManager:function turbulenzServicescreateMultiplayerSessionManagerFn(requestHandler,gameSession){return MultiPlayerSessionManager.create(requestHandler,gameSession)},createUserProfile:function turbulenzServicesCreateUserProfile(requestHandler,profileRecievedFn,errorCallbackFn){var userProfile={};if(!errorCallbackFn){errorCallbackFn=TurbulenzServices.defaultErrorCallback}function loadUserProfileCallbackFn(userProfileData){if(userProfileData&&userProfileData.ok){userProfileData=userProfileData.data;var p;for(p in userProfileData){if(userProfileData.hasOwnProperty(p)){userProfile[p]=userProfileData[p]}}}}var url="/api/v1/profiles/user";if(TurbulenzServices.available()){this.getService("profiles").request({url:url,method:"GET",callback:function createUserProfileAjaxErrorCheck(jsonResponse,status){if(status===200){loadUserProfileCallbackFn(jsonResponse)}else if(errorCallbackFn){errorCallbackFn("TurbulenzServices.createUserProfile error with HTTP status "+status+": "+jsonResponse.msg,status)}profileRecievedFn(userProfile)},requestHandler:requestHandler})}return userProfile},sendCustomMetricEvent:function turbulenzServicesSendCustomMetricEvent(eventKey,eventValue,requestHandler,gameSession,errorCallbackFn){if(!errorCallbackFn){errorCallbackFn=TurbulenzServices.defaultErrorCallback}if(!TurbulenzServices.available()){if(errorCallbackFn){errorCallbackFn("TurbulenzServices.sendCustomMetricEvent failed: Service not available",0)}return}if("string"!==typeof eventKey||0===eventKey.length){if(errorCallbackFn){errorCallbackFn("TurbulenzServices.sendCustomMetricEvent failed: Event key must be a non-empty string",0)}return}if(isNaN(parseFloat(eventValue))||!isFinite(eventValue)){if("[object Array]"!==Object.prototype.toString.call(eventValue)){if(errorCallbackFn){errorCallbackFn("TurbulenzServices.sendCustomMetricEvent failed: Event value must be a number or an array of numbers",0)}return}var i,valuesLength=eventValue.length;for(i=0;i<valuesLength;i+=1){if(isNaN(parseFloat(eventValue[i]))||!isFinite(eventValue[i])){if(errorCallbackFn){errorCallbackFn("TurbulenzServices.sendCustomMetricEvent failed: Event value array elements must be numbers",0)}return}}}this.getService("customMetrics").request({url:"/api/v1/custommetrics/add-event/"+gameSession.gameSlug,method:"POST",data:{key:eventKey,value:eventValue,gameSessionId:gameSession.gameSessionId},callback:function sendCustomMetricEventAjaxErrorCheck(jsonResponse,status){if(status!==200&&errorCallbackFn){errorCallbackFn("TurbulenzServices.sendCustomMetricEvent error with HTTP status "+status+": "+jsonResponse.msg,status)}},requestHandler:requestHandler,encrypt:true})},services:{},waitingServices:{},pollingServiceStatus:false,defaultPollInterval:4e3,getService:function getServiceFn(serviceName){var services=this.services;if(services.hasOwnProperty(serviceName)){return services[serviceName]}else{var service=ServiceRequester.create(serviceName);services[serviceName]=service;return service}},serviceUnavailable:function serviceUnavailableFn(service,callContext){var waitingServices=this.waitingServices;var serviceName=service.serviceName;if(waitingServices.hasOwnProperty(serviceName)){return}waitingServices[serviceName]=service;service.running=false;var onServiceUnavailableCallbacks=function onServiceUnavailableCallbacksFn(service){var onServiceUnavailable=callContext.onServiceUnavailable;if(onServiceUnavailable){onServiceUnavailable.call(service,callContext)}if(service.onServiceUnavailable){service.onServiceUnavailable()}if(TurbulenzServices.onServiceUnavailable){TurbulenzServices.onServiceUnavailable(service)}};if(service.discardRequests){onServiceUnavailableCallbacks(service)}if(this.pollingServiceStatus){return}var that=this;var pollServiceStatus;var serviceUrl="/api/v1/service-status/game/read/"+window.gameSlug;var servicesStatusCB=function servicesStatusCBFn(responseObj,status){if(status===200){var statusObj=responseObj.data;var servicesObj=statusObj.services;var retry=false;var serviceName;for(serviceName in waitingServices){if(waitingServices.hasOwnProperty(serviceName)){var service=waitingServices[serviceName];var serviceData=servicesObj[serviceName];var serviceRunning=serviceData.running;service.running=serviceRunning;service.description=serviceData.description;if(serviceRunning){if(service.discardRequests){var onServiceAvailable=callContext.onServiceAvailable;if(onServiceAvailable){onServiceAvailable.call(service,callContext)}if(service.onServiceAvailable){service.onServiceAvailable()}if(TurbulenzServices.onServiceAvailable){TurbulenzServices.onServiceAvailable(service)}}delete waitingServices[serviceName];service.discardRequests=false;service.serviceStatusObserver.notify(serviceRunning,service.discardRequests)}else{if(serviceData.discardRequests&&!service.discardRequests){service.discardRequests=true;onServiceUnavailableCallbacks(service);service.serviceStatusObserver.notify(serviceRunning,service.discardRequests)}retry=true}}}if(!retry){this.pollingServiceStatus=false;return}TurbulenzEngine.setTimeout(pollServiceStatus,statusObj.pollInterval*1e3)}else{TurbulenzEngine.setTimeout(pollServiceStatus,that.defaultPollInterval)}};pollServiceStatus=function pollServiceStatusFn(){Utilities.ajax({url:serviceUrl,method:"GET",callback:servicesStatusCB})};pollServiceStatus()}};if(typeof TurbulenzBridge!=="undefined"){TurbulenzServices.addBridgeEvents()}var TurbulenzBridge={_bridge:undefined,_initInstance:function _initInstanceFn(){var Turbulenz=window.top.Turbulenz;if(Turbulenz&&Turbulenz.Services){var bridge=Turbulenz.Services.bridge;if(!bridge){return}this._bridge=bridge;this.emit=bridge.emit;this.on=bridge.gameListenerOn||bridge.addListener||bridge.setListener;this.addListener=bridge.gameListenerOn||bridge.addListener||bridge.setListener;this.setListener=bridge.gameListenerOn||bridge.setListener}if(typeof TurbulenzServices!=="undefined"){TurbulenzServices.addBridgeEvents()}},isInitialised:function isInitialisedFn(){return this._bridge!==undefined},emit:function emitFn(){},on:function onFn(){},addListener:function addListenerFn(){},setListener:function setListenerFn(){},setOnReceiveConfig:function setOnReceiveConfigFn(callback){this.on("config.set",callback)},triggerRequestConfig:function triggerRequestConfigFn(){this.emit("config.request")},startLoading:function startLoadingFn(){this.emit("status.loading.start")},startSaving:function startSavingFn(){this.emit("status.saving.start")},stopLoading:function stopLoadingFn(){this.emit("status.loading.stop")},stopSaving:function stopSavingFn(){this.emit("status.saving.stop")},createdGameSession:function createdGameSessionFn(gameSessionId){this.emit("game.session.created",gameSessionId)},destroyedGameSession:function destroyedGameSessionFn(gameSessionId){this.emit("game.session.destroyed",gameSessionId)},setGameSessionStatus:function setGameSessionStatusFn(gameSessionId,status){this.emit("game.session.status",gameSessionId,status)},setGameSessionInfo:function setGameSessionInfoFn(info){this.emit("game.session.info",info)},updateUserBadge:function updateUserBadgeFn(badge){this.emit("userbadge.update",badge)},updateLeaderBoard:function updateLeaderBoardFn(scoreData){this.emit("leaderboards.update",scoreData)},setOnMultiplayerSessionToJoin:function setOnMultiplayerSessionToJoinFn(callback){this.on("multiplayer.session.join",callback)},triggerJoinedMultiplayerSession:function triggerJoinedMultiplayerSessionFn(session){this.emit("multiplayer.session.joined",session)},triggerLeaveMultiplayerSession:function triggerLeaveMultiplayerSessionFn(sessionId){this.emit("multiplayer.session.leave",sessionId)},triggerMultiplayerSessionMakePublic:function triggerMultiplayerSessionMakePublicFn(sessionId){this.emit("multiplayer.session.makepublic")},setOnBasketUpdate:function setOnBasketUpdateFn(callback){this.on("basket.site.update",callback)},triggerBasketUpdate:function triggerBasketUpdateFn(basket){this.emit("basket.game.update",basket)},triggerUserStoreUpdate:function triggerUserStoreUpdateFn(items){this.emit("store.user.update",items)},setOnPurchaseConfirmed:function setOnPurchaseConfirmedFn(callback){this.on("purchase.confirmed",callback)
},setOnPurchaseRejected:function setOnPurchaseRejectedFn(callback){this.on("purchase.rejected",callback)},triggerShowConfirmPurchase:function triggerShowConfirmPurchaseFn(){this.emit("purchase.show.confirm")},triggerFetchStoreMeta:function triggerFetchStoreMetaFn(){this.emit("fetch.store.meta")},setOnStoreMeta:function setOnStoreMetaFn(callback){this.on("store.meta.v2",callback)},changeAspectRatio:function changeAspectRatioFn(ratio){this.emit("change.viewport.ratio",ratio)},setOnViewportHide:function setOnViewportHideFn(callback){this.on("change.viewport.hide",callback)},setOnViewportShow:function setOnViewportShowFn(callback){this.on("change.viewport.show",callback)},setOnFullscreenOn:function setOnFullscreenOnFn(callback){this.on("change.viewport.fullscreen.on",callback)},setOnFullscreenOff:function setOnFullscreenOffFn(callback){this.on("change.viewport.fullscreen.off",callback)},setOnMenuStateChange:function setOnMenuStateChangeFn(callback){this.on("change.menu.state",callback)},setOnUserStateChange:function setOnUserStateChangeFn(callback){this.on("change.user.state",callback)},triggerOnFullscreen:function triggerOnFullscreenQueryFn(){this.emit("trigger.viewport.fullscreen")},triggerOnViewportVisibility:function triggerOnViewportVisibilityQueryFn(){this.emit("trigger.viewport.visibility")},triggerOnMenuStateChange:function triggerOnMenuStateQueryFn(){this.emit("trigger.menu.state")},triggerOnUserStateChange:function triggerOnUserStateQueryFn(){this.emit("trigger.user.state")},queryFullscreen:function queryFullscreenFn(callback){this.emit("query.viewport.fullscreen",callback)},queryViewportVisibility:function queryViewportVisibilityFn(callback){this.emit("query.viewport.visibility",callback)},queryMenuState:function queryMenuStateFn(callback){this.emit("query.menu.state",callback)},queryUserState:function queryUserStateFn(callback){this.emit("query.user.state",callback)}};if(!TurbulenzBridge.isInitialised()){TurbulenzBridge._initInstance()}function GameSession(){}GameSession.prototype={version:1,post_delay:1e3,setStatus:function gameSessionSetStatusFn(status){if(this.destroyed||this.status===status){return}this.status=status;TurbulenzBridge.setGameSessionStatus(this.gameSessionId,status)},destroy:function gameSessionDestroyFn(callbackFn){var dataSpec;if(this.pendingUpdate){TurbulenzEngine.clearTimeout(this.pendingUpdate);this.pendingUpdate=null}if(!this.destroyed&&this.gameSessionId){TurbulenzBridge.destroyedGameSession(this.gameSessionId);this.destroyed=true;dataSpec={gameSessionId:this.gameSessionId};if(TurbulenzServices.bridgeServices){TurbulenzServices.callOnBridge("gamesession.destroy",dataSpec,callbackFn)}else{Utilities.ajax({url:"/api/v1/games/destroy-session",method:"POST",data:dataSpec,callback:callbackFn,requestHandler:this.requestHandler})}}else{if(callbackFn){TurbulenzEngine.setTimeout(callbackFn,0)}}},setTeamInfo:function gameSessionSetTeamInfoFn(teamList){var sessionData=this.info.sessionData;var oldTeamList=sessionData.teamList||[];if(teamList.join("#")!==oldTeamList.join("#")){sessionData.teamList=teamList;this.update()}},setPlayerInfo:function gameSessionSetPlayerInfoFn(playerId,data){var playerData=this.info.playerSessionData[playerId];var key;var dirty=false;if(!playerData){playerData={};this.info.playerSessionData[playerId]=playerData;dirty=true}for(key in data){if(data.hasOwnProperty(key)){if(!this.templatePlayerData.hasOwnProperty(key)){throw"unknown session data property "+key}if(playerData[key]!==data[key]){playerData[key]=data[key];dirty=true}}}if(dirty){this.update()}},removePlayerInfo:function gameSessionRemovePlayerInfoFn(playerId){delete this.info.playerSessionData[playerId];this.update()},clearAllPlayerInfo:function clearAllPlayerInfoFn(){this.info.playerSessionData={};this.update()},update:function updateFn(){if(!this.pendingUpdate){this.pendingUpdate=TurbulenzEngine.setTimeout(this.postData,this.post_delay)}}};GameSession.create=function gameSessionCreateFn(requestHandler,sessionCreatedFn,errorCallbackFn){var gameSession=new GameSession;var gameSlug=window.gameSlug;var turbulenz=window.top.Turbulenz;var turbulenzData=turbulenz&&turbulenz.Data||{};var mode=turbulenzData.mode||TurbulenzServices.mode;var createSessionURL="/api/v1/games/create-session/"+gameSlug;var gameSessionRequestCallback=function gameSessionRequestCallbackFn(jsonResponse,status){if(status===200){gameSession.mappingTable=jsonResponse.mappingTable;gameSession.gameSessionId=jsonResponse.gameSessionId;if(sessionCreatedFn){sessionCreatedFn(gameSession)}TurbulenzBridge.createdGameSession(gameSession.gameSessionId)}else{gameSession.errorCallbackFn("TurbulenzServices.createGameSession error with HTTP status "+status+": "+jsonResponse.msg,status)}};gameSession.info={sessionData:{},playerSessionData:{}};gameSession.templatePlayerData={team:null,color:null,status:null,rank:null,score:null,sortkey:null};gameSession.postData=function postDataFn(){TurbulenzBridge.setGameSessionInfo(JSON.stringify(gameSession.info));gameSession.pendingUpdate=null};gameSession.pendingUpdate=null;gameSession.gameSlug=gameSlug;gameSession.requestHandler=requestHandler;gameSession.errorCallbackFn=errorCallbackFn||TurbulenzServices.defaultErrorCallback;gameSession.gameSessionId=null;gameSession.service=TurbulenzServices.getService("gameSessions");gameSession.status=null;if(!TurbulenzServices.available()){if(sessionCreatedFn){TurbulenzEngine.setTimeout(function sessionCreatedCall(){sessionCreatedFn(gameSession)},0)}return gameSession}if(mode){createSessionURL+="/"+mode}gameSession.service.request({url:createSessionURL,method:"POST",callback:gameSessionRequestCallback,requestHandler:requestHandler,neverDiscard:true});return gameSession};function Observer(){}Observer.prototype={subscribe:function observerSubscribeFn(subscriber){var subscribers=this.subscribers;var length=subscribers.length;for(var index=0;index<length;index+=1){if(subscribers[index]===subscriber){return}}subscribers.push(subscriber)},unsubscribe:function observerUnsubscribeFn(subscriber){var subscribers=this.subscribers;var length=subscribers.length;for(var index=0;index<length;index+=1){if(subscribers[index]===subscriber){subscribers.splice(index,1);break}}},unsubscribeAll:function observerUnsubscribeAllFn(subscriber){this.subscribers.length=0},notify:function observerNotifyFn(){var subscribers=this.subscribers;var length=this.subscribers.length;var index=0;while(index<length){subscribers[index].apply(null,arguments);if(subscribers.length===length){index+=1}else{length=subscribers.length}}}};Observer.create=function observerCreateFn(){var observer=new Observer;observer.subscribers=[];return observer};var Utilities={};Utilities.skipAsserts=false;Utilities.assert=function assertFn(test,message){if(!test){if(!this.skipAsserts){this.breakInDebugger.doesNotExist()}}};Utilities.beget=function begetFn(o){var F=function(){};F.prototype=o;return new F};Utilities.log=function logFn(){var console=window.console;if(console){switch(arguments.length){case 1:console.log(arguments[0]);break;case 2:console.log(arguments[0],arguments[1]);break;case 3:console.log(arguments[0],arguments[1],arguments[2]);break;case 4:console.log(arguments[0],arguments[1],arguments[2],arguments[3]);break;default:var args=[].splice.call(arguments,0);console.log(args.join(" "));break}}};Utilities.nearestLowerPow2=function UtilitiesNearestLowerPow2(num){num=num|num>>>1;num=num|num>>>2;num=num|num>>>4;num=num|num>>>8;num=num|num>>>16;return num-(num>>>1)};Utilities.nearestUpperPow2=function UtilitiesNearestUpperPow2(num){num=num-1;num=num|num>>>1;num=num|num>>>2;num=num|num>>>4;num=num|num>>>8;num=num|num>>>16;return num+1};var MathDeviceConvert={v2ToArray:function v2ToJavaScriptArrayFn(v2){return[v2[0],v2[1]]},arrayToV2:function arrayToV2Fn(mathDevice,v2Array,v2Dest){return mathDevice.v2Build(v2Array[0],v2Array[1],v2Dest)},v3ToArray:function v3ToJavaScriptArrayFn(v3){return[v3[0],v3[1],v3[2]]},arrayToV3:function arrayToV3Fn(mathDevice,v3Array,v3Dest){return mathDevice.v3Build(v3Array[0],v3Array[1],v3Array[2],v3Dest)},v4ToArray:function v4ToJavaScriptArrayFn(v4){return[v4[0],v4[1],v4[2],v4[3]]},arrayToV4:function arrayToV4Fn(mathDevice,v4Array,v4Dest){return mathDevice.v4Build(v4Array[0],v4Array[1],v4Array[2],v4Array[3],v4Dest)},quatToArray:function quatToJavaScriptArrayFn(quat){return[quat[0],quat[1],quat[2],quat[3]]},arrayToQuat:function arrayToQuatFn(mathDevice,quatArray,quatDest){return mathDevice.quatBuild(quatArray[0],quatArray[1],quatArray[2],quatArray[3],quatDest)},aabbToArray:function aabbToJavaScriptArrayFn(aabb){return[aabb[0],aabb[1],aabb[2],aabb[3],aabb[4],aabb[5]]},arrayToAABB:function arrayToQuatFn(mathDevice,aabbArray,aabbDest){return mathDevice.aabbBuild(aabbArray[0],aabbArray[1],aabbArray[2],aabbArray[3],aabbArray[4],aabbArray[5],aabbDest)},quatPosToArray:function quatPosToJavaScriptArrayFn(quatPos){return[quatPos[0],quatPos[1],quatPos[2],quatPos[3],quatPos[4],quatPos[5],quatPos[6]]},arrayToQuatPos:function arrayToQuatPosFn(mathDevice,quatPosArray,quatPosDest){return mathDevice.quatPosBuild(quatPosArray[0],quatPosArray[1],quatPosArray[2],quatPosArray[3],quatPosArray[4],quatPosArray[5],quatPosArray[6],quatPosDest)},m33ToArray:function m33ToJavaScriptArrayFn(m33){return[m33[0],m33[1],m33[2],m33[3],m33[4],m33[5],m33[6],m33[7],m33[8]]},arrayToM33:function arrayToM33Fn(mathDevice,m33Array,m33Dest){return mathDevice.m33Build(m33Array[0],m33Array[1],m33Array[2],m33Array[3],m33Array[4],m33Array[5],m33Array[6],m33Array[7],m33Array[8],m33Dest)},m43ToArray:function m43ToJavaScriptArrayFn(m43){return[m43[0],m43[1],m43[2],m43[3],m43[4],m43[5],m43[6],m43[7],m43[8],m43[9],m43[10],m43[11]]},arrayToM43:function arrayToM43Fn(mathDevice,m43Array,m43Dest){return mathDevice.m43Build(m43Array[0],m43Array[1],m43Array[2],m43Array[3],m43Array[4],m43Array[5],m43Array[6],m43Array[7],m43Array[8],m43Array[9],m43Array[10],m43Array[11],m43Dest)},m34ToArray:function m34ToJavaScriptArrayFn(m34){return[m34[0],m34[1],m34[2],m34[3],m34[4],m34[5],m34[6],m34[7],m34[8],m34[9],m34[10],m34[11]]},m44ToArray:function m44ToJavaScriptArrayFn(m44){return[m44[0],m44[1],m44[2],m44[3],m44[4],m44[5],m44[6],m44[7],m44[8],m44[9],m44[10],m44[11],m44[12],m44[13],m44[14],m44[15]]},arrayToM44:function arrayToM44Fn(mathDevice,m44Array,m44Dest){return mathDevice.m44Build(m44Array[0],m44Array[1],m44Array[2],m44Array[3],m44Array[4],m44Array[5],m44Array[6],m44Array[7],m44Array[8],m44Array[9],m44Array[10],m44Array[11],m44Array[12],m44Array[13],m44Array[14],m44Array[15],m44Dest)}};Utilities.ajax=function utilitiesAjaxFn(params){var requestText="";var method=params.method;var data=params.data||{};var encrypted=params.encrypt;var signature=null;var url=params.url;var requestHandler=params.requestHandler;var callbackFn=params.callback;if(encrypted){data.requestUrl=url;var str=JSON.stringify(data);if(method==="POST"){str=TurbulenzEngine.encrypt(str)}requestText+="data="+encodeURIComponent(str)+"&";requestText+="gameSessionId="+encodeURIComponent(data.gameSessionId);signature=TurbulenzEngine.generateSignature(str)}else if(data){var key;for(key in data){if(data.hasOwnProperty(key)){if(requestText.length!==0){requestText+="&"}if(method==="POST"){requestText+=key+"="+data[key]}else{requestText+=encodeURIComponent(key)+"="+encodeURIComponent(data[key])}}}}var httpResponseCallback=function httpResponseCallbackFn(xhrResponseText,xhrStatus){var sig=this.xhr.getResponseHeader("X-TZ-Signature");this.xhr.onreadystatechange=null;this.xhr=null;var response;response=JSON.parse(xhrResponseText);if(encrypted){var validSignature=TurbulenzEngine.verifySignature(xhrResponseText,sig);xhrResponseText=null;TurbulenzEngine.setTimeout(function(){var receivedUrl=response.requestUrl;if(validSignature){if(!TurbulenzEngine.encryptionEnabled||receivedUrl===url){callbackFn(response,xhrStatus);callbackFn=null;return}}if(xhrStatus===400){callbackFn(response,xhrStatus,"Verification Failed")}else{callbackFn({msg:"Verification failed",ok:false},400,"Verification Failed")}callbackFn=null},0)}else{xhrResponseText=null;TurbulenzEngine.setTimeout(function(){callbackFn(response,xhrStatus);callbackFn=null},0)}};var httpRequest=function httpRequestFn(url,onload,callContext){var xhr;if(window.XMLHttpRequest){xhr=new window.XMLHttpRequest}else if(window.ActiveXObject){xhr=new window.ActiveXObject("Microsoft.XMLHTTP")}else{if(params.error){params.error("No XMLHTTPRequest object could be created")}return}callContext.xhr=xhr;var httpCallback=function httpCallbackFn(){if(xhr.readyState===4&&TurbulenzEngine&&!TurbulenzEngine.isUnloading()){var xhrResponseText=xhr.responseText;var xhrStatus=xhr.status;var xhrStatusText=xhrStatus!==0&&xhr.statusText||"No connection or cross domain request";if(xhr.getAllResponseHeaders()===""&&xhrResponseText===""&&xhrStatus===200&&xhrStatusText==="OK"){onload("",0);return}onload.call(callContext,xhrResponseText,xhrStatus)}};xhr.open(method,requestText&&method!=="POST"?url+"?"+requestText:url,true);if(callbackFn){xhr.onreadystatechange=httpCallback}if(signature){xhr.setRequestHeader("X-TZ-Signature",signature)}if(method==="POST"){xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=UTF-8");xhr.send(requestText)}else{xhr.send()}};if(requestHandler){requestHandler.request({src:url,requestFn:httpRequest,customErrorHandler:params.customErrorHandler,onload:httpResponseCallback})}else{var callContext={src:url};httpRequest(url,httpResponseCallback,callContext)}};Utilities.ajaxStatusCodes={0:"No Connection, Timeout Or Cross Domain Request",100:"Continue",101:"Switching Protocols",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Time-out",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Large",415:"Unsupported Media Type",416:"Requested range not satisfiable",417:"Expectation Failed",429:"Too Many Requests",480:"Temporarily Unavailable",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Time-out",505:"HTTP Version not supported"};function Reference(){}Reference.prototype={version:1,add:function referenceAddFn(){this.referenceCount+=1},remove:function referenceRemovefn(){this.referenceCount-=1;if(this.referenceCount===0){if(this.destroyedObserver){this.destroyedObserver.notify(this.object)}this.object.destroy();this.object=null}},subscribeDestroyed:function referenceSubscribeDestroyedFn(observerFunction){if(!this.destroyedObserver){this.destroyedObserver=Observer.create()}this.destroyedObserver.subscribe(observerFunction)},unsubscribeDestroyed:function referenceDestroyedFn(observerFunction){this.destroyedObserver.unsubscribe(observerFunction)}};Reference.create=function referenceCreate(object){var result=new Reference;result.object=object;result.referenceCount=0;return result};var Profile={profiles:[],sortMode:{alphabetical:0,duration:1,max:2,min:3,calls:4},start:function profileStartFn(name){var data=this.profiles[name];if(!data){data={name:name,calls:0,duration:0,min:Number.MAX_VALUE,max:0,sumOfSquares:0};this.profiles[name]=data}data.start=TurbulenzEngine.time},stop:function profileStopFn(name){var end=TurbulenzEngine.time;var data=this.profiles[name];if(data){var duration=end-data.start;data.duration+=duration;data.calls+=1;var delta=duration-data.duration/data.calls;data.sumOfSquares+=delta*delta;if(duration>data.max){data.max=duration}if(duration<data.min){data.min=duration}}},reset:function profileResetFn(){this.profiles=[]},getReport:function profileGetReportFn(sortMode,format){var dataArray=[];var data;var maxDuration=0;var name;for(name in this.profiles){if(this.profiles.hasOwnProperty(name)){data=this.profiles[name];if(maxDuration<data.duration){maxDuration=data.duration}dataArray.push(data)}}var compareFunction;if(sortMode===Profile.sortMode.alphabetical){compareFunction=function compareName(left,right){return left.name<right.name?-1:left.name>right.name?1:0}}else if(sortMode===Profile.sortMode.max){compareFunction=function compareMax(left,right){return right.max-left.max}}else if(sortMode===Profile.sortMode.min){compareFunction=function compareMin(left,right){return right.min-left.min}}else if(sortMode===Profile.sortMode.calls){compareFunction=function compareCalls(left,right){return right.calls-left.calls}}else{compareFunction=function compareDuration(left,right){return right.duration-left.duration}}dataArray.sort(compareFunction);var line;var text="";var precision=format?format.precision:8;var percentagePrecision=format?format.percentagePrecision:1;var seperator=format?format.seperator:" ";var length=dataArray.length;var index;for(index=0;index<length;index+=1){data=dataArray[index];line=data.name;line+=seperator+data.calls;line+=seperator+data.duration.toFixed(precision);line+=seperator+data.max.toFixed(precision);line+=seperator+data.min.toFixed(precision);line+=seperator+(data.duration/data.calls).toFixed(precision);line+=seperator+Math.sqrt(data.sumOfSquares/data.calls).toFixed(precision);line+=seperator+(100*data.duration/maxDuration).toFixed(percentagePrecision)+"%\n";text+=line}return text}};var JSProfiling={};JSProfiling.createArray=function JSProfilingCreateArrayFn(rootNode){var map={};var array=[];if(rootNode.head){rootNode=rootNode.head}var processNode=function processNodeFn(node){var urlObject=map[node.url];if(!urlObject){urlObject={};map[node.url]=urlObject}var functionName=node.functionName===""?"(anonymous)":node.functionName;var functionObject=urlObject[functionName];if(!functionObject){functionObject={};urlObject[functionName]=functionObject}var existingNode=functionObject[node.lineNumber];if(!existingNode){var newNode={functionName:functionName,numberOfCalls:node.numberOfCalls,totalTime:node.totalTime,selfTime:node.selfTime,url:node.url,lineNumber:node.lineNumber};array[array.length]=newNode;functionObject[node.lineNumber]=newNode}else{existingNode.totalTime+=node.totalTime;existingNode.selfTime+=node.selfTime;existingNode.numberOfCalls+=node.numberOfCalls}var children=node.children;if(children){var numberOfChildren=children.length;var childIndex;for(childIndex=0;childIndex<numberOfChildren;childIndex+=1){processNode(children[childIndex])}}};processNode(rootNode);return array};JSProfiling.sort=function JSProfilingSortFn(array,propertyName,descending){if(!propertyName){propertyName="totalTime"}var sorterAscending=function(left,right){return left[propertyName]-right[propertyName]};var sorterDescending=function(left,right){return right[propertyName]-left[propertyName]};if(descending===false){array.sort(sorterAscending)}else{array.sort(sorterDescending)}};(function(A,w){function ma(){if(!c.isReady){try{s.documentElement.doScroll("left")}catch(a){setTimeout(ma,1);return}c.ready()}}function Qa(a,b){b.src?c.ajax({url:b.src,async:false,dataType:"script"}):c.globalEval(b.text||b.textContent||b.innerHTML||"");b.parentNode&&b.parentNode.removeChild(b)}function X(a,b,d,f,e,j){var i=a.length;if(typeof b==="object"){for(var o in b)X(a,o,b[o],f,e,d);return a}if(d!==w){f=!j&&f&&c.isFunction(d);for(o=0;o<i;o++)e(a[o],b,f?d.call(a[o],o,e(a[o],b)):d,j);return a}return i?e(a[0],b):w}function J(){return(new Date).getTime()}function Y(){return false}function Z(){return true}function na(a,b,d){d[0].type=a;return c.event.handle.apply(b,d)}function oa(a){var b,d=[],f=[],e=arguments,j,i,o,k,n,r;i=c.data(this,"events");if(!(a.liveFired===this||!i||!i.live||a.button&&a.type==="click")){a.liveFired=this;var u=i.live.slice(0);for(k=0;k<u.length;k++){i=u[k];i.origType.replace(O,"")===a.type?f.push(i.selector):u.splice(k--,1)}j=c(a.target).closest(f,a.currentTarget);n=0;for(r=j.length;n<r;n++)for(k=0;k<u.length;k++){i=u[k];if(j[n].selector===i.selector){o=j[n].elem;f=null;if(i.preType==="mouseenter"||i.preType==="mouseleave")f=c(a.relatedTarget).closest(i.selector)[0];if(!f||f!==o)d.push({elem:o,handleObj:i})}}n=0;for(r=d.length;n<r;n++){j=d[n];a.currentTarget=j.elem;a.data=j.handleObj.data;a.handleObj=j.handleObj;if(j.handleObj.origHandler.apply(j.elem,e)===false){b=false;break}}return b}}function pa(a,b){return"live."+(a&&a!=="*"?a+".":"")+b.replace(/\./g,"`").replace(/ /g,"&")}function qa(a){return!a||!a.parentNode||a.parentNode.nodeType===11}function ra(a,b){var d=0;b.each(function(){if(this.nodeName===(a[d]&&a[d].nodeName)){var f=c.data(a[d++]),e=c.data(this,f);if(f=f&&f.events){delete e.handle;e.events={};for(var j in f)for(var i in f[j])c.event.add(this,j,f[j][i],f[j][i].data)}}})}function sa(a,b,d){var f,e,j;b=b&&b[0]?b[0].ownerDocument||b[0]:s;if(a.length===1&&typeof a[0]==="string"&&a[0].length<512&&b===s&&!ta.test(a[0])&&(c.support.checkClone||!ua.test(a[0]))){e=true;if(j=c.fragments[a[0]])if(j!==1)f=j}if(!f){f=b.createDocumentFragment();c.clean(a,b,f,d)}if(e)c.fragments[a[0]]=j?f:1;return{fragment:f,cacheable:e}}function K(a,b){var d={};c.each(va.concat.apply([],va.slice(0,b)),function(){d[this]=a});return d}function wa(a){return"scrollTo"in a&&a.document?a:a.nodeType===9?a.defaultView||a.parentWindow:false}var c=function(a,b){return new c.fn.init(a,b)},Ra=A.jQuery,Sa=A.$,s=A.document,T,Ta=/^[^<]*(<[\w\W]+>)[^>]*$|^#([\w-]+)$/,Ua=/^.[^:#\[\.,]*$/,Va=/\S/,Wa=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,Xa=/^<(\w+)\s*\/?>(?:<\/\1>)?$/,P=navigator.userAgent,xa=false,Q=[],L,$=Object.prototype.toString,aa=Object.prototype.hasOwnProperty,ba=Array.prototype.push,R=Array.prototype.slice,ya=Array.prototype.indexOf;c.fn=c.prototype={init:function(a,b){var d,f;if(!a)return this;if(a.nodeType){this.context=this[0]=a;this.length=1;return this}if(a==="body"&&!b){this.context=s;this[0]=s.body;this.selector="body";this.length=1;return this}if(typeof a==="string")if((d=Ta.exec(a))&&(d[1]||!b))if(d[1]){f=b?b.ownerDocument||b:s;if(a=Xa.exec(a))if(c.isPlainObject(b)){a=[s.createElement(a[1])];c.fn.attr.call(a,b,true)}else a=[f.createElement(a[1])];else{a=sa([d[1]],[f]);a=(a.cacheable?a.fragment.cloneNode(true):a.fragment).childNodes}return c.merge(this,a)}else{if(b=s.getElementById(d[2])){if(b.id!==d[2])return T.find(a);this.length=1;this[0]=b}this.context=s;this.selector=a;return this}else if(!b&&/^\w+$/.test(a)){this.selector=a;this.context=s;a=s.getElementsByTagName(a);return c.merge(this,a)}else return!b||b.jquery?(b||T).find(a):c(b).find(a);else if(c.isFunction(a))return T.ready(a);if(a.selector!==w){this.selector=a.selector;this.context=a.context}return c.makeArray(a,this)},selector:"",jquery:"1.4.2",length:0,size:function(){return this.length},toArray:function(){return R.call(this,0)},get:function(a){return a==null?this.toArray():a<0?this.slice(a)[0]:this[a]},pushStack:function(a,b,d){var f=c();c.isArray(a)?ba.apply(f,a):c.merge(f,a);f.prevObject=this;f.context=this.context;if(b==="find")f.selector=this.selector+(this.selector?" ":"")+d;else if(b)f.selector=this.selector+"."+b+"("+d+")";return f},each:function(a,b){return c.each(this,a,b)},ready:function(a){c.bindReady();if(c.isReady)a.call(s,c);else Q&&Q.push(a);return this},eq:function(a){return a===-1?this.slice(a):this.slice(a,+a+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(R.apply(this,arguments),"slice",R.call(arguments).join(","))},map:function(a){return this.pushStack(c.map(this,function(b,d){return a.call(b,d,b)}))},end:function(){return this.prevObject||c(null)},push:ba,sort:[].sort,splice:[].splice};c.fn.init.prototype=c.fn;c.extend=c.fn.extend=function(){var a=arguments[0]||{},b=1,d=arguments.length,f=false,e,j,i,o;if(typeof a==="boolean"){f=a;a=arguments[1]||{};b=2}if(typeof a!=="object"&&!c.isFunction(a))a={};if(d===b){a=this;--b}for(;b<d;b++)if((e=arguments[b])!=null)for(j in e){i=a[j];o=e[j];if(a!==o)if(f&&o&&(c.isPlainObject(o)||c.isArray(o))){i=i&&(c.isPlainObject(i)||c.isArray(i))?i:c.isArray(o)?[]:{};a[j]=c.extend(f,i,o)}else if(o!==w)a[j]=o}return a};c.extend({noConflict:function(a){A.$=Sa;if(a)A.jQuery=Ra;return c},isReady:false,ready:function(){if(!c.isReady){if(!s.body)return setTimeout(c.ready,13);c.isReady=true;if(Q){for(var a,b=0;a=Q[b++];)a.call(s,c);Q=null}c.fn.triggerHandler&&c(s).triggerHandler("ready")}},bindReady:function(){if(!xa){xa=true;if(s.readyState==="complete")return c.ready();if(s.addEventListener){s.addEventListener("DOMContentLoaded",L,false);A.addEventListener("load",c.ready,false)}else if(s.attachEvent){s.attachEvent("onreadystatechange",L);A.attachEvent("onload",c.ready);var a=false;try{a=A.frameElement==null}catch(b){}s.documentElement.doScroll&&a&&ma()}}},isFunction:function(a){return $.call(a)==="[object Function]"},isArray:function(a){return $.call(a)==="[object Array]"},isPlainObject:function(a){if(!a||$.call(a)!=="[object Object]"||a.nodeType||a.setInterval)return false;if(a.constructor&&!aa.call(a,"constructor")&&!aa.call(a.constructor.prototype,"isPrototypeOf"))return false;var b;for(b in a);return b===w||aa.call(a,b)},isEmptyObject:function(a){for(var b in a)return false;return true},error:function(a){throw a},parseJSON:function(a){if(typeof a!=="string"||!a)return null;a=c.trim(a);if(/^[\],:{}\s]*$/.test(a.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return A.JSON&&A.JSON.parse?A.JSON.parse(a):new Function("return "+a)();else c.error("Invalid JSON: "+a)},noop:function(){},globalEval:function(a){if(a&&Va.test(a)){var b=s.getElementsByTagName("head")[0]||s.documentElement,d=s.createElement("script");d.type="text/javascript";if(c.support.scriptEval)d.appendChild(s.createTextNode(a));else d.text=a;b.insertBefore(d,b.firstChild);b.removeChild(d)}},nodeName:function(a,b){return a.nodeName&&a.nodeName.toUpperCase()===b.toUpperCase()},each:function(a,b,d){var f,e=0,j=a.length,i=j===w||c.isFunction(a);if(d)if(i)for(f in a){if(b.apply(a[f],d)===false)break}else for(;e<j;){if(b.apply(a[e++],d)===false)break}else if(i)for(f in a){if(b.call(a[f],f,a[f])===false)break}else for(d=a[0];e<j&&b.call(d,e,d)!==false;d=a[++e]);return a},trim:function(a){return(a||"").replace(Wa,"")},makeArray:function(a,b){b=b||[];if(a!=null)a.length==null||typeof a==="string"||c.isFunction(a)||typeof a!=="function"&&a.setInterval?ba.call(b,a):c.merge(b,a);return b},inArray:function(a,b){if(b.indexOf)return b.indexOf(a);for(var d=0,f=b.length;d<f;d++)if(b[d]===a)return d;return-1},merge:function(a,b){var d=a.length,f=0;if(typeof b.length==="number")for(var e=b.length;f<e;f++)a[d++]=b[f];else for(;b[f]!==w;)a[d++]=b[f++];a.length=d;return a},grep:function(a,b,d){for(var f=[],e=0,j=a.length;e<j;e++)!d!==!b(a[e],e)&&f.push(a[e]);return f},map:function(a,b,d){for(var f=[],e,j=0,i=a.length;j<i;j++){e=b(a[j],j,d);if(e!=null)f[f.length]=e}return f.concat.apply([],f)},guid:1,proxy:function(a,b,d){if(arguments.length===2)if(typeof b==="string"){d=a;a=d[b];b=w}else if(b&&!c.isFunction(b)){d=b;b=w}if(!b&&a)b=function(){return a.apply(d||this,arguments)};if(a)b.guid=a.guid=a.guid||b.guid||c.guid++;return b},uaMatch:function(a){a=a.toLowerCase();a=/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version)?[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||!/compatible/.test(a)&&/(mozilla)(?:.*? rv:([\w.]+))?/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}},browser:{}});P=c.uaMatch(P);if(P.browser){c.browser[P.browser]=true;c.browser.version=P.version}if(c.browser.webkit)c.browser.safari=true;if(ya)c.inArray=function(a,b){return ya.call(b,a)};T=c(s);if(s.addEventListener)L=function(){s.removeEventListener("DOMContentLoaded",L,false);c.ready()};else if(s.attachEvent)L=function(){if(s.readyState==="complete"){s.detachEvent("onreadystatechange",L);c.ready()}};(function(){c.support={};var a=s.documentElement,b=s.createElement("script"),d=s.createElement("div"),f="script"+J();d.style.display="none";d.innerHTML="   <link/><table></table><a href='/a' style='color:red;float:left;opacity:.55;'>a</a><input type='checkbox'/>";var e=d.getElementsByTagName("*"),j=d.getElementsByTagName("a")[0];if(!(!e||!e.length||!j)){c.support={leadingWhitespace:d.firstChild.nodeType===3,tbody:!d.getElementsByTagName("tbody").length,htmlSerialize:!!d.getElementsByTagName("link").length,style:/red/.test(j.getAttribute("style")),hrefNormalized:j.getAttribute("href")==="/a",opacity:/^0.55$/.test(j.style.opacity),cssFloat:!!j.style.cssFloat,checkOn:d.getElementsByTagName("input")[0].value==="on",optSelected:s.createElement("select").appendChild(s.createElement("option")).selected,parentNode:d.removeChild(d.appendChild(s.createElement("div"))).parentNode===null,deleteExpando:true,checkClone:false,scriptEval:false,noCloneEvent:true,boxModel:null};b.type="text/javascript";try{b.appendChild(s.createTextNode("window."+f+"=1;"))}catch(i){}a.insertBefore(b,a.firstChild);if(A[f]){c.support.scriptEval=true;delete A[f]}try{delete b.test}catch(o){c.support.deleteExpando=false}a.removeChild(b);if(d.attachEvent&&d.fireEvent){d.attachEvent("onclick",function k(){c.support.noCloneEvent=false;d.detachEvent("onclick",k)});d.cloneNode(true).fireEvent("onclick")}d=s.createElement("div");d.innerHTML="<input type='radio' name='radiotest' checked='checked'/>";a=s.createDocumentFragment();a.appendChild(d.firstChild);c.support.checkClone=a.cloneNode(true).cloneNode(true).lastChild.checked;c(function(){var k=s.createElement("div");k.style.width=k.style.paddingLeft="1px";s.body.appendChild(k);c.boxModel=c.support.boxModel=k.offsetWidth===2;s.body.removeChild(k).style.display="none"});a=function(k){var n=s.createElement("div");k="on"+k;var r=k in n;if(!r){n.setAttribute(k,"return;");r=typeof n[k]==="function"}return r};c.support.submitBubbles=a("submit");c.support.changeBubbles=a("change");a=b=d=e=j=null}})();c.props={"for":"htmlFor","class":"className",readonly:"readOnly",maxlength:"maxLength",cellspacing:"cellSpacing",rowspan:"rowSpan",colspan:"colSpan",tabindex:"tabIndex",usemap:"useMap",frameborder:"frameBorder"};var G="jQuery"+J(),Ya=0,za={};c.extend({cache:{},expando:G,noData:{embed:true,object:true,applet:true},data:function(a,b,d){if(!(a.nodeName&&c.noData[a.nodeName.toLowerCase()])){a=a==A?za:a;var f=a[G],e=c.cache;if(!f&&typeof b==="string"&&d===w)return null;f||(f=++Ya);if(typeof b==="object"){a[G]=f;e[f]=c.extend(true,{},b)}else if(!e[f]){a[G]=f;e[f]={}}a=e[f];if(d!==w)a[b]=d;return typeof b==="string"?a[b]:a}},removeData:function(a,b){if(!(a.nodeName&&c.noData[a.nodeName.toLowerCase()])){a=a==A?za:a;var d=a[G],f=c.cache,e=f[d];if(b){if(e){delete e[b];c.isEmptyObject(e)&&c.removeData(a)}}else{if(c.support.deleteExpando)delete a[c.expando];else a.removeAttribute&&a.removeAttribute(c.expando);delete f[d]}}}});c.fn.extend({data:function(a,b){if(typeof a==="undefined"&&this.length)return c.data(this[0]);else if(typeof a==="object")return this.each(function(){c.data(this,a)});var d=a.split(".");d[1]=d[1]?"."+d[1]:"";if(b===w){var f=this.triggerHandler("getData"+d[1]+"!",[d[0]]);if(f===w&&this.length)f=c.data(this[0],a);return f===w&&d[1]?this.data(d[0]):f}else return this.trigger("setData"+d[1]+"!",[d[0],b]).each(function(){c.data(this,a,b)})},removeData:function(a){return this.each(function(){c.removeData(this,a)})}});c.extend({queue:function(a,b,d){if(a){b=(b||"fx")+"queue";var f=c.data(a,b);if(!d)return f||[];if(!f||c.isArray(d))f=c.data(a,b,c.makeArray(d));else f.push(d);return f}},dequeue:function(a,b){b=b||"fx";var d=c.queue(a,b),f=d.shift();if(f==="inprogress")f=d.shift();if(f){b==="fx"&&d.unshift("inprogress");f.call(a,function(){c.dequeue(a,b)})}}});c.fn.extend({queue:function(a,b){if(typeof a!=="string"){b=a;a="fx"}if(b===w)return c.queue(this[0],a);return this.each(function(){var d=c.queue(this,a,b);a==="fx"&&d[0]!=="inprogress"&&c.dequeue(this,a)
})},dequeue:function(a){return this.each(function(){c.dequeue(this,a)})},delay:function(a,b){a=c.fx?c.fx.speeds[a]||a:a;b=b||"fx";return this.queue(b,function(){var d=this;setTimeout(function(){c.dequeue(d,b)},a)})},clearQueue:function(a){return this.queue(a||"fx",[])}});var Aa=/[\n\t]/g,ca=/\s+/,Za=/\r/g,$a=/href|src|style/,ab=/(button|input)/i,bb=/(button|input|object|select|textarea)/i,cb=/^(a|area)$/i,Ba=/radio|checkbox/;c.fn.extend({attr:function(a,b){return X(this,a,b,true,c.attr)},removeAttr:function(a){return this.each(function(){c.attr(this,a,"");this.nodeType===1&&this.removeAttribute(a)})},addClass:function(a){if(c.isFunction(a))return this.each(function(n){var r=c(this);r.addClass(a.call(this,n,r.attr("class")))});if(a&&typeof a==="string")for(var b=(a||"").split(ca),d=0,f=this.length;d<f;d++){var e=this[d];if(e.nodeType===1)if(e.className){for(var j=" "+e.className+" ",i=e.className,o=0,k=b.length;o<k;o++)if(j.indexOf(" "+b[o]+" ")<0)i+=" "+b[o];e.className=c.trim(i)}else e.className=a}return this},removeClass:function(a){if(c.isFunction(a))return this.each(function(k){var n=c(this);n.removeClass(a.call(this,k,n.attr("class")))});if(a&&typeof a==="string"||a===w)for(var b=(a||"").split(ca),d=0,f=this.length;d<f;d++){var e=this[d];if(e.nodeType===1&&e.className)if(a){for(var j=(" "+e.className+" ").replace(Aa," "),i=0,o=b.length;i<o;i++)j=j.replace(" "+b[i]+" "," ");e.className=c.trim(j)}else e.className=""}return this},toggleClass:function(a,b){var d=typeof a,f=typeof b==="boolean";if(c.isFunction(a))return this.each(function(e){var j=c(this);j.toggleClass(a.call(this,e,j.attr("class"),b),b)});return this.each(function(){if(d==="string")for(var e,j=0,i=c(this),o=b,k=a.split(ca);e=k[j++];){o=f?o:!i.hasClass(e);i[o?"addClass":"removeClass"](e)}else if(d==="undefined"||d==="boolean"){this.className&&c.data(this,"__className__",this.className);this.className=this.className||a===false?"":c.data(this,"__className__")||""}})},hasClass:function(a){a=" "+a+" ";for(var b=0,d=this.length;b<d;b++)if((" "+this[b].className+" ").replace(Aa," ").indexOf(a)>-1)return true;return false},val:function(a){if(a===w){var b=this[0];if(b){if(c.nodeName(b,"option"))return(b.attributes.value||{}).specified?b.value:b.text;if(c.nodeName(b,"select")){var d=b.selectedIndex,f=[],e=b.options;b=b.type==="select-one";if(d<0)return null;var j=b?d:0;for(d=b?d+1:e.length;j<d;j++){var i=e[j];if(i.selected){a=c(i).val();if(b)return a;f.push(a)}}return f}if(Ba.test(b.type)&&!c.support.checkOn)return b.getAttribute("value")===null?"on":b.value;return(b.value||"").replace(Za,"")}return w}var o=c.isFunction(a);return this.each(function(k){var n=c(this),r=a;if(this.nodeType===1){if(o)r=a.call(this,k,n.val());if(typeof r==="number")r+="";if(c.isArray(r)&&Ba.test(this.type))this.checked=c.inArray(n.val(),r)>=0;else if(c.nodeName(this,"select")){var u=c.makeArray(r);c("option",this).each(function(){this.selected=c.inArray(c(this).val(),u)>=0});if(!u.length)this.selectedIndex=-1}else this.value=r}})}});c.extend({attrFn:{val:true,css:true,html:true,text:true,data:true,width:true,height:true,offset:true},attr:function(a,b,d,f){if(!a||a.nodeType===3||a.nodeType===8)return w;if(f&&b in c.attrFn)return c(a)[b](d);f=a.nodeType!==1||!c.isXMLDoc(a);var e=d!==w;b=f&&c.props[b]||b;if(a.nodeType===1){var j=$a.test(b);if(b in a&&f&&!j){if(e){b==="type"&&ab.test(a.nodeName)&&a.parentNode&&c.error("type property can't be changed");a[b]=d}if(c.nodeName(a,"form")&&a.getAttributeNode(b))return a.getAttributeNode(b).nodeValue;if(b==="tabIndex")return(b=a.getAttributeNode("tabIndex"))&&b.specified?b.value:bb.test(a.nodeName)||cb.test(a.nodeName)&&a.href?0:w;return a[b]}if(!c.support.style&&f&&b==="style"){if(e)a.style.cssText=""+d;return a.style.cssText}e&&a.setAttribute(b,""+d);a=!c.support.hrefNormalized&&f&&j?a.getAttribute(b,2):a.getAttribute(b);return a===null?w:a}return c.style(a,b,d)}});var O=/\.(.*)$/,db=function(a){return a.replace(/[^\w\s\.\|`]/g,function(b){return"\\"+b})};c.event={add:function(a,b,d,f){if(!(a.nodeType===3||a.nodeType===8)){if(a.setInterval&&a!==A&&!a.frameElement)a=A;var e,j;if(d.handler){e=d;d=e.handler}if(!d.guid)d.guid=c.guid++;if(j=c.data(a)){var i=j.events=j.events||{},o=j.handle;if(!o)j.handle=o=function(){return typeof c!=="undefined"&&!c.event.triggered?c.event.handle.apply(o.elem,arguments):w};o.elem=a;b=b.split(" ");for(var k,n=0,r;k=b[n++];){j=e?c.extend({},e):{handler:d,data:f};if(k.indexOf(".")>-1){r=k.split(".");k=r.shift();j.namespace=r.slice(0).sort().join(".")}else{r=[];j.namespace=""}j.type=k;j.guid=d.guid;var u=i[k],z=c.event.special[k]||{};if(!u){u=i[k]=[];if(!z.setup||z.setup.call(a,f,r,o)===false)if(a.addEventListener)a.addEventListener(k,o,false);else a.attachEvent&&a.attachEvent("on"+k,o)}if(z.add){z.add.call(a,j);if(!j.handler.guid)j.handler.guid=d.guid}u.push(j);c.event.global[k]=true}a=null}}},global:{},remove:function(a,b,d,f){if(!(a.nodeType===3||a.nodeType===8)){var e,j=0,i,o,k,n,r,u,z=c.data(a),C=z&&z.events;if(z&&C){if(b&&b.type){d=b.handler;b=b.type}if(!b||typeof b==="string"&&b.charAt(0)==="."){b=b||"";for(e in C)c.event.remove(a,e+b)}else{for(b=b.split(" ");e=b[j++];){n=e;i=e.indexOf(".")<0;o=[];if(!i){o=e.split(".");e=o.shift();k=new RegExp("(^|\\.)"+c.map(o.slice(0).sort(),db).join("\\.(?:.*\\.)?")+"(\\.|$)")}if(r=C[e])if(d){n=c.event.special[e]||{};for(B=f||0;B<r.length;B++){u=r[B];if(d.guid===u.guid){if(i||k.test(u.namespace)){f==null&&r.splice(B--,1);n.remove&&n.remove.call(a,u)}if(f!=null)break}}if(r.length===0||f!=null&&r.length===1){if(!n.teardown||n.teardown.call(a,o)===false)Ca(a,e,z.handle);delete C[e]}}else for(var B=0;B<r.length;B++){u=r[B];if(i||k.test(u.namespace)){c.event.remove(a,n,u.handler,B);r.splice(B--,1)}}}if(c.isEmptyObject(C)){if(b=z.handle)b.elem=null;delete z.events;delete z.handle;c.isEmptyObject(z)&&c.removeData(a)}}}}},trigger:function(a,b,d,f){var e=a.type||a;if(!f){a=typeof a==="object"?a[G]?a:c.extend(c.Event(e),a):c.Event(e);if(e.indexOf("!")>=0){a.type=e=e.slice(0,-1);a.exclusive=true}if(!d){a.stopPropagation();c.event.global[e]&&c.each(c.cache,function(){this.events&&this.events[e]&&c.event.trigger(a,b,this.handle.elem)})}if(!d||d.nodeType===3||d.nodeType===8)return w;a.result=w;a.target=d;b=c.makeArray(b);b.unshift(a)}a.currentTarget=d;(f=c.data(d,"handle"))&&f.apply(d,b);f=d.parentNode||d.ownerDocument;try{if(!(d&&d.nodeName&&c.noData[d.nodeName.toLowerCase()]))if(d["on"+e]&&d["on"+e].apply(d,b)===false)a.result=false}catch(j){}if(!a.isPropagationStopped()&&f)c.event.trigger(a,b,f,true);else if(!a.isDefaultPrevented()){f=a.target;var i,o=c.nodeName(f,"a")&&e==="click",k=c.event.special[e]||{};if((!k._default||k._default.call(d,a)===false)&&!o&&!(f&&f.nodeName&&c.noData[f.nodeName.toLowerCase()])){try{if(f[e]){if(i=f["on"+e])f["on"+e]=null;c.event.triggered=true;f[e]()}}catch(n){}if(i)f["on"+e]=i;c.event.triggered=false}}},handle:function(a){var b,d,f,e;a=arguments[0]=c.event.fix(a||A.event);a.currentTarget=this;b=a.type.indexOf(".")<0&&!a.exclusive;if(!b){d=a.type.split(".");a.type=d.shift();f=new RegExp("(^|\\.)"+d.slice(0).sort().join("\\.(?:.*\\.)?")+"(\\.|$)")}e=c.data(this,"events");d=e[a.type];if(e&&d){d=d.slice(0);e=0;for(var j=d.length;e<j;e++){var i=d[e];if(b||f.test(i.namespace)){a.handler=i.handler;a.data=i.data;a.handleObj=i;i=i.handler.apply(this,arguments);if(i!==w){a.result=i;if(i===false){a.preventDefault();a.stopPropagation()}}if(a.isImmediatePropagationStopped())break}}}return a.result},props:"altKey attrChange attrName bubbles button cancelable charCode clientX clientY ctrlKey currentTarget data detail eventPhase fromElement handler keyCode layerX layerY metaKey newValue offsetX offsetY originalTarget pageX pageY prevValue relatedNode relatedTarget screenX screenY shiftKey srcElement target toElement view wheelDelta which".split(" "),fix:function(a){if(a[G])return a;var b=a;a=c.Event(b);for(var d=this.props.length,f;d;){f=this.props[--d];a[f]=b[f]}if(!a.target)a.target=a.srcElement||s;if(a.target.nodeType===3)a.target=a.target.parentNode;if(!a.relatedTarget&&a.fromElement)a.relatedTarget=a.fromElement===a.target?a.toElement:a.fromElement;if(a.pageX==null&&a.clientX!=null){b=s.documentElement;d=s.body;a.pageX=a.clientX+(b&&b.scrollLeft||d&&d.scrollLeft||0)-(b&&b.clientLeft||d&&d.clientLeft||0);a.pageY=a.clientY+(b&&b.scrollTop||d&&d.scrollTop||0)-(b&&b.clientTop||d&&d.clientTop||0)}if(!a.which&&(a.charCode||a.charCode===0?a.charCode:a.keyCode))a.which=a.charCode||a.keyCode;if(!a.metaKey&&a.ctrlKey)a.metaKey=a.ctrlKey;if(!a.which&&a.button!==w)a.which=a.button&1?1:a.button&2?3:a.button&4?2:0;return a},guid:1e8,proxy:c.proxy,special:{ready:{setup:c.bindReady,teardown:c.noop},live:{add:function(a){c.event.add(this,a.origType,c.extend({},a,{handler:oa}))},remove:function(a){var b=true,d=a.origType.replace(O,"");c.each(c.data(this,"events").live||[],function(){if(d===this.origType.replace(O,""))return b=false});b&&c.event.remove(this,a.origType,oa)}},beforeunload:{setup:function(a,b,d){if(this.setInterval)this.onbeforeunload=d;return false},teardown:function(a,b){if(this.onbeforeunload===b)this.onbeforeunload=null}}}};var Ca=s.removeEventListener?function(a,b,d){a.removeEventListener(b,d,false)}:function(a,b,d){a.detachEvent("on"+b,d)};c.Event=function(a){if(!this.preventDefault)return new c.Event(a);if(a&&a.type){this.originalEvent=a;this.type=a.type}else this.type=a;this.timeStamp=J();this[G]=true};c.Event.prototype={preventDefault:function(){this.isDefaultPrevented=Z;var a=this.originalEvent;if(a){a.preventDefault&&a.preventDefault();a.returnValue=false}},stopPropagation:function(){this.isPropagationStopped=Z;var a=this.originalEvent;if(a){a.stopPropagation&&a.stopPropagation();a.cancelBubble=true}},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=Z;this.stopPropagation()},isDefaultPrevented:Y,isPropagationStopped:Y,isImmediatePropagationStopped:Y};var Da=function(a){var b=a.relatedTarget;try{for(;b&&b!==this;)b=b.parentNode;if(b!==this){a.type=a.data;c.event.handle.apply(this,arguments)}}catch(d){}},Ea=function(a){a.type=a.data;c.event.handle.apply(this,arguments)};c.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(a,b){c.event.special[a]={setup:function(d){c.event.add(this,b,d&&d.selector?Ea:Da,a)},teardown:function(d){c.event.remove(this,b,d&&d.selector?Ea:Da)}}});if(!c.support.submitBubbles)c.event.special.submit={setup:function(){if(this.nodeName.toLowerCase()!=="form"){c.event.add(this,"click.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="submit"||d==="image")&&c(b).closest("form").length)return na("submit",this,arguments)});c.event.add(this,"keypress.specialSubmit",function(a){var b=a.target,d=b.type;if((d==="text"||d==="password")&&c(b).closest("form").length&&a.keyCode===13)return na("submit",this,arguments)})}else return false},teardown:function(){c.event.remove(this,".specialSubmit")}};if(!c.support.changeBubbles){var da=/textarea|input|select/i,ea,Fa=function(a){var b=a.type,d=a.value;if(b==="radio"||b==="checkbox")d=a.checked;else if(b==="select-multiple")d=a.selectedIndex>-1?c.map(a.options,function(f){return f.selected}).join("-"):"";else if(a.nodeName.toLowerCase()==="select")d=a.selectedIndex;return d},fa=function(a,b){var d=a.target,f,e;if(!(!da.test(d.nodeName)||d.readOnly)){f=c.data(d,"_change_data");e=Fa(d);if(a.type!=="focusout"||d.type!=="radio")c.data(d,"_change_data",e);if(!(f===w||e===f))if(f!=null||e){a.type="change";return c.event.trigger(a,b,d)}}};c.event.special.change={filters:{focusout:fa,click:function(a){var b=a.target,d=b.type;if(d==="radio"||d==="checkbox"||b.nodeName.toLowerCase()==="select")return fa.call(this,a)},keydown:function(a){var b=a.target,d=b.type;if(a.keyCode===13&&b.nodeName.toLowerCase()!=="textarea"||a.keyCode===32&&(d==="checkbox"||d==="radio")||d==="select-multiple")return fa.call(this,a)},beforeactivate:function(a){a=a.target;c.data(a,"_change_data",Fa(a))}},setup:function(){if(this.type==="file")return false;for(var a in ea)c.event.add(this,a+".specialChange",ea[a]);return da.test(this.nodeName)},teardown:function(){c.event.remove(this,".specialChange");return da.test(this.nodeName)}};ea=c.event.special.change.filters}s.addEventListener&&c.each({focus:"focusin",blur:"focusout"},function(a,b){function d(f){f=c.event.fix(f);f.type=b;return c.event.handle.call(this,f)}c.event.special[b]={setup:function(){this.addEventListener(a,d,true)},teardown:function(){this.removeEventListener(a,d,true)}}});c.each(["bind","one"],function(a,b){c.fn[b]=function(d,f,e){if(typeof d==="object"){for(var j in d)this[b](j,f,d[j],e);return this}if(c.isFunction(f)){e=f;f=w}var i=b==="one"?c.proxy(e,function(k){c(this).unbind(k,i);return e.apply(this,arguments)}):e;if(d==="unload"&&b!=="one")this.one(d,f,e);else{j=0;for(var o=this.length;j<o;j++)c.event.add(this[j],d,i,f)}return this}});c.fn.extend({unbind:function(a,b){if(typeof a==="object"&&!a.preventDefault)for(var d in a)this.unbind(d,a[d]);else{d=0;for(var f=this.length;d<f;d++)c.event.remove(this[d],a,b)}return this},delegate:function(a,b,d,f){return this.live(b,d,f,a)},undelegate:function(a,b,d){return arguments.length===0?this.unbind("live"):this.die(b,null,d,a)},trigger:function(a,b){return this.each(function(){c.event.trigger(a,b,this)})},triggerHandler:function(a,b){if(this[0]){a=c.Event(a);a.preventDefault();a.stopPropagation();c.event.trigger(a,b,this[0]);return a.result}},toggle:function(a){for(var b=arguments,d=1;d<b.length;)c.proxy(a,b[d++]);return this.click(c.proxy(a,function(f){var e=(c.data(this,"lastToggle"+a.guid)||0)%d;c.data(this,"lastToggle"+a.guid,e+1);f.preventDefault();return b[e].apply(this,arguments)||false}))},hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Ga={focus:"focusin",blur:"focusout",mouseenter:"mouseover",mouseleave:"mouseout"};c.each(["live","die"],function(a,b){c.fn[b]=function(d,f,e,j){var i,o=0,k,n,r=j||this.selector,u=j?this:c(this.context);if(c.isFunction(f)){e=f;f=w}for(d=(d||"").split(" ");(i=d[o++])!=null;){j=O.exec(i);k="";if(j){k=j[0];i=i.replace(O,"")}if(i==="hover")d.push("mouseenter"+k,"mouseleave"+k);else{n=i;if(i==="focus"||i==="blur"){d.push(Ga[i]+k);i+=k}else i=(Ga[i]||i)+k;b==="live"?u.each(function(){c.event.add(this,pa(i,r),{data:f,selector:r,handler:e,origType:i,origHandler:e,preType:n})}):u.unbind(pa(i,r),e)}}return this}});c.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error".split(" "),function(a,b){c.fn[b]=function(d){return d?this.bind(b,d):this.trigger(b)};if(c.attrFn)c.attrFn[b]=true});A.attachEvent&&!A.addEventListener&&A.attachEvent("onunload",function(){for(var a in c.cache)if(c.cache[a].handle)try{c.event.remove(c.cache[a].handle.elem)}catch(b){}});(function(){function a(g){for(var h="",l,m=0;g[m];m++){l=g[m];if(l.nodeType===3||l.nodeType===4)h+=l.nodeValue;else if(l.nodeType!==8)h+=a(l.childNodes)}return h}function b(g,h,l,m,q,p){q=0;for(var v=m.length;q<v;q++){var t=m[q];if(t){t=t[g];for(var y=false;t;){if(t.sizcache===l){y=m[t.sizset];break}if(t.nodeType===1&&!p){t.sizcache=l;t.sizset=q}if(t.nodeName.toLowerCase()===h){y=t;break}t=t[g]}m[q]=y}}}function d(g,h,l,m,q,p){q=0;for(var v=m.length;q<v;q++){var t=m[q];if(t){t=t[g];for(var y=false;t;){if(t.sizcache===l){y=m[t.sizset];break}if(t.nodeType===1){if(!p){t.sizcache=l;t.sizset=q}if(typeof h!=="string"){if(t===h){y=true;break}}else if(k.filter(h,[t]).length>0){y=t;break}}t=t[g]}m[q]=y}}}var f=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?((?:.|\r|\n)*)/g,e=0,j=Object.prototype.toString,i=false,o=true;[0,0].sort(function(){o=false;return 0});var k=function(g,h,l,m){l=l||[];var q=h=h||s;if(h.nodeType!==1&&h.nodeType!==9)return[];if(!g||typeof g!=="string")return l;for(var p=[],v,t,y,S,H=true,M=x(h),I=g;(f.exec(""),v=f.exec(I))!==null;){I=v[3];p.push(v[1]);if(v[2]){S=v[3];break}}if(p.length>1&&r.exec(g))if(p.length===2&&n.relative[p[0]])t=ga(p[0]+p[1],h);else for(t=n.relative[p[0]]?[h]:k(p.shift(),h);p.length;){g=p.shift();if(n.relative[g])g+=p.shift();t=ga(g,t)}else{if(!m&&p.length>1&&h.nodeType===9&&!M&&n.match.ID.test(p[0])&&!n.match.ID.test(p[p.length-1])){v=k.find(p.shift(),h,M);h=v.expr?k.filter(v.expr,v.set)[0]:v.set[0]}if(h){v=m?{expr:p.pop(),set:z(m)}:k.find(p.pop(),p.length===1&&(p[0]==="~"||p[0]==="+")&&h.parentNode?h.parentNode:h,M);t=v.expr?k.filter(v.expr,v.set):v.set;if(p.length>0)y=z(t);else H=false;for(;p.length;){var D=p.pop();v=D;if(n.relative[D])v=p.pop();else D="";if(v==null)v=h;n.relative[D](y,v,M)}}else y=[]}y||(y=t);y||k.error(D||g);if(j.call(y)==="[object Array]")if(H)if(h&&h.nodeType===1)for(g=0;y[g]!=null;g++){if(y[g]&&(y[g]===true||y[g].nodeType===1&&E(h,y[g])))l.push(t[g])}else for(g=0;y[g]!=null;g++)y[g]&&y[g].nodeType===1&&l.push(t[g]);else l.push.apply(l,y);else z(y,l);if(S){k(S,q,l,m);k.uniqueSort(l)}return l};k.uniqueSort=function(g){if(B){i=o;g.sort(B);if(i)for(var h=1;h<g.length;h++)g[h]===g[h-1]&&g.splice(h--,1)}return g};k.matches=function(g,h){return k(g,null,null,h)};k.find=function(g,h,l){var m,q;if(!g)return[];for(var p=0,v=n.order.length;p<v;p++){var t=n.order[p];if(q=n.leftMatch[t].exec(g)){var y=q[1];q.splice(1,1);if(y.substr(y.length-1)!=="\\"){q[1]=(q[1]||"").replace(/\\/g,"");m=n.find[t](q,h,l);if(m!=null){g=g.replace(n.match[t],"");break}}}}m||(m=h.getElementsByTagName("*"));return{set:m,expr:g}};k.filter=function(g,h,l,m){for(var q=g,p=[],v=h,t,y,S=h&&h[0]&&x(h[0]);g&&h.length;){for(var H in n.filter)if((t=n.leftMatch[H].exec(g))!=null&&t[2]){var M=n.filter[H],I,D;D=t[1];y=false;t.splice(1,1);if(D.substr(D.length-1)!=="\\"){if(v===p)p=[];if(n.preFilter[H])if(t=n.preFilter[H](t,v,l,p,m,S)){if(t===true)continue}else y=I=true;if(t)for(var U=0;(D=v[U])!=null;U++)if(D){I=M(D,t,U,v);var Ha=m^!!I;if(l&&I!=null)if(Ha)y=true;else v[U]=false;else if(Ha){p.push(D);y=true}}if(I!==w){l||(v=p);g=g.replace(n.match[H],"");if(!y)return[];break}}}if(g===q)if(y==null)k.error(g);else break;q=g}return v};k.error=function(g){throw"Syntax error, unrecognized expression: "+g};var n=k.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF-]|\\.)+)(?:\((['"]?)((?:\([^\)]+\)|[^\(\)]*)+)\2\))?/},leftMatch:{},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(g){return g.getAttribute("href")}},relative:{"+":function(g,h){var l=typeof h==="string",m=l&&!/\W/.test(h);l=l&&!m;if(m)h=h.toLowerCase();m=0;for(var q=g.length,p;m<q;m++)if(p=g[m]){for(;(p=p.previousSibling)&&p.nodeType!==1;);g[m]=l||p&&p.nodeName.toLowerCase()===h?p||false:p===h}l&&k.filter(h,g,true)},">":function(g,h){var l=typeof h==="string";if(l&&!/\W/.test(h)){h=h.toLowerCase();for(var m=0,q=g.length;m<q;m++){var p=g[m];if(p){l=p.parentNode;g[m]=l.nodeName.toLowerCase()===h?l:false}}}else{m=0;for(q=g.length;m<q;m++)if(p=g[m])g[m]=l?p.parentNode:p.parentNode===h;l&&k.filter(h,g,true)}},"":function(g,h,l){var m=e++,q=d;if(typeof h==="string"&&!/\W/.test(h)){var p=h=h.toLowerCase();q=b}q("parentNode",h,m,g,p,l)},"~":function(g,h,l){var m=e++,q=d;if(typeof h==="string"&&!/\W/.test(h)){var p=h=h.toLowerCase();q=b}q("previousSibling",h,m,g,p,l)}},find:{ID:function(g,h,l){if(typeof h.getElementById!=="undefined"&&!l)return(g=h.getElementById(g[1]))?[g]:[]},NAME:function(g,h){if(typeof h.getElementsByName!=="undefined"){var l=[];h=h.getElementsByName(g[1]);for(var m=0,q=h.length;m<q;m++)h[m].getAttribute("name")===g[1]&&l.push(h[m]);return l.length===0?null:l}},TAG:function(g,h){return h.getElementsByTagName(g[1])}},preFilter:{CLASS:function(g,h,l,m,q,p){g=" "+g[1].replace(/\\/g,"")+" ";if(p)return g;p=0;for(var v;(v=h[p])!=null;p++)if(v)if(q^(v.className&&(" "+v.className+" ").replace(/[\t\n]/g," ").indexOf(g)>=0))l||m.push(v);else if(l)h[p]=false;return false},ID:function(g){return g[1].replace(/\\/g,"")},TAG:function(g){return g[1].toLowerCase()},CHILD:function(g){if(g[1]==="nth"){var h=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(g[2]==="even"&&"2n"||g[2]==="odd"&&"2n+1"||!/\D/.test(g[2])&&"0n+"+g[2]||g[2]);g[2]=h[1]+(h[2]||1)-0;g[3]=h[3]-0}g[0]=e++;return g},ATTR:function(g,h,l,m,q,p){h=g[1].replace(/\\/g,"");if(!p&&n.attrMap[h])g[1]=n.attrMap[h];if(g[2]==="~=")g[4]=" "+g[4]+" ";return g},PSEUDO:function(g,h,l,m,q){if(g[1]==="not")if((f.exec(g[3])||"").length>1||/^\w/.test(g[3]))g[3]=k(g[3],null,null,h);else{g=k.filter(g[3],h,l,true^q);l||m.push.apply(m,g);return false}else if(n.match.POS.test(g[0])||n.match.CHILD.test(g[0]))return true;return g},POS:function(g){g.unshift(true);return g}},filters:{enabled:function(g){return g.disabled===false&&g.type!=="hidden"},disabled:function(g){return g.disabled===true},checked:function(g){return g.checked===true},selected:function(g){return g.selected===true},parent:function(g){return!!g.firstChild},empty:function(g){return!g.firstChild},has:function(g,h,l){return!!k(l[3],g).length},header:function(g){return/h\d/i.test(g.nodeName)},text:function(g){return"text"===g.type},radio:function(g){return"radio"===g.type},checkbox:function(g){return"checkbox"===g.type},file:function(g){return"file"===g.type},password:function(g){return"password"===g.type},submit:function(g){return"submit"===g.type},image:function(g){return"image"===g.type},reset:function(g){return"reset"===g.type},button:function(g){return"button"===g.type||g.nodeName.toLowerCase()==="button"},input:function(g){return/input|select|textarea|button/i.test(g.nodeName)}},setFilters:{first:function(g,h){return h===0},last:function(g,h,l,m){return h===m.length-1},even:function(g,h){return h%2===0},odd:function(g,h){return h%2===1},lt:function(g,h,l){return h<l[3]-0},gt:function(g,h,l){return h>l[3]-0},nth:function(g,h,l){return l[3]-0===h},eq:function(g,h,l){return l[3]-0===h}},filter:{PSEUDO:function(g,h,l,m){var q=h[1],p=n.filters[q];if(p)return p(g,l,h,m);else if(q==="contains")return(g.textContent||g.innerText||a([g])||"").indexOf(h[3])>=0;else if(q==="not"){h=h[3];l=0;for(m=h.length;l<m;l++)if(h[l]===g)return false;return true}else k.error("Syntax error, unrecognized expression: "+q)},CHILD:function(g,h){var l=h[1],m=g;switch(l){case"only":case"first":for(;m=m.previousSibling;)if(m.nodeType===1)return false;if(l==="first")return true;m=g;case"last":for(;m=m.nextSibling;)if(m.nodeType===1)return false;return true;case"nth":l=h[2];var q=h[3];if(l===1&&q===0)return true;h=h[0];var p=g.parentNode;if(p&&(p.sizcache!==h||!g.nodeIndex)){var v=0;for(m=p.firstChild;m;m=m.nextSibling)if(m.nodeType===1)m.nodeIndex=++v;p.sizcache=h}g=g.nodeIndex-q;return l===0?g===0:g%l===0&&g/l>=0}},ID:function(g,h){return g.nodeType===1&&g.getAttribute("id")===h},TAG:function(g,h){return h==="*"&&g.nodeType===1||g.nodeName.toLowerCase()===h},CLASS:function(g,h){return(" "+(g.className||g.getAttribute("class"))+" ").indexOf(h)>-1},ATTR:function(g,h){var l=h[1];g=n.attrHandle[l]?n.attrHandle[l](g):g[l]!=null?g[l]:g.getAttribute(l);l=g+"";var m=h[2];h=h[4];return g==null?m==="!=":m==="="?l===h:m==="*="?l.indexOf(h)>=0:m==="~="?(" "+l+" ").indexOf(h)>=0:!h?l&&g!==false:m==="!="?l!==h:m==="^="?l.indexOf(h)===0:m==="$="?l.substr(l.length-h.length)===h:m==="|="?l===h||l.substr(0,h.length+1)===h+"-":false},POS:function(g,h,l,m){var q=n.setFilters[h[2]];if(q)return q(g,l,h,m)}}},r=n.match.POS;for(var u in n.match){n.match[u]=new RegExp(n.match[u].source+/(?![^\[]*\])(?![^\(]*\))/.source);n.leftMatch[u]=new RegExp(/(^(?:.|\r|\n)*?)/.source+n.match[u].source.replace(/\\(\d+)/g,function(g,h){return"\\"+(h-0+1)}))}var z=function(g,h){g=Array.prototype.slice.call(g,0);if(h){h.push.apply(h,g);return h}return g};try{Array.prototype.slice.call(s.documentElement.childNodes,0)}catch(C){z=function(g,h){h=h||[];if(j.call(g)==="[object Array]")Array.prototype.push.apply(h,g);else if(typeof g.length==="number")for(var l=0,m=g.length;l<m;l++)h.push(g[l]);else for(l=0;g[l];l++)h.push(g[l]);return h}}var B;if(s.documentElement.compareDocumentPosition)B=function(g,h){if(!g.compareDocumentPosition||!h.compareDocumentPosition){if(g==h)i=true;return g.compareDocumentPosition?-1:1}g=g.compareDocumentPosition(h)&4?-1:g===h?0:1;if(g===0)i=true;return g};else if("sourceIndex"in s.documentElement)B=function(g,h){if(!g.sourceIndex||!h.sourceIndex){if(g==h)i=true;return g.sourceIndex?-1:1}g=g.sourceIndex-h.sourceIndex;if(g===0)i=true;return g};else if(s.createRange)B=function(g,h){if(!g.ownerDocument||!h.ownerDocument){if(g==h)i=true;return g.ownerDocument?-1:1}var l=g.ownerDocument.createRange(),m=h.ownerDocument.createRange();l.setStart(g,0);l.setEnd(g,0);m.setStart(h,0);m.setEnd(h,0);g=l.compareBoundaryPoints(Range.START_TO_END,m);if(g===0)i=true;return g};(function(){var g=s.createElement("div"),h="script"+(new Date).getTime();g.innerHTML="<a name='"+h+"'/>";var l=s.documentElement;l.insertBefore(g,l.firstChild);if(s.getElementById(h)){n.find.ID=function(m,q,p){if(typeof q.getElementById!=="undefined"&&!p)return(q=q.getElementById(m[1]))?q.id===m[1]||typeof q.getAttributeNode!=="undefined"&&q.getAttributeNode("id").nodeValue===m[1]?[q]:w:[]};n.filter.ID=function(m,q){var p=typeof m.getAttributeNode!=="undefined"&&m.getAttributeNode("id");return m.nodeType===1&&p&&p.nodeValue===q}}l.removeChild(g);l=g=null})();(function(){var g=s.createElement("div");g.appendChild(s.createComment(""));if(g.getElementsByTagName("*").length>0)n.find.TAG=function(h,l){l=l.getElementsByTagName(h[1]);if(h[1]==="*"){h=[];for(var m=0;l[m];m++)l[m].nodeType===1&&h.push(l[m]);l=h}return l};g.innerHTML="<a href='#'></a>";if(g.firstChild&&typeof g.firstChild.getAttribute!=="undefined"&&g.firstChild.getAttribute("href")!=="#")n.attrHandle.href=function(h){return h.getAttribute("href",2)};g=null})();s.querySelectorAll&&function(){var g=k,h=s.createElement("div");h.innerHTML="<p class='TEST'></p>";if(!(h.querySelectorAll&&h.querySelectorAll(".TEST").length===0)){k=function(m,q,p,v){q=q||s;if(!v&&q.nodeType===9&&!x(q))try{return z(q.querySelectorAll(m),p)}catch(t){}return g(m,q,p,v)};for(var l in g)k[l]=g[l];h=null}}();(function(){var g=s.createElement("div");g.innerHTML="<div class='test e'></div><div class='test'></div>";if(!(!g.getElementsByClassName||g.getElementsByClassName("e").length===0)){g.lastChild.className="e";if(g.getElementsByClassName("e").length!==1){n.order.splice(1,0,"CLASS");n.find.CLASS=function(h,l,m){if(typeof l.getElementsByClassName!=="undefined"&&!m)return l.getElementsByClassName(h[1])};g=null}}})();var E=s.compareDocumentPosition?function(g,h){return!!(g.compareDocumentPosition(h)&16)}:function(g,h){return g!==h&&(g.contains?g.contains(h):true)},x=function(g){return(g=(g?g.ownerDocument||g:0).documentElement)?g.nodeName!=="HTML":false},ga=function(g,h){var l=[],m="",q;for(h=h.nodeType?[h]:h;q=n.match.PSEUDO.exec(g);){m+=q[0];g=g.replace(n.match.PSEUDO,"")}g=n.relative[g]?g+"*":g;q=0;for(var p=h.length;q<p;q++)k(g,h[q],l);return k.filter(m,l)};c.find=k;c.expr=k.selectors;c.expr[":"]=c.expr.filters;c.unique=k.uniqueSort;c.text=a;c.isXMLDoc=x;c.contains=E})();var eb=/Until$/,fb=/^(?:parents|prevUntil|prevAll)/,gb=/,/;R=Array.prototype.slice;var Ia=function(a,b,d){if(c.isFunction(b))return c.grep(a,function(e,j){return!!b.call(e,j,e)===d});else if(b.nodeType)return c.grep(a,function(e){return e===b===d});else if(typeof b==="string"){var f=c.grep(a,function(e){return e.nodeType===1});if(Ua.test(b))return c.filter(b,f,!d);else b=c.filter(b,f)}return c.grep(a,function(e){return c.inArray(e,b)>=0===d})};c.fn.extend({find:function(a){for(var b=this.pushStack("","find",a),d=0,f=0,e=this.length;f<e;f++){d=b.length;c.find(a,this[f],b);if(f>0)for(var j=d;j<b.length;j++)for(var i=0;i<d;i++)if(b[i]===b[j]){b.splice(j--,1);break}}return b},has:function(a){var b=c(a);return this.filter(function(){for(var d=0,f=b.length;d<f;d++)if(c.contains(this,b[d]))return true})},not:function(a){return this.pushStack(Ia(this,a,false),"not",a)},filter:function(a){return this.pushStack(Ia(this,a,true),"filter",a)},is:function(a){return!!a&&c.filter(a,this).length>0},closest:function(a,b){if(c.isArray(a)){var d=[],f=this[0],e,j={},i;if(f&&a.length){e=0;for(var o=a.length;e<o;e++){i=a[e];j[i]||(j[i]=c.expr.match.POS.test(i)?c(i,b||this.context):i)}for(;f&&f.ownerDocument&&f!==b;){for(i in j){e=j[i];if(e.jquery?e.index(f)>-1:c(f).is(e)){d.push({selector:i,elem:f});delete j[i]}}f=f.parentNode}}return d}var k=c.expr.match.POS.test(a)?c(a,b||this.context):null;return this.map(function(n,r){for(;r&&r.ownerDocument&&r!==b;){if(k?k.index(r)>-1:c(r).is(a))return r;r=r.parentNode}return null})},index:function(a){if(!a||typeof a==="string")return c.inArray(this[0],a?c(a):this.parent().children());return c.inArray(a.jquery?a[0]:a,this)},add:function(a,b){a=typeof a==="string"?c(a,b||this.context):c.makeArray(a);b=c.merge(this.get(),a);return this.pushStack(qa(a[0])||qa(b[0])?b:c.unique(b))},andSelf:function(){return this.add(this.prevObject)}});c.each({parent:function(a){return(a=a.parentNode)&&a.nodeType!==11?a:null},parents:function(a){return c.dir(a,"parentNode")},parentsUntil:function(a,b,d){return c.dir(a,"parentNode",d)},next:function(a){return c.nth(a,2,"nextSibling")},prev:function(a){return c.nth(a,2,"previousSibling")},nextAll:function(a){return c.dir(a,"nextSibling")},prevAll:function(a){return c.dir(a,"previousSibling")},nextUntil:function(a,b,d){return c.dir(a,"nextSibling",d)},prevUntil:function(a,b,d){return c.dir(a,"previousSibling",d)},siblings:function(a){return c.sibling(a.parentNode.firstChild,a)},children:function(a){return c.sibling(a.firstChild)},contents:function(a){return c.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:c.makeArray(a.childNodes)}},function(a,b){c.fn[a]=function(d,f){var e=c.map(this,b,d);eb.test(a)||(f=d);if(f&&typeof f==="string")e=c.filter(f,e);e=this.length>1?c.unique(e):e;if((this.length>1||gb.test(f))&&fb.test(a))e=e.reverse();return this.pushStack(e,a,R.call(arguments).join(","))}});c.extend({filter:function(a,b,d){if(d)a=":not("+a+")";return c.find.matches(a,b)},dir:function(a,b,d){var f=[];for(a=a[b];a&&a.nodeType!==9&&(d===w||a.nodeType!==1||!c(a).is(d));){a.nodeType===1&&f.push(a);a=a[b]}return f},nth:function(a,b,d){b=b||1;for(var f=0;a;a=a[d])if(a.nodeType===1&&++f===b)break;return a},sibling:function(a,b){for(var d=[];a;a=a.nextSibling)a.nodeType===1&&a!==b&&d.push(a);return d}});var Ja=/ jQuery\d+="(?:\d+|null)"/g,V=/^\s+/,Ka=/(<([\w:]+)[^>]*?)\/>/g,hb=/^(?:area|br|col|embed|hr|img|input|link|meta|param)$/i,La=/<([\w:]+)/,ib=/<tbody/i,jb=/<|&#?\w+;/,ta=/<script|<object|<embed|<option|<style/i,ua=/checked\s*(?:[^=]|=\s*.checked.)/i,Ma=function(a,b,d){return hb.test(d)?a:b+"></"+d+">"},F={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],area:[1,"<map>","</map>"],_default:[0,"",""]};F.optgroup=F.option;F.tbody=F.tfoot=F.colgroup=F.caption=F.thead;F.th=F.td;if(!c.support.htmlSerialize)F._default=[1,"div<div>","</div>"];c.fn.extend({text:function(a){if(c.isFunction(a))return this.each(function(b){var d=c(this);d.text(a.call(this,b,d.text()))});if(typeof a!=="object"&&a!==w)return this.empty().append((this[0]&&this[0].ownerDocument||s).createTextNode(a));return c.text(this)},wrapAll:function(a){if(c.isFunction(a))return this.each(function(d){c(this).wrapAll(a.call(this,d))});if(this[0]){var b=c(a,this[0].ownerDocument).eq(0).clone(true);this[0].parentNode&&b.insertBefore(this[0]);
b.map(function(){for(var d=this;d.firstChild&&d.firstChild.nodeType===1;)d=d.firstChild;return d}).append(this)}return this},wrapInner:function(a){if(c.isFunction(a))return this.each(function(b){c(this).wrapInner(a.call(this,b))});return this.each(function(){var b=c(this),d=b.contents();d.length?d.wrapAll(a):b.append(a)})},wrap:function(a){return this.each(function(){c(this).wrapAll(a)})},unwrap:function(){return this.parent().each(function(){c.nodeName(this,"body")||c(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.appendChild(a)})},prepend:function(){return this.domManip(arguments,true,function(a){this.nodeType===1&&this.insertBefore(a,this.firstChild)})},before:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,this)});else if(arguments.length){var a=c(arguments[0]);a.push.apply(a,this.toArray());return this.pushStack(a,"before",arguments)}},after:function(){if(this[0]&&this[0].parentNode)return this.domManip(arguments,false,function(b){this.parentNode.insertBefore(b,this.nextSibling)});else if(arguments.length){var a=this.pushStack(this,"after",arguments);a.push.apply(a,c(arguments[0]).toArray());return a}},remove:function(a,b){for(var d=0,f;(f=this[d])!=null;d++)if(!a||c.filter(a,[f]).length){if(!b&&f.nodeType===1){c.cleanData(f.getElementsByTagName("*"));c.cleanData([f])}f.parentNode&&f.parentNode.removeChild(f)}return this},empty:function(){for(var a=0,b;(b=this[a])!=null;a++)for(b.nodeType===1&&c.cleanData(b.getElementsByTagName("*"));b.firstChild;)b.removeChild(b.firstChild);return this},clone:function(a){var b=this.map(function(){if(!c.support.noCloneEvent&&!c.isXMLDoc(this)){var d=this.outerHTML,f=this.ownerDocument;if(!d){d=f.createElement("div");d.appendChild(this.cloneNode(true));d=d.innerHTML}return c.clean([d.replace(Ja,"").replace(/=([^="'>\s]+\/)>/g,'="$1">').replace(V,"")],f)[0]}else return this.cloneNode(true)});if(a===true){ra(this,b);ra(this.find("*"),b.find("*"))}return b},html:function(a){if(a===w)return this[0]&&this[0].nodeType===1?this[0].innerHTML.replace(Ja,""):null;else if(typeof a==="string"&&!ta.test(a)&&(c.support.leadingWhitespace||!V.test(a))&&!F[(La.exec(a)||["",""])[1].toLowerCase()]){a=a.replace(Ka,Ma);try{for(var b=0,d=this.length;b<d;b++)if(this[b].nodeType===1){c.cleanData(this[b].getElementsByTagName("*"));this[b].innerHTML=a}}catch(f){this.empty().append(a)}}else c.isFunction(a)?this.each(function(e){var j=c(this),i=j.html();j.empty().append(function(){return a.call(this,e,i)})}):this.empty().append(a);return this},replaceWith:function(a){if(this[0]&&this[0].parentNode){if(c.isFunction(a))return this.each(function(b){var d=c(this),f=d.html();d.replaceWith(a.call(this,b,f))});if(typeof a!=="string")a=c(a).detach();return this.each(function(){var b=this.nextSibling,d=this.parentNode;c(this).remove();b?c(b).before(a):c(d).append(a)})}else return this.pushStack(c(c.isFunction(a)?a():a),"replaceWith",a)},detach:function(a){return this.remove(a,true)},domManip:function(a,b,d){function f(u){return c.nodeName(u,"table")?u.getElementsByTagName("tbody")[0]||u.appendChild(u.ownerDocument.createElement("tbody")):u}var e,j,i=a[0],o=[],k;if(!c.support.checkClone&&arguments.length===3&&typeof i==="string"&&ua.test(i))return this.each(function(){c(this).domManip(a,b,d,true)});if(c.isFunction(i))return this.each(function(u){var z=c(this);a[0]=i.call(this,u,b?z.html():w);z.domManip(a,b,d)});if(this[0]){e=i&&i.parentNode;e=c.support.parentNode&&e&&e.nodeType===11&&e.childNodes.length===this.length?{fragment:e}:sa(a,this,o);k=e.fragment;if(j=k.childNodes.length===1?k=k.firstChild:k.firstChild){b=b&&c.nodeName(j,"tr");for(var n=0,r=this.length;n<r;n++)d.call(b?f(this[n],j):this[n],n>0||e.cacheable||this.length>1?k.cloneNode(true):k)}o.length&&c.each(o,Qa)}return this}});c.fragments={};c.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){c.fn[a]=function(d){var f=[];d=c(d);var e=this.length===1&&this[0].parentNode;if(e&&e.nodeType===11&&e.childNodes.length===1&&d.length===1){d[b](this[0]);return this}else{e=0;for(var j=d.length;e<j;e++){var i=(e>0?this.clone(true):this).get();c.fn[b].apply(c(d[e]),i);f=f.concat(i)}return this.pushStack(f,a,d.selector)}}});c.extend({clean:function(a,b,d,f){b=b||s;if(typeof b.createElement==="undefined")b=b.ownerDocument||b[0]&&b[0].ownerDocument||s;for(var e=[],j=0,i;(i=a[j])!=null;j++){if(typeof i==="number")i+="";if(i){if(typeof i==="string"&&!jb.test(i))i=b.createTextNode(i);else if(typeof i==="string"){i=i.replace(Ka,Ma);var o=(La.exec(i)||["",""])[1].toLowerCase(),k=F[o]||F._default,n=k[0],r=b.createElement("div");for(r.innerHTML=k[1]+i+k[2];n--;)r=r.lastChild;if(!c.support.tbody){n=ib.test(i);o=o==="table"&&!n?r.firstChild&&r.firstChild.childNodes:k[1]==="<table>"&&!n?r.childNodes:[];for(k=o.length-1;k>=0;--k)c.nodeName(o[k],"tbody")&&!o[k].childNodes.length&&o[k].parentNode.removeChild(o[k])}!c.support.leadingWhitespace&&V.test(i)&&r.insertBefore(b.createTextNode(V.exec(i)[0]),r.firstChild);i=r.childNodes}if(i.nodeType)e.push(i);else e=c.merge(e,i)}}if(d)for(j=0;e[j];j++)if(f&&c.nodeName(e[j],"script")&&(!e[j].type||e[j].type.toLowerCase()==="text/javascript"))f.push(e[j].parentNode?e[j].parentNode.removeChild(e[j]):e[j]);else{e[j].nodeType===1&&e.splice.apply(e,[j+1,0].concat(c.makeArray(e[j].getElementsByTagName("script"))));d.appendChild(e[j])}return e},cleanData:function(a){for(var b,d,f=c.cache,e=c.event.special,j=c.support.deleteExpando,i=0,o;(o=a[i])!=null;i++)if(d=o[c.expando]){b=f[d];if(b.events)for(var k in b.events)e[k]?c.event.remove(o,k):Ca(o,k,b.handle);if(j)delete o[c.expando];else o.removeAttribute&&o.removeAttribute(c.expando);delete f[d]}}});var kb=/z-?index|font-?weight|opacity|zoom|line-?height/i,Na=/alpha\([^)]*\)/,Oa=/opacity=([^)]*)/,ha=/float/i,ia=/-([a-z])/gi,lb=/([A-Z])/g,mb=/^-?\d+(?:px)?$/i,nb=/^-?\d/,ob={position:"absolute",visibility:"hidden",display:"block"},pb=["Left","Right"],qb=["Top","Bottom"],rb=s.defaultView&&s.defaultView.getComputedStyle,Pa=c.support.cssFloat?"cssFloat":"styleFloat",ja=function(a,b){return b.toUpperCase()};c.fn.css=function(a,b){return X(this,a,b,true,function(d,f,e){if(e===w)return c.curCSS(d,f);if(typeof e==="number"&&!kb.test(f))e+="px";c.style(d,f,e)})};c.extend({style:function(a,b,d){if(!a||a.nodeType===3||a.nodeType===8)return w;if((b==="width"||b==="height")&&parseFloat(d)<0)d=w;var f=a.style||a,e=d!==w;if(!c.support.opacity&&b==="opacity"){if(e){f.zoom=1;b=parseInt(d,10)+""==="NaN"?"":"alpha(opacity="+d*100+")";a=f.filter||c.curCSS(a,"filter")||"";f.filter=Na.test(a)?a.replace(Na,b):b}return f.filter&&f.filter.indexOf("opacity=")>=0?parseFloat(Oa.exec(f.filter)[1])/100+"":""}if(ha.test(b))b=Pa;b=b.replace(ia,ja);if(e)f[b]=d;return f[b]},css:function(a,b,d,f){if(b==="width"||b==="height"){var e,j=b==="width"?pb:qb;function i(){e=b==="width"?a.offsetWidth:a.offsetHeight;f!=="border"&&c.each(j,function(){f||(e-=parseFloat(c.curCSS(a,"padding"+this,true))||0);if(f==="margin")e+=parseFloat(c.curCSS(a,"margin"+this,true))||0;else e-=parseFloat(c.curCSS(a,"border"+this+"Width",true))||0})}a.offsetWidth!==0?i():c.swap(a,ob,i);return Math.max(0,Math.round(e))}return c.curCSS(a,b,d)},curCSS:function(a,b,d){var f,e=a.style;if(!c.support.opacity&&b==="opacity"&&a.currentStyle){f=Oa.test(a.currentStyle.filter||"")?parseFloat(RegExp.$1)/100+"":"";return f===""?"1":f}if(ha.test(b))b=Pa;if(!d&&e&&e[b])f=e[b];else if(rb){if(ha.test(b))b="float";b=b.replace(lb,"-$1").toLowerCase();e=a.ownerDocument.defaultView;if(!e)return null;if(a=e.getComputedStyle(a,null))f=a.getPropertyValue(b);if(b==="opacity"&&f==="")f="1"}else if(a.currentStyle){d=b.replace(ia,ja);f=a.currentStyle[b]||a.currentStyle[d];if(!mb.test(f)&&nb.test(f)){b=e.left;var j=a.runtimeStyle.left;a.runtimeStyle.left=a.currentStyle.left;e.left=d==="fontSize"?"1em":f||0;f=e.pixelLeft+"px";e.left=b;a.runtimeStyle.left=j}}return f},swap:function(a,b,d){var f={};for(var e in b){f[e]=a.style[e];a.style[e]=b[e]}d.call(a);for(e in b)a.style[e]=f[e]}});if(c.expr&&c.expr.filters){c.expr.filters.hidden=function(a){var b=a.offsetWidth,d=a.offsetHeight,f=a.nodeName.toLowerCase()==="tr";return b===0&&d===0&&!f?true:b>0&&d>0&&!f?false:c.curCSS(a,"display")==="none"};c.expr.filters.visible=function(a){return!c.expr.filters.hidden(a)}}var sb=J(),tb=/<script(.|\s)*?\/script>/gi,ub=/select|textarea/i,vb=/color|date|datetime|email|hidden|month|number|password|range|search|tel|text|time|url|week/i,N=/=\?(&|$)/,ka=/\?/,wb=/(\?|&)_=.*?(&|$)/,xb=/^(\w+:)?\/\/([^\/?#]+)/,yb=/%20/g,zb=c.fn.load;c.fn.extend({load:function(a,b,d){if(typeof a!=="string")return zb.call(this,a);else if(!this.length)return this;var f=a.indexOf(" ");if(f>=0){var e=a.slice(f,a.length);a=a.slice(0,f)}f="GET";if(b)if(c.isFunction(b)){d=b;b=null}else if(typeof b==="object"){b=c.param(b,c.ajaxSettings.traditional);f="POST"}var j=this;c.ajax({url:a,type:f,dataType:"html",data:b,complete:function(i,o){if(o==="success"||o==="notmodified")j.html(e?c("<div />").append(i.responseText.replace(tb,"")).find(e):i.responseText);d&&j.each(d,[i.responseText,o,i])}});return this},serialize:function(){return c.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?c.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||ub.test(this.nodeName)||vb.test(this.type))}).map(function(a,b){a=c(this).val();return a==null?null:c.isArray(a)?c.map(a,function(d){return{name:b.name,value:d}}):{name:b.name,value:a}}).get()}});c.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(a,b){c.fn[b]=function(d){return this.bind(b,d)}});c.extend({get:function(a,b,d,f){if(c.isFunction(b)){f=f||d;d=b;b=null}return c.ajax({type:"GET",url:a,data:b,success:d,dataType:f})},getScript:function(a,b){return c.get(a,null,b,"script")},getJSON:function(a,b,d){return c.get(a,b,d,"json")},post:function(a,b,d,f){if(c.isFunction(b)){f=f||d;d=b;b={}}return c.ajax({type:"POST",url:a,data:b,success:d,dataType:f})},ajaxSetup:function(a){c.extend(c.ajaxSettings,a)},ajaxSettings:{url:location.href,global:true,type:"GET",contentType:"application/x-www-form-urlencoded",processData:true,async:true,xhr:A.XMLHttpRequest&&(A.location.protocol!=="file:"||!A.ActiveXObject)?function(){return new A.XMLHttpRequest}:function(){try{return new A.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},accepts:{xml:"application/xml, text/xml",html:"text/html",script:"text/javascript, application/javascript",json:"application/json, text/javascript",text:"text/plain",_default:"*/*"}},lastModified:{},etag:{},ajax:function(a){function b(){e.success&&e.success.call(k,o,i,x);e.global&&f("ajaxSuccess",[x,e])}function d(){e.complete&&e.complete.call(k,x,i);e.global&&f("ajaxComplete",[x,e]);e.global&&!--c.active&&c.event.trigger("ajaxStop")}function f(q,p){(e.context?c(e.context):c.event).trigger(q,p)}var e=c.extend(true,{},c.ajaxSettings,a),j,i,o,k=a&&a.context||e,n=e.type.toUpperCase();if(e.data&&e.processData&&typeof e.data!=="string")e.data=c.param(e.data,e.traditional);if(e.dataType==="jsonp"){if(n==="GET")N.test(e.url)||(e.url+=(ka.test(e.url)?"&":"?")+(e.jsonp||"callback")+"=?");else if(!e.data||!N.test(e.data))e.data=(e.data?e.data+"&":"")+(e.jsonp||"callback")+"=?";e.dataType="json"}if(e.dataType==="json"&&(e.data&&N.test(e.data)||N.test(e.url))){j=e.jsonpCallback||"jsonp"+sb++;if(e.data)e.data=(e.data+"").replace(N,"="+j+"$1");e.url=e.url.replace(N,"="+j+"$1");e.dataType="script";A[j]=A[j]||function(q){o=q;b();d();A[j]=w;try{delete A[j]}catch(p){}z&&z.removeChild(C)}}if(e.dataType==="script"&&e.cache===null)e.cache=false;if(e.cache===false&&n==="GET"){var r=J(),u=e.url.replace(wb,"$1_="+r+"$2");e.url=u+(u===e.url?(ka.test(e.url)?"&":"?")+"_="+r:"")}if(e.data&&n==="GET")e.url+=(ka.test(e.url)?"&":"?")+e.data;e.global&&!c.active++&&c.event.trigger("ajaxStart");r=(r=xb.exec(e.url))&&(r[1]&&r[1]!==location.protocol||r[2]!==location.host);if(e.dataType==="script"&&n==="GET"&&r){var z=s.getElementsByTagName("head")[0]||s.documentElement,C=s.createElement("script");C.src=e.url;if(e.scriptCharset)C.charset=e.scriptCharset;if(!j){var B=false;C.onload=C.onreadystatechange=function(){if(!B&&(!this.readyState||this.readyState==="loaded"||this.readyState==="complete")){B=true;b();d();C.onload=C.onreadystatechange=null;z&&C.parentNode&&z.removeChild(C)}}}z.insertBefore(C,z.firstChild);return w}var E=false,x=e.xhr();if(x){e.username?x.open(n,e.url,e.async,e.username,e.password):x.open(n,e.url,e.async);try{if(e.data||a&&a.contentType)x.setRequestHeader("Content-Type",e.contentType);if(e.ifModified){c.lastModified[e.url]&&x.setRequestHeader("If-Modified-Since",c.lastModified[e.url]);c.etag[e.url]&&x.setRequestHeader("If-None-Match",c.etag[e.url])}r||x.setRequestHeader("X-Requested-With","XMLHttpRequest");x.setRequestHeader("Accept",e.dataType&&e.accepts[e.dataType]?e.accepts[e.dataType]+", */*":e.accepts._default)}catch(ga){}if(e.beforeSend&&e.beforeSend.call(k,x,e)===false){e.global&&!--c.active&&c.event.trigger("ajaxStop");x.abort();return false}e.global&&f("ajaxSend",[x,e]);var g=x.onreadystatechange=function(q){if(!x||x.readyState===0||q==="abort"){E||d();E=true;if(x)x.onreadystatechange=c.noop}else if(!E&&x&&(x.readyState===4||q==="timeout")){E=true;x.onreadystatechange=c.noop;i=q==="timeout"?"timeout":!c.httpSuccess(x)?"error":e.ifModified&&c.httpNotModified(x,e.url)?"notmodified":"success";var p;if(i==="success")try{o=c.httpData(x,e.dataType,e)}catch(v){i="parsererror";p=v}if(i==="success"||i==="notmodified")j||b();else c.handleError(e,x,i,p);d();q==="timeout"&&x.abort();if(e.async)x=null}};try{var h=x.abort;x.abort=function(){x&&h.call(x);g("abort")}}catch(l){}e.async&&e.timeout>0&&setTimeout(function(){x&&!E&&g("timeout")},e.timeout);try{x.send(n==="POST"||n==="PUT"||n==="DELETE"?e.data:null)}catch(m){c.handleError(e,x,null,m);d()}e.async||g();return x}},handleError:function(a,b,d,f){if(a.error)a.error.call(a.context||a,b,d,f);if(a.global)(a.context?c(a.context):c.event).trigger("ajaxError",[b,a,f])},active:0,httpSuccess:function(a){try{return!a.status&&location.protocol==="file:"||a.status>=200&&a.status<300||a.status===304||a.status===1223||a.status===0}catch(b){}return false},httpNotModified:function(a,b){var d=a.getResponseHeader("Last-Modified"),f=a.getResponseHeader("Etag");if(d)c.lastModified[b]=d;if(f)c.etag[b]=f;return a.status===304||a.status===0},httpData:function(a,b,d){var f=a.getResponseHeader("content-type")||"",e=b==="xml"||!b&&f.indexOf("xml")>=0;a=e?a.responseXML:a.responseText;e&&a.documentElement.nodeName==="parsererror"&&c.error("parsererror");if(d&&d.dataFilter)a=d.dataFilter(a,b);if(typeof a==="string")if(b==="json"||!b&&f.indexOf("json")>=0)a=c.parseJSON(a);else if(b==="script"||!b&&f.indexOf("javascript")>=0)c.globalEval(a);return a},param:function(a,b){function d(i,o){if(c.isArray(o))c.each(o,function(k,n){b||/\[\]$/.test(i)?f(i,n):d(i+"["+(typeof n==="object"||c.isArray(n)?k:"")+"]",n)});else!b&&o!=null&&typeof o==="object"?c.each(o,function(k,n){d(i+"["+k+"]",n)}):f(i,o)}function f(i,o){o=c.isFunction(o)?o():o;e[e.length]=encodeURIComponent(i)+"="+encodeURIComponent(o)}var e=[];if(b===w)b=c.ajaxSettings.traditional;if(c.isArray(a)||a.jquery)c.each(a,function(){f(this.name,this.value)});else for(var j in a)d(j,a[j]);return e.join("&").replace(yb,"+")}});var la={},Ab=/toggle|show|hide/,Bb=/^([+-]=)?([\d+-.]+)(.*)$/,W,va=[["height","marginTop","marginBottom","paddingTop","paddingBottom"],["width","marginLeft","marginRight","paddingLeft","paddingRight"],["opacity"]];c.fn.extend({show:function(a,b){if(a||a===0)return this.animate(K("show",3),a,b);else{a=0;for(b=this.length;a<b;a++){var d=c.data(this[a],"olddisplay");this[a].style.display=d||"";if(c.css(this[a],"display")==="none"){d=this[a].nodeName;var f;if(la[d])f=la[d];else{var e=c("<"+d+" />").appendTo("body");f=e.css("display");if(f==="none")f="block";e.remove();la[d]=f}c.data(this[a],"olddisplay",f)}}a=0;for(b=this.length;a<b;a++)this[a].style.display=c.data(this[a],"olddisplay")||"";return this}},hide:function(a,b){if(a||a===0)return this.animate(K("hide",3),a,b);else{a=0;for(b=this.length;a<b;a++){var d=c.data(this[a],"olddisplay");!d&&d!=="none"&&c.data(this[a],"olddisplay",c.css(this[a],"display"))}a=0;for(b=this.length;a<b;a++)this[a].style.display="none";return this}},_toggle:c.fn.toggle,toggle:function(a,b){var d=typeof a==="boolean";if(c.isFunction(a)&&c.isFunction(b))this._toggle.apply(this,arguments);else a==null||d?this.each(function(){var f=d?a:c(this).is(":hidden");c(this)[f?"show":"hide"]()}):this.animate(K("toggle",3),a,b);return this},fadeTo:function(a,b,d){return this.filter(":hidden").css("opacity",0).show().end().animate({opacity:b},a,d)},animate:function(a,b,d,f){var e=c.speed(b,d,f);if(c.isEmptyObject(a))return this.each(e.complete);return this[e.queue===false?"each":"queue"](function(){var j=c.extend({},e),i,o=this.nodeType===1&&c(this).is(":hidden"),k=this;for(i in a){var n=i.replace(ia,ja);if(i!==n){a[n]=a[i];delete a[i];i=n}if(a[i]==="hide"&&o||a[i]==="show"&&!o)return j.complete.call(this);if((i==="height"||i==="width")&&this.style){j.display=c.css(this,"display");j.overflow=this.style.overflow}if(c.isArray(a[i])){(j.specialEasing=j.specialEasing||{})[i]=a[i][1];a[i]=a[i][0]}}if(j.overflow!=null)this.style.overflow="hidden";j.curAnim=c.extend({},a);c.each(a,function(r,u){var z=new c.fx(k,j,r);if(Ab.test(u))z[u==="toggle"?o?"show":"hide":u](a);else{var C=Bb.exec(u),B=z.cur(true)||0;if(C){u=parseFloat(C[2]);var E=C[3]||"px";if(E!=="px"){k.style[r]=(u||1)+E;B=(u||1)/z.cur(true)*B;k.style[r]=B+E}if(C[1])u=(C[1]==="-="?-1:1)*u+B;z.custom(B,u,E)}else z.custom(B,u,"")}});return true})},stop:function(a,b){var d=c.timers;a&&this.queue([]);this.each(function(){for(var f=d.length-1;f>=0;f--)if(d[f].elem===this){b&&d[f](true);d.splice(f,1)}});b||this.dequeue();return this}});c.each({slideDown:K("show",1),slideUp:K("hide",1),slideToggle:K("toggle",1),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"}},function(a,b){c.fn[a]=function(d,f){return this.animate(b,d,f)}});c.extend({speed:function(a,b,d){var f=a&&typeof a==="object"?a:{complete:d||!d&&b||c.isFunction(a)&&a,duration:a,easing:d&&b||b&&!c.isFunction(b)&&b};f.duration=c.fx.off?0:typeof f.duration==="number"?f.duration:c.fx.speeds[f.duration]||c.fx.speeds._default;f.old=f.complete;f.complete=function(){f.queue!==false&&c(this).dequeue();c.isFunction(f.old)&&f.old.call(this)};return f},easing:{linear:function(a,b,d,f){return d+f*a},swing:function(a,b,d,f){return(-Math.cos(a*Math.PI)/2+.5)*f+d}},timers:[],fx:function(a,b,d){this.options=b;this.elem=a;this.prop=d;if(!b.orig)b.orig={}}});c.fx.prototype={update:function(){this.options.step&&this.options.step.call(this.elem,this.now,this);(c.fx.step[this.prop]||c.fx.step._default)(this);if((this.prop==="height"||this.prop==="width")&&this.elem.style)this.elem.style.display="block"},cur:function(a){if(this.elem[this.prop]!=null&&(!this.elem.style||this.elem.style[this.prop]==null))return this.elem[this.prop];return(a=parseFloat(c.css(this.elem,this.prop,a)))&&a>-1e4?a:parseFloat(c.curCSS(this.elem,this.prop))||0},custom:function(a,b,d){function f(j){return e.step(j)}this.startTime=J();this.start=a;this.end=b;this.unit=d||this.unit||"px";this.now=this.start;this.pos=this.state=0;var e=this;f.elem=this.elem;if(f()&&c.timers.push(f)&&!W)W=setInterval(c.fx.tick,13)},show:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.show=true;this.custom(this.prop==="width"||this.prop==="height"?1:0,this.cur());c(this.elem).show()},hide:function(){this.options.orig[this.prop]=c.style(this.elem,this.prop);this.options.hide=true;this.custom(this.cur(),0)},step:function(a){var b=J(),d=true;if(a||b>=this.options.duration+this.startTime){this.now=this.end;this.pos=this.state=1;this.update();this.options.curAnim[this.prop]=true;for(var f in this.options.curAnim)if(this.options.curAnim[f]!==true)d=false;if(d){if(this.options.display!=null){this.elem.style.overflow=this.options.overflow;a=c.data(this.elem,"olddisplay");this.elem.style.display=a?a:this.options.display;if(c.css(this.elem,"display")==="none")this.elem.style.display="block"}this.options.hide&&c(this.elem).hide();if(this.options.hide||this.options.show)for(var e in this.options.curAnim)c.style(this.elem,e,this.options.orig[e]);this.options.complete.call(this.elem)}return false}else{e=b-this.startTime;this.state=e/this.options.duration;a=this.options.easing||(c.easing.swing?"swing":"linear");this.pos=c.easing[this.options.specialEasing&&this.options.specialEasing[this.prop]||a](this.state,e,0,1,this.options.duration);this.now=this.start+(this.end-this.start)*this.pos;this.update()}return true}};c.extend(c.fx,{tick:function(){for(var a=c.timers,b=0;b<a.length;b++)a[b]()||a.splice(b--,1);a.length||c.fx.stop()},stop:function(){clearInterval(W);W=null},speeds:{slow:600,fast:200,_default:400},step:{opacity:function(a){c.style(a.elem,"opacity",a.now)},_default:function(a){if(a.elem.style&&a.elem.style[a.prop]!=null)a.elem.style[a.prop]=(a.prop==="width"||a.prop==="height"?Math.max(0,a.now):a.now)+a.unit;else a.elem[a.prop]=a.now}}});if(c.expr&&c.expr.filters)c.expr.filters.animated=function(a){return c.grep(c.timers,function(b){return a===b.elem}).length};c.fn.offset="getBoundingClientRect"in s.documentElement?function(a){var b=this[0];if(a)return this.each(function(e){c.offset.setOffset(this,a,e)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);var d=b.getBoundingClientRect(),f=b.ownerDocument;b=f.body;f=f.documentElement;return{top:d.top+(self.pageYOffset||c.support.boxModel&&f.scrollTop||b.scrollTop)-(f.clientTop||b.clientTop||0),left:d.left+(self.pageXOffset||c.support.boxModel&&f.scrollLeft||b.scrollLeft)-(f.clientLeft||b.clientLeft||0)}}:function(a){var b=this[0];if(a)return this.each(function(r){c.offset.setOffset(this,a,r)});if(!b||!b.ownerDocument)return null;if(b===b.ownerDocument.body)return c.offset.bodyOffset(b);c.offset.initialize();var d=b.offsetParent,f=b,e=b.ownerDocument,j,i=e.documentElement,o=e.body;f=(e=e.defaultView)?e.getComputedStyle(b,null):b.currentStyle;for(var k=b.offsetTop,n=b.offsetLeft;(b=b.parentNode)&&b!==o&&b!==i;){if(c.offset.supportsFixedPosition&&f.position==="fixed")break;j=e?e.getComputedStyle(b,null):b.currentStyle;k-=b.scrollTop;n-=b.scrollLeft;if(b===d){k+=b.offsetTop;n+=b.offsetLeft;if(c.offset.doesNotAddBorder&&!(c.offset.doesAddBorderForTableAndCells&&/^t(able|d|h)$/i.test(b.nodeName))){k+=parseFloat(j.borderTopWidth)||0;n+=parseFloat(j.borderLeftWidth)||0}f=d;d=b.offsetParent}if(c.offset.subtractsBorderForOverflowNotVisible&&j.overflow!=="visible"){k+=parseFloat(j.borderTopWidth)||0;n+=parseFloat(j.borderLeftWidth)||0}f=j}if(f.position==="relative"||f.position==="static"){k+=o.offsetTop;n+=o.offsetLeft}if(c.offset.supportsFixedPosition&&f.position==="fixed"){k+=Math.max(i.scrollTop,o.scrollTop);n+=Math.max(i.scrollLeft,o.scrollLeft)}return{top:k,left:n}};c.offset={initialize:function(){var a=s.body,b=s.createElement("div"),d,f,e,j=parseFloat(c.curCSS(a,"marginTop",true))||0;c.extend(b.style,{position:"absolute",top:0,left:0,margin:0,border:0,width:"1px",height:"1px",visibility:"hidden"});b.innerHTML="<div style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;'><div></div></div><table style='position:absolute;top:0;left:0;margin:0;border:5px solid #000;padding:0;width:1px;height:1px;' cellpadding='0' cellspacing='0'><tr><td></td></tr></table>";a.insertBefore(b,a.firstChild);d=b.firstChild;f=d.firstChild;e=d.nextSibling.firstChild.firstChild;this.doesNotAddBorder=f.offsetTop!==5;this.doesAddBorderForTableAndCells=e.offsetTop===5;f.style.position="fixed";f.style.top="20px";this.supportsFixedPosition=f.offsetTop===20||f.offsetTop===15;f.style.position=f.style.top="";d.style.overflow="hidden";d.style.position="relative";this.subtractsBorderForOverflowNotVisible=f.offsetTop===-5;this.doesNotIncludeMarginInBodyOffset=a.offsetTop!==j;a.removeChild(b);c.offset.initialize=c.noop},bodyOffset:function(a){var b=a.offsetTop,d=a.offsetLeft;c.offset.initialize();if(c.offset.doesNotIncludeMarginInBodyOffset){b+=parseFloat(c.curCSS(a,"marginTop",true))||0;d+=parseFloat(c.curCSS(a,"marginLeft",true))||0}return{top:b,left:d}},setOffset:function(a,b,d){if(/static/.test(c.curCSS(a,"position")))a.style.position="relative";var f=c(a),e=f.offset(),j=parseInt(c.curCSS(a,"top",true),10)||0,i=parseInt(c.curCSS(a,"left",true),10)||0;if(c.isFunction(b))b=b.call(a,d,e);d={top:b.top-e.top+j,left:b.left-e.left+i};"using"in b?b.using.call(a,d):f.css(d)}};c.fn.extend({position:function(){if(!this[0])return null;var a=this[0],b=this.offsetParent(),d=this.offset(),f=/^body|html$/i.test(b[0].nodeName)?{top:0,left:0}:b.offset();d.top-=parseFloat(c.curCSS(a,"marginTop",true))||0;d.left-=parseFloat(c.curCSS(a,"marginLeft",true))||0;f.top+=parseFloat(c.curCSS(b[0],"borderTopWidth",true))||0;f.left+=parseFloat(c.curCSS(b[0],"borderLeftWidth",true))||0;return{top:d.top-f.top,left:d.left-f.left}},offsetParent:function(){return this.map(function(){for(var a=this.offsetParent||s.body;a&&!/^body|html$/i.test(a.nodeName)&&c.css(a,"position")==="static";)a=a.offsetParent;return a})}});c.each(["Left","Top"],function(a,b){var d="scroll"+b;c.fn[d]=function(f){var e=this[0],j;if(!e)return null;if(f!==w)return this.each(function(){if(j=wa(this))j.scrollTo(!a?f:c(j).scrollLeft(),a?f:c(j).scrollTop());else this[d]=f});else return(j=wa(e))?"pageXOffset"in j?j[a?"pageYOffset":"pageXOffset"]:c.support.boxModel&&j.document.documentElement[d]||j.document.body[d]:e[d]}});c.each(["Height","Width"],function(a,b){var d=b.toLowerCase();c.fn["inner"+b]=function(){return this[0]?c.css(this[0],d,false,"padding"):null};c.fn["outer"+b]=function(f){return this[0]?c.css(this[0],d,false,f?"margin":"border"):null};c.fn[d]=function(f){var e=this[0];if(!e)return f==null?null:this;if(c.isFunction(f))return this.each(function(j){var i=c(this);i[d](f.call(this,j,i[d]()))});return"scrollTo"in e&&e.document?e.document.compatMode==="CSS1Compat"&&e.document.documentElement["client"+b]||e.document.body["client"+b]:e.nodeType===9?Math.max(e.documentElement["client"+b],e.body["scroll"+b],e.documentElement["scroll"+b],e.body["offset"+b],e.documentElement["offset"+b]):f===w?c.css(e,d):this.css(d,typeof f==="string"?f:f+"px")}});A.jQuery=A.$=c})(window);function Game(renderer){var backgroundColour=[.3,.3,.3,1];function update(){renderer.draw(backgroundColour,null)}return{update:update}}function SpriteDrawing(draw2d,graphicsDevice,jquery){var drawing=draw2d.create({graphicsDevice:graphicsDevice});function draw(clearColour,sprite){if(graphicsDevice.beginFrame()){if(jquery!=undefined){jquery(this).trigger("beginFrame")}drawing.setBackBuffer();drawing.clear(clearColour);drawing.begin("alpha");drawing.drawSprite(sprite);drawing.end();graphicsDevice.endFrame()}}return{draw:draw}}TurbulenzEngine.onload=function onload(){var graphicsDevice=TurbulenzEngine.createGraphicsDevice({}),spriteDrawing=new SpriteDrawing(Draw2D,graphicsDevice,$),requestHandler=RequestHandler.create({}),game=new Game(spriteDrawing),backgroundColour=[.3,.3,.3,1],sprite;$(spriteDrawing).bind("beginFrame",function(){});function update(){spriteDrawing.draw(backgroundColour,sprite)}TurbulenzEngine.onunload=function gameOnunload(){spriteDrawing=null;requestHandler=null;sprite=null;graphicsDevice=null;game=null};function sessionCreated(gameSession){TurbulenzServices.createMappingTable(requestHandler,gameSession,function(table){graphicsDevice.createTexture({src:table.getURL("textures/Sky512.jpg"),mipmaps:true,onload:function(texture){sprite=Draw2DSprite.create({x:512,y:256,texture:texture});TurbulenzEngine.setInterval(update,1e3/60)}})})}TurbulenzServices.createGameSession(requestHandler,sessionCreated)};if(!TurbulenzEngine.onload){window.alert("Entry point 'TurbulenzEngine.onload' must be defined for Engine 0.19.0 onwards.");return}TurbulenzEngine.onload.call(this)})();